{"ast":null,"code":"var fs = require('graceful-fs');\n\nvar Promise = require('bluebird');\n\nvar directory = require('./directory');\n\nvar Stream = require('stream'); // Backwards compatibility for node versions < 8\n\n\nif (!Stream.Writable || !Stream.Writable.prototype.destroy) Stream = require('readable-stream');\nmodule.exports = {\n  buffer: function (buffer, options) {\n    var source = {\n      stream: function (offset, length) {\n        var stream = Stream.PassThrough();\n        stream.end(buffer.slice(offset, length));\n        return stream;\n      },\n      size: function () {\n        return Promise.resolve(buffer.length);\n      }\n    };\n    return directory(source, options);\n  },\n  file: function (filename, options) {\n    var source = {\n      stream: function (offset, length) {\n        return fs.createReadStream(filename, {\n          start: offset,\n          end: length && offset + length\n        });\n      },\n      size: function () {\n        return new Promise(function (resolve, reject) {\n          fs.stat(filename, function (err, d) {\n            if (err) reject(err);else resolve(d.size);\n          });\n        });\n      }\n    };\n    return directory(source, options);\n  },\n  url: function (request, params, options) {\n    if (typeof params === 'string') params = {\n      url: params\n    };\n    if (!params.url) throw 'URL missing';\n    params.headers = params.headers || {};\n    var source = {\n      stream: function (offset, length) {\n        var options = Object.create(params);\n        options.headers = Object.create(params.headers);\n        options.headers.range = 'bytes=' + offset + '-' + (length ? length : '');\n        return request(options);\n      },\n      size: function () {\n        return new Promise(function (resolve, reject) {\n          var req = request(params);\n          req.on('response', function (d) {\n            req.abort();\n            if (!d.headers['content-length']) reject(new Error('Missing content length header'));else resolve(d.headers['content-length']);\n          }).on('error', reject);\n        });\n      }\n    };\n    return directory(source, options);\n  },\n  s3: function (client, params, options) {\n    var source = {\n      size: function () {\n        return new Promise(function (resolve, reject) {\n          client.headObject(params, function (err, d) {\n            if (err) reject(err);else resolve(d.ContentLength);\n          });\n        });\n      },\n      stream: function (offset, length) {\n        var d = {};\n\n        for (var key in params) d[key] = params[key];\n\n        d.Range = 'bytes=' + offset + '-' + (length ? length : '');\n        return client.getObject(d).createReadStream();\n      }\n    };\n    return directory(source, options);\n  }\n};","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/unzipper/lib/Open/index.js"],"names":["fs","require","Promise","directory","Stream","Writable","prototype","destroy","module","exports","buffer","options","source","stream","offset","length","PassThrough","end","slice","size","resolve","file","filename","createReadStream","start","reject","stat","err","d","url","request","params","headers","Object","create","range","req","on","abort","Error","s3","client","headObject","ContentLength","key","Range","getObject"],"mappings":"AAAA,IAAIA,EAAE,GAAGC,OAAO,CAAC,aAAD,CAAhB;;AACA,IAAIC,OAAO,GAAGD,OAAO,CAAC,UAAD,CAArB;;AACA,IAAIE,SAAS,GAAGF,OAAO,CAAC,aAAD,CAAvB;;AACA,IAAIG,MAAM,GAAGH,OAAO,CAAC,QAAD,CAApB,C,CAEA;;;AACA,IAAI,CAACG,MAAM,CAACC,QAAR,IAAoB,CAACD,MAAM,CAACC,QAAP,CAAgBC,SAAhB,CAA0BC,OAAnD,EACEH,MAAM,GAAGH,OAAO,CAAC,iBAAD,CAAhB;AAEFO,MAAM,CAACC,OAAP,GAAiB;AACfC,EAAAA,MAAM,EAAE,UAASA,MAAT,EAAiBC,OAAjB,EAA0B;AAChC,QAAIC,MAAM,GAAG;AACXC,MAAAA,MAAM,EAAE,UAASC,MAAT,EAAiBC,MAAjB,EAAyB;AAC/B,YAAIF,MAAM,GAAGT,MAAM,CAACY,WAAP,EAAb;AACAH,QAAAA,MAAM,CAACI,GAAP,CAAWP,MAAM,CAACQ,KAAP,CAAaJ,MAAb,EAAqBC,MAArB,CAAX;AACA,eAAOF,MAAP;AACD,OALU;AAMXM,MAAAA,IAAI,EAAE,YAAW;AACf,eAAOjB,OAAO,CAACkB,OAAR,CAAgBV,MAAM,CAACK,MAAvB,CAAP;AACD;AARU,KAAb;AAUA,WAAOZ,SAAS,CAACS,MAAD,EAASD,OAAT,CAAhB;AACD,GAbc;AAcfU,EAAAA,IAAI,EAAE,UAASC,QAAT,EAAmBX,OAAnB,EAA4B;AAChC,QAAIC,MAAM,GAAG;AACXC,MAAAA,MAAM,EAAE,UAASC,MAAT,EAAgBC,MAAhB,EAAwB;AAC9B,eAAOf,EAAE,CAACuB,gBAAH,CAAoBD,QAApB,EAA6B;AAACE,UAAAA,KAAK,EAAEV,MAAR;AAAgBG,UAAAA,GAAG,EAAEF,MAAM,IAAID,MAAM,GAACC;AAAtC,SAA7B,CAAP;AACD,OAHU;AAIXI,MAAAA,IAAI,EAAE,YAAW;AACf,eAAO,IAAIjB,OAAJ,CAAY,UAASkB,OAAT,EAAiBK,MAAjB,EAAyB;AAC1CzB,UAAAA,EAAE,CAAC0B,IAAH,CAAQJ,QAAR,EAAiB,UAASK,GAAT,EAAaC,CAAb,EAAgB;AAC/B,gBAAID,GAAJ,EACEF,MAAM,CAACE,GAAD,CAAN,CADF,KAGEP,OAAO,CAACQ,CAAC,CAACT,IAAH,CAAP;AACH,WALD;AAMD,SAPM,CAAP;AAQD;AAbU,KAAb;AAeA,WAAOhB,SAAS,CAACS,MAAD,EAASD,OAAT,CAAhB;AACD,GA/Bc;AAiCfkB,EAAAA,GAAG,EAAE,UAASC,OAAT,EAAkBC,MAAlB,EAA0BpB,OAA1B,EAAmC;AACtC,QAAI,OAAOoB,MAAP,KAAkB,QAAtB,EACEA,MAAM,GAAG;AAACF,MAAAA,GAAG,EAAEE;AAAN,KAAT;AACF,QAAI,CAACA,MAAM,CAACF,GAAZ,EACE,MAAM,aAAN;AACFE,IAAAA,MAAM,CAACC,OAAP,GAAiBD,MAAM,CAACC,OAAP,IAAkB,EAAnC;AAEA,QAAIpB,MAAM,GAAG;AACXC,MAAAA,MAAM,EAAG,UAASC,MAAT,EAAgBC,MAAhB,EAAwB;AAC/B,YAAIJ,OAAO,GAAGsB,MAAM,CAACC,MAAP,CAAcH,MAAd,CAAd;AACApB,QAAAA,OAAO,CAACqB,OAAR,GAAkBC,MAAM,CAACC,MAAP,CAAcH,MAAM,CAACC,OAArB,CAAlB;AACArB,QAAAA,OAAO,CAACqB,OAAR,CAAgBG,KAAhB,GAAwB,WAASrB,MAAT,GAAgB,GAAhB,IAAuBC,MAAM,GAAGA,MAAH,GAAY,EAAzC,CAAxB;AACA,eAAOe,OAAO,CAACnB,OAAD,CAAd;AACD,OANU;AAOXQ,MAAAA,IAAI,EAAE,YAAW;AACf,eAAO,IAAIjB,OAAJ,CAAY,UAASkB,OAAT,EAAiBK,MAAjB,EAAyB;AAC1C,cAAIW,GAAG,GAAGN,OAAO,CAACC,MAAD,CAAjB;AACAK,UAAAA,GAAG,CAACC,EAAJ,CAAO,UAAP,EAAkB,UAAST,CAAT,EAAY;AAC5BQ,YAAAA,GAAG,CAACE,KAAJ;AACA,gBAAI,CAACV,CAAC,CAACI,OAAF,CAAU,gBAAV,CAAL,EACEP,MAAM,CAAC,IAAIc,KAAJ,CAAU,+BAAV,CAAD,CAAN,CADF,KAGEnB,OAAO,CAACQ,CAAC,CAACI,OAAF,CAAU,gBAAV,CAAD,CAAP;AACH,WAND,EAMGK,EANH,CAMM,OANN,EAMcZ,MANd;AAOD,SATM,CAAP;AAUD;AAlBU,KAAb;AAqBA,WAAOtB,SAAS,CAACS,MAAD,EAASD,OAAT,CAAhB;AACD,GA9Dc;AAgEf6B,EAAAA,EAAE,EAAG,UAASC,MAAT,EAAgBV,MAAhB,EAAwBpB,OAAxB,EAAiC;AACpC,QAAIC,MAAM,GAAG;AACXO,MAAAA,IAAI,EAAE,YAAW;AACf,eAAO,IAAIjB,OAAJ,CAAY,UAASkB,OAAT,EAAiBK,MAAjB,EAAyB;AAC1CgB,UAAAA,MAAM,CAACC,UAAP,CAAkBX,MAAlB,EAA0B,UAASJ,GAAT,EAAaC,CAAb,EAAgB;AACxC,gBAAID,GAAJ,EACEF,MAAM,CAACE,GAAD,CAAN,CADF,KAGEP,OAAO,CAACQ,CAAC,CAACe,aAAH,CAAP;AACH,WALD;AAMD,SAPM,CAAP;AAQD,OAVU;AAWX9B,MAAAA,MAAM,EAAE,UAASC,MAAT,EAAgBC,MAAhB,EAAwB;AAC9B,YAAIa,CAAC,GAAG,EAAR;;AACA,aAAK,IAAIgB,GAAT,IAAgBb,MAAhB,EACEH,CAAC,CAACgB,GAAD,CAAD,GAASb,MAAM,CAACa,GAAD,CAAf;;AACFhB,QAAAA,CAAC,CAACiB,KAAF,GAAU,WAAS/B,MAAT,GAAgB,GAAhB,IAAuBC,MAAM,GAAGA,MAAH,GAAY,EAAzC,CAAV;AACA,eAAO0B,MAAM,CAACK,SAAP,CAAiBlB,CAAjB,EAAoBL,gBAApB,EAAP;AACD;AAjBU,KAAb;AAoBA,WAAOpB,SAAS,CAACS,MAAD,EAASD,OAAT,CAAhB;AACD;AAtFc,CAAjB","sourcesContent":["var fs = require('graceful-fs');\nvar Promise = require('bluebird');\nvar directory = require('./directory');\nvar Stream = require('stream');\n\n// Backwards compatibility for node versions < 8\nif (!Stream.Writable || !Stream.Writable.prototype.destroy)\n  Stream = require('readable-stream');\n\nmodule.exports = {\n  buffer: function(buffer, options) {\n    var source = {\n      stream: function(offset, length) {\n        var stream = Stream.PassThrough();\n        stream.end(buffer.slice(offset, length));\n        return stream;\n      },\n      size: function() {\n        return Promise.resolve(buffer.length);\n      }\n    };\n    return directory(source, options);\n  },\n  file: function(filename, options) {\n    var source = {\n      stream: function(offset,length) {\n        return fs.createReadStream(filename,{start: offset, end: length && offset+length});\n      },\n      size: function() {\n        return new Promise(function(resolve,reject) {\n          fs.stat(filename,function(err,d) {\n            if (err)\n              reject(err);\n            else\n              resolve(d.size);\n          });\n        });\n      }\n    };\n    return directory(source, options);\n  },\n\n  url: function(request, params, options) {\n    if (typeof params === 'string')\n      params = {url: params};\n    if (!params.url)\n      throw 'URL missing';\n    params.headers = params.headers || {};\n\n    var source = {\n      stream : function(offset,length) {\n        var options = Object.create(params);\n        options.headers = Object.create(params.headers);\n        options.headers.range = 'bytes='+offset+'-' + (length ? length : '');\n        return request(options);\n      },\n      size: function() {\n        return new Promise(function(resolve,reject) {\n          var req = request(params);\n          req.on('response',function(d) {\n            req.abort();\n            if (!d.headers['content-length'])\n              reject(new Error('Missing content length header'));\n            else\n              resolve(d.headers['content-length']);\n          }).on('error',reject);\n        });\n      }\n    };\n\n    return directory(source, options);\n  },\n\n  s3 : function(client,params, options) {\n    var source = {\n      size: function() {\n        return new Promise(function(resolve,reject) {\n          client.headObject(params, function(err,d) {\n            if (err)\n              reject(err);\n            else\n              resolve(d.ContentLength);\n          });\n        });\n      },\n      stream: function(offset,length) {\n        var d = {};\n        for (var key in params)\n          d[key] = params[key];\n        d.Range = 'bytes='+offset+'-' + (length ? length : '');\n        return client.getObject(d).createReadStream();\n      }\n    };\n\n    return directory(source, options);\n  }\n};\n"]},"metadata":{},"sourceType":"script"}