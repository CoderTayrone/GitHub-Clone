{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.loadFirebaseEnvs = exports.loadUserEnvs = exports.hasUserEnvs = exports.validateKey = exports.parse = void 0;\n\nconst clc = require(\"cli-color\");\n\nconst fs = require(\"fs\");\n\nconst path = require(\"path\");\n\nconst error_1 = require(\"../error\");\n\nconst logger_1 = require(\"../logger\");\n\nconst previews_1 = require(\"../previews\");\n\nconst utils_1 = require(\"../utils\");\n\nconst RESERVED_KEYS = [\"FIREBASE_CONFIG\", \"CLOUD_RUNTIME_CONFIG\", \"ENTRY_POINT\", \"GCP_PROJECT\", \"GCLOUD_PROJECT\", \"GOOGLE_CLOUD_PROJECT\", \"FUNCTION_TRIGGER_TYPE\", \"FUNCTION_NAME\", \"FUNCTION_MEMORY_MB\", \"FUNCTION_TIMEOUT_SEC\", \"FUNCTION_IDENTITY\", \"FUNCTION_REGION\", \"FUNCTION_TARGET\", \"FUNCTION_SIGNATURE_TYPE\", \"K_SERVICE\", \"K_REVISION\", \"PORT\", \"K_CONFIGURATION\"];\nconst LINE_RE = new RegExp(\"^\" + \"\\\\s*\" + \"(\\\\w+)\" + \"\\\\s*=\\\\s*\" + \"(\" + \"\\\\s*'(?:\\\\\\\\'|[^'])*'|\" + '\\\\s*\"(?:\\\\\\\\\"|[^\"])*\"|' + \"[^\\\\#\\\\r\\\\n]+\" + \")?\" + \"\\\\s*\" + \"(?:#[^\\\\n]*)?\" + \"$\", \"gms\");\n\nfunction parse(data) {\n  const envs = {};\n  const errors = [];\n  data = data.replace(/\\r\\n?/, \"\\n\");\n  let match;\n\n  while (match = LINE_RE.exec(data)) {\n    let [, k, v] = match;\n    v = (v || \"\").trim();\n    let quotesMatch;\n\n    if ((quotesMatch = /^([\"'])(.*)\\1$/ms.exec(v)) != null) {\n      v = quotesMatch[2];\n\n      if (quotesMatch[1] === '\"') {\n        v = v.replace(\"\\\\n\", \"\\n\").replace(\"\\\\r\", \"\\r\").replace(\"\\\\t\", \"\\t\").replace(\"\\\\v\", \"\\v\");\n        v = v.replace(/\\\\([\\\\'\"])/g, \"$1\");\n      }\n    }\n\n    envs[k] = v;\n  }\n\n  const nonmatches = data.replace(LINE_RE, \"\");\n\n  for (let line of nonmatches.split(/[\\r\\n]+/)) {\n    line = line.trim();\n\n    if (line.startsWith(\"#\")) {\n      continue;\n    }\n\n    if (line.length) errors.push(line);\n  }\n\n  return {\n    envs,\n    errors\n  };\n}\n\nexports.parse = parse;\n\nclass KeyValidationError extends Error {}\n\nfunction validateKey(key) {\n  if (RESERVED_KEYS.includes(key)) {\n    throw new KeyValidationError(`Key ${key} is reserved for internal use.`);\n  }\n\n  if (!/^[A-Z_][A-Z0-9_]*$/.test(key)) {\n    throw new KeyValidationError(`Key ${key} must start with an uppercase ASCII letter or underscore` + \", and then consist of uppercase ASCII letters, digits, and underscores.\");\n  }\n\n  if (key.startsWith(\"X_GOOGLE_\") || key.startsWith(\"FIREBASE_\")) {\n    throw new KeyValidationError(`Key ${key} starts with a reserved prefix (X_GOOGLE_ or FIREBASE_)`);\n  }\n}\n\nexports.validateKey = validateKey;\n\nfunction parseStrict(data) {\n  const {\n    envs,\n    errors\n  } = parse(data);\n\n  if (errors.length) {\n    throw new error_1.FirebaseError(`Invalid dotenv file, error on lines: ${errors.join(\",\")}`);\n  }\n\n  const validationErrors = [];\n\n  for (const key of Object.keys(envs)) {\n    try {\n      validateKey(key);\n    } catch (err) {\n      logger_1.logger.debug(`Failed to validate key ${key}: ${err}`);\n\n      if (err instanceof KeyValidationError) {\n        validationErrors.push(err);\n      } else {\n        throw err;\n      }\n    }\n  }\n\n  if (validationErrors.length > 0) {\n    throw new error_1.FirebaseError(\"Validation failed\", {\n      children: validationErrors\n    });\n  }\n\n  return envs;\n}\n\nfunction findEnvfiles(functionsSource, projectId, projectAlias) {\n  const files = [\".env\", `.env.${projectId}`];\n\n  if (projectAlias && projectAlias.length) {\n    files.push(`.env.${projectAlias}`);\n  }\n\n  return files.map(f => path.join(functionsSource, f)).filter(fs.existsSync).map(p => path.basename(p));\n}\n\nfunction hasUserEnvs({\n  functionsSource,\n  projectId,\n  projectAlias\n}) {\n  return findEnvfiles(functionsSource, projectId, projectAlias).length > 0;\n}\n\nexports.hasUserEnvs = hasUserEnvs;\n\nfunction loadUserEnvs({\n  functionsSource,\n  projectId,\n  projectAlias\n}) {\n  var _a;\n\n  if (!previews_1.previews.dotenv) {\n    return {};\n  }\n\n  const envFiles = findEnvfiles(functionsSource, projectId, projectAlias);\n\n  if (envFiles.length == 0) {\n    return {};\n  }\n\n  if (projectAlias) {\n    if (envFiles.includes(`.env.${projectId}`) && envFiles.includes(`.env.${projectAlias}`)) {\n      throw new error_1.FirebaseError(`Can't have both dotenv files with projectId (env.${projectId}) ` + `and projectAlias (.env.${projectAlias}) as extensions.`);\n    }\n  }\n\n  let envs = {};\n\n  for (const f of envFiles) {\n    try {\n      const data = fs.readFileSync(path.join(functionsSource, f), \"utf8\");\n      envs = Object.assign(Object.assign({}, envs), parseStrict(data));\n    } catch (err) {\n      throw new error_1.FirebaseError(`Failed to load environment variables from ${f}.`, {\n        exit: 2,\n        children: ((_a = err.children) === null || _a === void 0 ? void 0 : _a.length) > 0 ? err.children : [err]\n      });\n    }\n  }\n\n  utils_1.logBullet(clc.cyan.bold(\"functions: \") + `Loaded environment variables from ${envFiles.join(\", \")}.`);\n  return envs;\n}\n\nexports.loadUserEnvs = loadUserEnvs;\n\nfunction loadFirebaseEnvs(firebaseConfig, projectId) {\n  return {\n    FIREBASE_CONFIG: JSON.stringify(firebaseConfig),\n    GCLOUD_PROJECT: projectId\n  };\n}\n\nexports.loadFirebaseEnvs = loadFirebaseEnvs;","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/firebase-tools/lib/functions/env.js"],"names":["Object","defineProperty","exports","value","loadFirebaseEnvs","loadUserEnvs","hasUserEnvs","validateKey","parse","clc","require","fs","path","error_1","logger_1","previews_1","utils_1","RESERVED_KEYS","LINE_RE","RegExp","data","envs","errors","replace","match","exec","k","v","trim","quotesMatch","nonmatches","line","split","startsWith","length","push","KeyValidationError","Error","key","includes","test","parseStrict","FirebaseError","join","validationErrors","keys","err","logger","debug","children","findEnvfiles","functionsSource","projectId","projectAlias","files","map","f","filter","existsSync","p","basename","_a","previews","dotenv","envFiles","readFileSync","assign","exit","logBullet","cyan","bold","firebaseConfig","FIREBASE_CONFIG","JSON","stringify","GCLOUD_PROJECT"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.loadFirebaseEnvs = exports.loadUserEnvs = exports.hasUserEnvs = exports.validateKey = exports.parse = void 0;\nconst clc = require(\"cli-color\");\nconst fs = require(\"fs\");\nconst path = require(\"path\");\nconst error_1 = require(\"../error\");\nconst logger_1 = require(\"../logger\");\nconst previews_1 = require(\"../previews\");\nconst utils_1 = require(\"../utils\");\nconst RESERVED_KEYS = [\n    \"FIREBASE_CONFIG\",\n    \"CLOUD_RUNTIME_CONFIG\",\n    \"ENTRY_POINT\",\n    \"GCP_PROJECT\",\n    \"GCLOUD_PROJECT\",\n    \"GOOGLE_CLOUD_PROJECT\",\n    \"FUNCTION_TRIGGER_TYPE\",\n    \"FUNCTION_NAME\",\n    \"FUNCTION_MEMORY_MB\",\n    \"FUNCTION_TIMEOUT_SEC\",\n    \"FUNCTION_IDENTITY\",\n    \"FUNCTION_REGION\",\n    \"FUNCTION_TARGET\",\n    \"FUNCTION_SIGNATURE_TYPE\",\n    \"K_SERVICE\",\n    \"K_REVISION\",\n    \"PORT\",\n    \"K_CONFIGURATION\",\n];\nconst LINE_RE = new RegExp(\"^\" +\n    \"\\\\s*\" +\n    \"(\\\\w+)\" +\n    \"\\\\s*=\\\\s*\" +\n    \"(\" +\n    \"\\\\s*'(?:\\\\\\\\'|[^'])*'|\" +\n    '\\\\s*\"(?:\\\\\\\\\"|[^\"])*\"|' +\n    \"[^\\\\#\\\\r\\\\n]+\" +\n    \")?\" +\n    \"\\\\s*\" +\n    \"(?:#[^\\\\n]*)?\" +\n    \"$\", \"gms\");\nfunction parse(data) {\n    const envs = {};\n    const errors = [];\n    data = data.replace(/\\r\\n?/, \"\\n\");\n    let match;\n    while ((match = LINE_RE.exec(data))) {\n        let [, k, v] = match;\n        v = (v || \"\").trim();\n        let quotesMatch;\n        if ((quotesMatch = /^([\"'])(.*)\\1$/ms.exec(v)) != null) {\n            v = quotesMatch[2];\n            if (quotesMatch[1] === '\"') {\n                v = v.replace(\"\\\\n\", \"\\n\").replace(\"\\\\r\", \"\\r\").replace(\"\\\\t\", \"\\t\").replace(\"\\\\v\", \"\\v\");\n                v = v.replace(/\\\\([\\\\'\"])/g, \"$1\");\n            }\n        }\n        envs[k] = v;\n    }\n    const nonmatches = data.replace(LINE_RE, \"\");\n    for (let line of nonmatches.split(/[\\r\\n]+/)) {\n        line = line.trim();\n        if (line.startsWith(\"#\")) {\n            continue;\n        }\n        if (line.length)\n            errors.push(line);\n    }\n    return { envs, errors };\n}\nexports.parse = parse;\nclass KeyValidationError extends Error {\n}\nfunction validateKey(key) {\n    if (RESERVED_KEYS.includes(key)) {\n        throw new KeyValidationError(`Key ${key} is reserved for internal use.`);\n    }\n    if (!/^[A-Z_][A-Z0-9_]*$/.test(key)) {\n        throw new KeyValidationError(`Key ${key} must start with an uppercase ASCII letter or underscore` +\n            \", and then consist of uppercase ASCII letters, digits, and underscores.\");\n    }\n    if (key.startsWith(\"X_GOOGLE_\") || key.startsWith(\"FIREBASE_\")) {\n        throw new KeyValidationError(`Key ${key} starts with a reserved prefix (X_GOOGLE_ or FIREBASE_)`);\n    }\n}\nexports.validateKey = validateKey;\nfunction parseStrict(data) {\n    const { envs, errors } = parse(data);\n    if (errors.length) {\n        throw new error_1.FirebaseError(`Invalid dotenv file, error on lines: ${errors.join(\",\")}`);\n    }\n    const validationErrors = [];\n    for (const key of Object.keys(envs)) {\n        try {\n            validateKey(key);\n        }\n        catch (err) {\n            logger_1.logger.debug(`Failed to validate key ${key}: ${err}`);\n            if (err instanceof KeyValidationError) {\n                validationErrors.push(err);\n            }\n            else {\n                throw err;\n            }\n        }\n    }\n    if (validationErrors.length > 0) {\n        throw new error_1.FirebaseError(\"Validation failed\", { children: validationErrors });\n    }\n    return envs;\n}\nfunction findEnvfiles(functionsSource, projectId, projectAlias) {\n    const files = [\".env\", `.env.${projectId}`];\n    if (projectAlias && projectAlias.length) {\n        files.push(`.env.${projectAlias}`);\n    }\n    return files\n        .map((f) => path.join(functionsSource, f))\n        .filter(fs.existsSync)\n        .map((p) => path.basename(p));\n}\nfunction hasUserEnvs({ functionsSource, projectId, projectAlias }) {\n    return findEnvfiles(functionsSource, projectId, projectAlias).length > 0;\n}\nexports.hasUserEnvs = hasUserEnvs;\nfunction loadUserEnvs({ functionsSource, projectId, projectAlias, }) {\n    var _a;\n    if (!previews_1.previews.dotenv) {\n        return {};\n    }\n    const envFiles = findEnvfiles(functionsSource, projectId, projectAlias);\n    if (envFiles.length == 0) {\n        return {};\n    }\n    if (projectAlias) {\n        if (envFiles.includes(`.env.${projectId}`) && envFiles.includes(`.env.${projectAlias}`)) {\n            throw new error_1.FirebaseError(`Can't have both dotenv files with projectId (env.${projectId}) ` +\n                `and projectAlias (.env.${projectAlias}) as extensions.`);\n        }\n    }\n    let envs = {};\n    for (const f of envFiles) {\n        try {\n            const data = fs.readFileSync(path.join(functionsSource, f), \"utf8\");\n            envs = Object.assign(Object.assign({}, envs), parseStrict(data));\n        }\n        catch (err) {\n            throw new error_1.FirebaseError(`Failed to load environment variables from ${f}.`, {\n                exit: 2,\n                children: ((_a = err.children) === null || _a === void 0 ? void 0 : _a.length) > 0 ? err.children : [err],\n            });\n        }\n    }\n    utils_1.logBullet(clc.cyan.bold(\"functions: \") + `Loaded environment variables from ${envFiles.join(\", \")}.`);\n    return envs;\n}\nexports.loadUserEnvs = loadUserEnvs;\nfunction loadFirebaseEnvs(firebaseConfig, projectId) {\n    return {\n        FIREBASE_CONFIG: JSON.stringify(firebaseConfig),\n        GCLOUD_PROJECT: projectId,\n    };\n}\nexports.loadFirebaseEnvs = loadFirebaseEnvs;\n"]},"metadata":{},"sourceType":"script"}