{"ast":null,"code":"var request = require(\"request\");\n\nvar uuid = require(\"uuid\");\n\nvar querystring = require(\"querystring\");\n\nvar utils = require(\"./utils\");\n\nvar config = require(\"./config\");\n\nvar url = require(\"url\");\n\nvar debug = require(\"debug\")(\"universal-analytics\");\n\nmodule.exports = init;\n\nfunction init(tid, cid, options) {\n  return new Visitor(tid, cid, options);\n}\n\nvar Visitor = module.exports.Visitor = function (tid, cid, options, context, persistentParams) {\n  if (typeof tid === 'object') {\n    options = tid;\n    tid = cid = null;\n  } else if (typeof cid === 'object') {\n    options = cid;\n    cid = null;\n  }\n\n  this._queue = [];\n  this.options = options || {};\n\n  if (this.options.hostname) {\n    config.hostname = this.options.hostname;\n  }\n\n  if (this.options.path) {\n    config.path = this.options.path;\n  }\n\n  if (this.options.http) {\n    var parsedHostname = url.parse(config.hostname);\n    config.hostname = 'http://' + parsedHostname.host;\n  }\n\n  if (this.options.enableBatching !== undefined) {\n    config.batching = options.enableBatching;\n  }\n\n  if (this.options.batchSize) {\n    config.batchSize = this.options.batchSize;\n  }\n\n  this._context = context || {};\n  this._persistentParams = persistentParams || {};\n  this.tid = tid || this.options.tid;\n  this.cid = this._determineCid(cid, this.options.cid, this.options.strictCidFormat !== false);\n\n  if (this.options.uid) {\n    this.uid = this.options.uid;\n  }\n};\n\nmodule.exports.middleware = function (tid, options) {\n  this.tid = tid;\n  this.options = options;\n  var cookieName = (this.options || {}).cookieName || \"_ga\";\n  return function (req, res, next) {\n    req.visitor = module.exports.createFromSession(req.session);\n    if (req.visitor) return next();\n    var cid;\n\n    if (req.cookies && req.cookies[cookieName]) {\n      var gaSplit = req.cookies[cookieName].split('.');\n      cid = gaSplit[2] + \".\" + gaSplit[3];\n    }\n\n    req.visitor = init(tid, cid, options);\n\n    if (req.session) {\n      req.session.cid = req.visitor.cid;\n    }\n\n    next();\n  };\n};\n\nmodule.exports.createFromSession = function (session) {\n  if (session && session.cid) {\n    return init(this.tid, session.cid, this.options);\n  }\n};\n\nVisitor.prototype = {\n  debug: function (d) {\n    debug.enabled = arguments.length === 0 ? true : d;\n    debug(\"visitor.debug() is deprecated: set DEBUG=universal-analytics to enable logging\");\n    return this;\n  },\n  reset: function () {\n    this._context = null;\n    return this;\n  },\n  set: function (key, value) {\n    this._persistentParams = this._persistentParams || {};\n    this._persistentParams[key] = value;\n  },\n  pageview: function (path, hostname, title, params, fn) {\n    if (typeof path === 'object' && path != null) {\n      params = path;\n\n      if (typeof hostname === 'function') {\n        fn = hostname;\n      }\n\n      path = hostname = title = null;\n    } else if (typeof hostname === 'function') {\n      fn = hostname;\n      hostname = title = null;\n    } else if (typeof title === 'function') {\n      fn = title;\n      title = null;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n    params = Object.assign({}, this._persistentParams || {}, params);\n    params.dp = path || params.dp || this._context.dp;\n    params.dh = hostname || params.dh || this._context.dh;\n    params.dt = title || params.dt || this._context.dt;\n\n    this._tidyParameters(params);\n\n    if (!params.dp && !params.dl) {\n      return this._handleError(\"Please provide either a page path (dp) or a document location (dl)\", fn);\n    }\n\n    return this._withContext(params)._enqueue(\"pageview\", params, fn);\n  },\n  screenview: function (screenName, appName, appVersion, appId, appInstallerId, params, fn) {\n    if (typeof screenName === 'object' && screenName != null) {\n      params = screenName;\n\n      if (typeof appName === 'function') {\n        fn = appName;\n      }\n\n      screenName = appName = appVersion = appId = appInstallerId = null;\n    } else if (typeof appName === 'function') {\n      fn = appName;\n      appName = appVersion = appId = appInstallerId = null;\n    } else if (typeof appVersion === 'function') {\n      fn = appVersion;\n      appVersion = appId = appInstallerId = null;\n    } else if (typeof appId === 'function') {\n      fn = appId;\n      appId = appInstallerId = null;\n    } else if (typeof appInstallerId === 'function') {\n      fn = appInstallerId;\n      appInstallerId = null;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n    params = Object.assign({}, this._persistentParams || {}, params);\n    params.cd = screenName || params.cd || this._context.cd;\n    params.an = appName || params.an || this._context.an;\n    params.av = appVersion || params.av || this._context.av;\n    params.aid = appId || params.aid || this._context.aid;\n    params.aiid = appInstallerId || params.aiid || this._context.aiid;\n\n    this._tidyParameters(params);\n\n    if (!params.cd || !params.an) {\n      return this._handleError(\"Please provide at least a screen name (cd) and an app name (an)\", fn);\n    }\n\n    return this._withContext(params)._enqueue(\"screenview\", params, fn);\n  },\n  event: function (category, action, label, value, params, fn) {\n    if (typeof category === 'object' && category != null) {\n      params = category;\n\n      if (typeof action === 'function') {\n        fn = action;\n      }\n\n      category = action = label = value = null;\n    } else if (typeof label === 'function') {\n      fn = label;\n      label = value = null;\n    } else if (typeof value === 'function') {\n      fn = value;\n      value = null;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n    params = Object.assign({}, this._persistentParams || {}, params);\n    params.ec = category || params.ec || this._context.ec;\n    params.ea = action || params.ea || this._context.ea;\n    params.el = label || params.el || this._context.el;\n    params.ev = value || params.ev || this._context.ev;\n    params.p = params.p || params.dp || this._context.p || this._context.dp;\n    delete params.dp;\n\n    this._tidyParameters(params);\n\n    if (!params.ec || !params.ea) {\n      return this._handleError(\"Please provide at least an event category (ec) and an event action (ea)\", fn);\n    }\n\n    return this._withContext(params)._enqueue(\"event\", params, fn);\n  },\n  transaction: function (transaction, revenue, shipping, tax, affiliation, params, fn) {\n    if (typeof transaction === 'object') {\n      params = transaction;\n\n      if (typeof revenue === 'function') {\n        fn = revenue;\n      }\n\n      transaction = revenue = shipping = tax = affiliation = null;\n    } else if (typeof revenue === 'function') {\n      fn = revenue;\n      revenue = shipping = tax = affiliation = null;\n    } else if (typeof shipping === 'function') {\n      fn = shipping;\n      shipping = tax = affiliation = null;\n    } else if (typeof tax === 'function') {\n      fn = tax;\n      tax = affiliation = null;\n    } else if (typeof affiliation === 'function') {\n      fn = affiliation;\n      affiliation = null;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n    params = Object.assign({}, this._persistentParams || {}, params);\n    params.ti = transaction || params.ti || this._context.ti;\n    params.tr = revenue || params.tr || this._context.tr;\n    params.ts = shipping || params.ts || this._context.ts;\n    params.tt = tax || params.tt || this._context.tt;\n    params.ta = affiliation || params.ta || this._context.ta;\n    params.p = params.p || this._context.p || this._context.dp;\n\n    this._tidyParameters(params);\n\n    if (!params.ti) {\n      return this._handleError(\"Please provide at least a transaction ID (ti)\", fn);\n    }\n\n    return this._withContext(params)._enqueue(\"transaction\", params, fn);\n  },\n  item: function (price, quantity, sku, name, variation, params, fn) {\n    if (typeof price === 'object') {\n      params = price;\n\n      if (typeof quantity === 'function') {\n        fn = quantity;\n      }\n\n      price = quantity = sku = name = variation = null;\n    } else if (typeof quantity === 'function') {\n      fn = quantity;\n      quantity = sku = name = variation = null;\n    } else if (typeof sku === 'function') {\n      fn = sku;\n      sku = name = variation = null;\n    } else if (typeof name === 'function') {\n      fn = name;\n      name = variation = null;\n    } else if (typeof variation === 'function') {\n      fn = variation;\n      variation = null;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n    params = Object.assign({}, this._persistentParams || {}, params);\n    params.ip = price || params.ip || this._context.ip;\n    params.iq = quantity || params.iq || this._context.iq;\n    params.ic = sku || params.ic || this._context.ic;\n    params.in = name || params.in || this._context.in;\n    params.iv = variation || params.iv || this._context.iv;\n    params.p = params.p || this._context.p || this._context.dp;\n    params.ti = params.ti || this._context.ti;\n\n    this._tidyParameters(params);\n\n    if (!params.ti) {\n      return this._handleError(\"Please provide at least an item transaction ID (ti)\", fn);\n    }\n\n    return this._withContext(params)._enqueue(\"item\", params, fn);\n  },\n  exception: function (description, fatal, params, fn) {\n    if (typeof description === 'object') {\n      params = description;\n\n      if (typeof fatal === 'function') {\n        fn = fatal;\n      }\n\n      description = fatal = null;\n    } else if (typeof fatal === 'function') {\n      fn = fatal;\n      fatal = 0;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n    params = Object.assign({}, this._persistentParams || {}, params);\n    params.exd = description || params.exd || this._context.exd;\n    params.exf = +!!(fatal || params.exf || this._context.exf);\n\n    if (params.exf === 0) {\n      delete params.exf;\n    }\n\n    this._tidyParameters(params);\n\n    return this._withContext(params)._enqueue(\"exception\", params, fn);\n  },\n  timing: function (category, variable, time, label, params, fn) {\n    if (typeof category === 'object') {\n      params = category;\n\n      if (typeof variable === 'function') {\n        fn = variable;\n      }\n\n      category = variable = time = label = null;\n    } else if (typeof variable === 'function') {\n      fn = variable;\n      variable = time = label = null;\n    } else if (typeof time === 'function') {\n      fn = time;\n      time = label = null;\n    } else if (typeof label === 'function') {\n      fn = label;\n      label = null;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n    params = Object.assign({}, this._persistentParams || {}, params);\n    params.utc = category || params.utc || this._context.utc;\n    params.utv = variable || params.utv || this._context.utv;\n    params.utt = time || params.utt || this._context.utt;\n    params.utl = label || params.utl || this._context.utl;\n\n    this._tidyParameters(params);\n\n    return this._withContext(params)._enqueue(\"timing\", params, fn);\n  },\n  send: function (fn) {\n    var self = this;\n    var count = 1;\n\n    var fn = fn || function () {};\n\n    debug(\"Sending %d tracking call(s)\", self._queue.length);\n\n    var getBody = function (params) {\n      return params.map(function (x) {\n        return querystring.stringify(x);\n      }).join(\"\\n\");\n    };\n\n    var onFinish = function (err) {\n      debug(\"Finished sending tracking calls\");\n      fn.call(self, err || null, count - 1);\n    };\n\n    var iterator = function () {\n      if (!self._queue.length) {\n        return onFinish(null);\n      }\n\n      var params = [];\n\n      if (config.batching) {\n        params = self._queue.splice(0, Math.min(self._queue.length, config.batchSize));\n      } else {\n        params.push(self._queue.shift());\n      }\n\n      var useBatchPath = params.length > 1;\n      var path = config.hostname + (useBatchPath ? config.batchPath : config.path);\n      debug(\"%d: %o\", count++, params);\n      var options = Object.assign({}, self.options.requestOptions, {\n        body: getBody(params),\n        headers: self.options.headers || {}\n      });\n      request.post(path, options, nextIteration);\n    };\n\n    function nextIteration(err) {\n      if (err) return onFinish(err);\n      iterator();\n    }\n\n    iterator();\n  },\n  _enqueue: function (type, params, fn) {\n    if (typeof params === 'function') {\n      fn = params;\n      params = {};\n    }\n\n    params = this._translateParams(params) || {};\n    Object.assign(params, {\n      v: config.protocolVersion,\n      tid: this.tid,\n      cid: this.cid,\n      t: type\n    });\n\n    if (this.uid) {\n      params.uid = this.uid;\n    }\n\n    this._queue.push(params);\n\n    if (debug.enabled) {\n      this._checkParameters(params);\n    }\n\n    debug(\"Enqueued %s (%o)\", type, params);\n\n    if (fn) {\n      this.send(fn);\n    }\n\n    return this;\n  },\n  _handleError: function (message, fn) {\n    debug(\"Error: %s\", message);\n    fn && fn.call(this, new Error(message));\n    return this;\n  },\n  _determineCid: function () {\n    var args = Array.prototype.splice.call(arguments, 0);\n    var id;\n    var lastItem = args.length - 1;\n    var strict = args[lastItem];\n\n    if (strict) {\n      for (var i = 0; i < lastItem; i++) {\n        id = utils.ensureValidCid(args[i]);\n        if (id !== false) return id;\n        if (id != null) debug(\"Warning! Invalid UUID format '%s'\", args[i]);\n      }\n    } else {\n      for (var i = 0; i < lastItem; i++) {\n        if (args[i]) return args[i];\n      }\n    }\n\n    return uuid.v4();\n  },\n  _checkParameters: function (params) {\n    for (var param in params) {\n      if (config.acceptedParameters.indexOf(param) !== -1 || config.acceptedParametersRegex.filter(function (r) {\n        return r.test(param);\n      }).length) {\n        continue;\n      }\n\n      debug(\"Warning! Unsupported tracking parameter %s (%s)\", param, params[param]);\n    }\n  },\n  _translateParams: function (params) {\n    var translated = {};\n\n    for (var key in params) {\n      if (config.parametersMap.hasOwnProperty(key)) {\n        translated[config.parametersMap[key]] = params[key];\n      } else {\n        translated[key] = params[key];\n      }\n    }\n\n    return translated;\n  },\n  _tidyParameters: function (params) {\n    for (var param in params) {\n      if (params[param] === null || params[param] === undefined) {\n        delete params[param];\n      }\n    }\n\n    return params;\n  },\n  _withContext: function (context) {\n    var visitor = new Visitor(this.tid, this.cid, this.options, context, this._persistentParams);\n    visitor._queue = this._queue;\n    return visitor;\n  }\n};\nVisitor.prototype.pv = Visitor.prototype.pageview;\nVisitor.prototype.e = Visitor.prototype.event;\nVisitor.prototype.t = Visitor.prototype.transaction;\nVisitor.prototype.i = Visitor.prototype.item;","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/universal-analytics/lib/index.js"],"names":["request","require","uuid","querystring","utils","config","url","debug","module","exports","init","tid","cid","options","Visitor","context","persistentParams","_queue","hostname","path","http","parsedHostname","parse","host","enableBatching","undefined","batching","batchSize","_context","_persistentParams","_determineCid","strictCidFormat","uid","middleware","cookieName","req","res","next","visitor","createFromSession","session","cookies","gaSplit","split","prototype","d","enabled","arguments","length","reset","set","key","value","pageview","title","params","fn","_translateParams","Object","assign","dp","dh","dt","_tidyParameters","dl","_handleError","_withContext","_enqueue","screenview","screenName","appName","appVersion","appId","appInstallerId","cd","an","av","aid","aiid","event","category","action","label","ec","ea","el","ev","p","transaction","revenue","shipping","tax","affiliation","ti","tr","ts","tt","ta","item","price","quantity","sku","name","variation","ip","iq","ic","in","iv","exception","description","fatal","exd","exf","timing","variable","time","utc","utv","utt","utl","send","self","count","getBody","map","x","stringify","join","onFinish","err","call","iterator","splice","Math","min","push","shift","useBatchPath","batchPath","requestOptions","body","headers","post","nextIteration","type","v","protocolVersion","t","_checkParameters","message","Error","args","Array","id","lastItem","strict","i","ensureValidCid","v4","param","acceptedParameters","indexOf","acceptedParametersRegex","filter","r","test","translated","parametersMap","hasOwnProperty","pv","e"],"mappings":"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","sourcesContent":["\nvar request = require(\"request\");\nvar uuid = require(\"uuid\");\nvar querystring = require(\"querystring\");\n\nvar utils = require(\"./utils\");\nvar config = require(\"./config\");\nvar url = require(\"url\");\n\nvar debug = require(\"debug\")(\"universal-analytics\");\n\nmodule.exports = init;\n\n\nfunction init (tid, cid, options) {\n  return new Visitor(tid, cid, options);\n}\n\nvar Visitor = module.exports.Visitor = function (tid, cid, options, context, persistentParams) {\n\n  if (typeof tid === 'object') {\n    options = tid;\n    tid = cid = null;\n  } else if (typeof cid === 'object') {\n    options = cid;\n    cid = null;\n  }\n\n  this._queue = [];\n\n  this.options = options || {};\n\n  if(this.options.hostname) {\n    config.hostname = this.options.hostname;\n  }\n  if(this.options.path) {\n    config.path = this.options.path;\n  }\n\n  if (this.options.http) {\n    var parsedHostname = url.parse(config.hostname);\n    config.hostname = 'http://' + parsedHostname.host;\n  }\n\n  if(this.options.enableBatching !== undefined) {\n    config.batching = options.enableBatching;\n  }\n\n  if(this.options.batchSize) {\n    config.batchSize = this.options.batchSize;\n  }\n\n  this._context = context || {};\n  this._persistentParams = persistentParams || {};\n\n  this.tid = tid || this.options.tid;\n  this.cid = this._determineCid(cid, this.options.cid, (this.options.strictCidFormat !== false));\n  if(this.options.uid) {\n    this.uid = this.options.uid;\n  }\n}\n\n\n\n\nmodule.exports.middleware = function (tid, options) {\n\n  this.tid = tid;\n  this.options = options;\n\n  var cookieName = (this.options || {}).cookieName || \"_ga\";\n\n  return function (req, res, next) {\n\n    req.visitor = module.exports.createFromSession(req.session);\n\n    if (req.visitor) return next();\n\n    var cid;\n    if (req.cookies && req.cookies[cookieName]) {\n      var gaSplit = req.cookies[cookieName].split('.');\n      cid = gaSplit[2] + \".\" + gaSplit[3];\n    }\n\n    req.visitor = init(tid, cid, options);\n\n    if (req.session) {\n      req.session.cid = req.visitor.cid;\n    }\n\n    next();\n  }\n}\n\n\n\nmodule.exports.createFromSession = function (session) {\n  if (session && session.cid) {\n    return init(this.tid, session.cid, this.options);\n  }\n}\n\n\n\nVisitor.prototype = {\n\n  debug: function (d) {\n    debug.enabled = arguments.length === 0 ? true : d;\n    debug(\"visitor.debug() is deprecated: set DEBUG=universal-analytics to enable logging\")\n    return this;\n  },\n\n\n  reset: function () {\n    this._context = null;\n    return this;\n  },\n\n  set: function (key, value) {\n    this._persistentParams = this._persistentParams || {};\n    this._persistentParams[key] = value;\n  },\n\n  pageview: function (path, hostname, title, params, fn) {\n\n    if (typeof path === 'object' && path != null) {\n      params = path;\n      if (typeof hostname === 'function') {\n        fn = hostname\n      }\n      path = hostname = title  = null;\n    } else if (typeof hostname === 'function') {\n      fn = hostname\n      hostname = title = null;\n    } else if (typeof title === 'function') {\n      fn = title;\n      title = null;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n\n    params = Object.assign({}, this._persistentParams || {}, params);\n\n    params.dp = path || params.dp || this._context.dp;\n    params.dh = hostname || params.dh || this._context.dh;\n    params.dt = title || params.dt || this._context.dt;\n\n    this._tidyParameters(params);\n\n    if (!params.dp && !params.dl) {\n      return this._handleError(\"Please provide either a page path (dp) or a document location (dl)\", fn);\n    }\n\n    return this._withContext(params)._enqueue(\"pageview\", params, fn);\n  },\n\n\n  screenview: function (screenName, appName, appVersion, appId, appInstallerId, params, fn) {\n\n      if (typeof screenName === 'object' && screenName != null) {\n          params = screenName;\n          if (typeof appName === 'function') {\n              fn = appName\n          }\n          screenName = appName = appVersion = appId = appInstallerId = null;\n      } else if (typeof appName === 'function') {\n          fn = appName\n          appName = appVersion = appId = appInstallerId = null;\n      } else if (typeof appVersion === 'function') {\n          fn = appVersion;\n          appVersion = appId = appInstallerId = null;\n      } else if (typeof appId === 'function') {\n          fn = appId;\n          appId = appInstallerId = null;\n      } else if (typeof appInstallerId === 'function') {\n          fn = appInstallerId;\n          appInstallerId = null;\n      } else if (typeof params === 'function') {\n          fn = params;\n          params = null;\n      }\n\n      params = this._translateParams(params);\n\n      params = Object.assign({}, this._persistentParams || {}, params);\n\n      params.cd = screenName || params.cd || this._context.cd;\n      params.an = appName || params.an || this._context.an;\n      params.av = appVersion || params.av || this._context.av;\n      params.aid = appId || params.aid || this._context.aid;\n      params.aiid = appInstallerId || params.aiid || this._context.aiid;\n\n      this._tidyParameters(params);\n\n      if (!params.cd || !params.an) {\n          return this._handleError(\"Please provide at least a screen name (cd) and an app name (an)\", fn);\n      }\n\n      return this._withContext(params)._enqueue(\"screenview\", params, fn);\n  },\n\n\n  event: function (category, action, label, value, params, fn) {\n\n    if (typeof category === 'object' && category != null) {\n      params = category;\n      if (typeof action === 'function') {\n        fn = action\n      }\n      category = action = label = value = null;\n    } else if (typeof label === 'function') {\n      fn = label;\n      label = value = null;\n    } else if (typeof value === 'function') {\n      fn = value;\n      value = null;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n\n    params = Object.assign({}, this._persistentParams || {}, params);\n\n    params.ec = category || params.ec || this._context.ec;\n    params.ea = action || params.ea || this._context.ea;\n    params.el = label || params.el || this._context.el;\n    params.ev = value || params.ev || this._context.ev;\n    params.p = params.p || params.dp || this._context.p || this._context.dp;\n\n    delete params.dp;\n    this._tidyParameters(params);\n\n    if (!params.ec || !params.ea) {\n      return this._handleError(\"Please provide at least an event category (ec) and an event action (ea)\", fn);\n    }\n\n    return this._withContext(params)._enqueue(\"event\", params, fn);\n  },\n\n\n  transaction: function (transaction, revenue, shipping, tax, affiliation, params, fn) {\n    if (typeof transaction === 'object') {\n      params = transaction;\n      if (typeof revenue === 'function') {\n        fn = revenue\n      }\n      transaction = revenue = shipping = tax = affiliation = null;\n    } else if (typeof revenue === 'function') {\n      fn = revenue;\n      revenue = shipping = tax = affiliation = null;\n    } else if (typeof shipping === 'function') {\n      fn = shipping;\n      shipping = tax = affiliation = null;\n    } else if (typeof tax === 'function') {\n      fn = tax;\n      tax = affiliation = null;\n    } else if (typeof affiliation === 'function') {\n      fn = affiliation;\n      affiliation = null;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n\n    params = Object.assign({}, this._persistentParams || {}, params);\n\n    params.ti = transaction || params.ti || this._context.ti;\n    params.tr = revenue || params.tr || this._context.tr;\n    params.ts = shipping || params.ts || this._context.ts;\n    params.tt = tax || params.tt || this._context.tt;\n    params.ta = affiliation || params.ta || this._context.ta;\n    params.p = params.p || this._context.p || this._context.dp;\n\n    this._tidyParameters(params);\n\n    if (!params.ti) {\n      return this._handleError(\"Please provide at least a transaction ID (ti)\", fn);\n    }\n\n    return this._withContext(params)._enqueue(\"transaction\", params, fn);\n  },\n\n\n  item: function (price, quantity, sku, name, variation, params, fn) {\n    if (typeof price === 'object') {\n      params = price;\n      if (typeof quantity === 'function') {\n        fn = quantity\n      }\n      price = quantity = sku = name = variation = null;\n    } else if (typeof quantity === 'function') {\n      fn = quantity;\n      quantity = sku = name = variation = null;\n    } else if (typeof sku === 'function') {\n      fn = sku;\n      sku = name = variation = null;\n    } else if (typeof name === 'function') {\n      fn = name;\n      name = variation = null;\n    } else if (typeof variation === 'function') {\n      fn = variation;\n      variation = null;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n\n    params = Object.assign({}, this._persistentParams || {}, params);\n\n    params.ip = price || params.ip || this._context.ip;\n    params.iq = quantity || params.iq || this._context.iq;\n    params.ic = sku || params.ic || this._context.ic;\n    params.in = name || params.in || this._context.in;\n    params.iv = variation || params.iv || this._context.iv;\n    params.p = params.p || this._context.p || this._context.dp;\n    params.ti = params.ti || this._context.ti;\n\n    this._tidyParameters(params);\n\n    if (!params.ti) {\n      return this._handleError(\"Please provide at least an item transaction ID (ti)\", fn);\n    }\n\n    return this._withContext(params)._enqueue(\"item\", params, fn);\n\n  },\n\n  exception: function (description, fatal, params, fn) {\n\n    if (typeof description === 'object') {\n      params = description;\n      if (typeof fatal === 'function') {\n        fn = fatal;\n      }\n      description = fatal = null;\n    } else if (typeof fatal === 'function') {\n      fn = fatal;\n      fatal = 0;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n\n    params = Object.assign({}, this._persistentParams || {}, params);\n\n    params.exd = description || params.exd || this._context.exd;\n    params.exf = +!!(fatal || params.exf || this._context.exf);\n\n    if (params.exf === 0) {\n      delete params.exf;\n    }\n\n    this._tidyParameters(params);\n\n    return this._withContext(params)._enqueue(\"exception\", params, fn);\n  },\n\n  timing: function (category, variable, time, label, params, fn) {\n\n    if (typeof category === 'object') {\n      params = category;\n      if (typeof variable === 'function') {\n        fn = variable;\n      }\n      category = variable = time = label = null;\n    } else if (typeof variable === 'function') {\n      fn = variable;\n      variable = time = label = null;\n    } else if (typeof time === 'function') {\n      fn = time;\n      time = label = null;\n    } else if (typeof label === 'function') {\n      fn = label;\n      label = null;\n    } else if (typeof params === 'function') {\n      fn = params;\n      params = null;\n    }\n\n    params = this._translateParams(params);\n\n    params = Object.assign({}, this._persistentParams || {}, params);\n\n    params.utc = category || params.utc || this._context.utc;\n    params.utv = variable || params.utv || this._context.utv;\n    params.utt = time || params.utt || this._context.utt;\n    params.utl = label || params.utl || this._context.utl;\n\n    this._tidyParameters(params);\n\n    return this._withContext(params)._enqueue(\"timing\", params, fn);\n  },\n\n\n  send: function (fn) {\n    var self = this;\n    var count = 1;\n    var fn = fn || function () {};\n    debug(\"Sending %d tracking call(s)\", self._queue.length);\n\n    var getBody = function(params) {\n      return params.map(function(x) { return querystring.stringify(x); }).join(\"\\n\");\n    }\n\n    var onFinish = function (err) {\n      debug(\"Finished sending tracking calls\")\n      fn.call(self, err || null, count - 1);\n    }\n\n    var iterator = function () {\n      if (!self._queue.length) {\n        return onFinish(null);\n      }\n      var params = [];\n\n      if(config.batching) {\n        params = self._queue.splice(0, Math.min(self._queue.length, config.batchSize));\n      } else {\n        params.push(self._queue.shift());\n      }\n\n      var useBatchPath = params.length > 1;\n\n      var path = config.hostname + (useBatchPath ? config.batchPath :config.path);\n\n      debug(\"%d: %o\", count++, params);\n\n      var options = Object.assign({}, self.options.requestOptions, {\n        body: getBody(params),\n        headers: self.options.headers || {}\n      });\n\n      request.post(path, options, nextIteration);\n    }\n\n    function nextIteration(err) {\n      if (err) return onFinish(err);\n      iterator();\n    }\n\n    iterator();\n\n  },\n\n  _enqueue: function (type, params, fn) {\n\n    if (typeof params === 'function') {\n      fn = params;\n      params = {};\n    }\n\n    params = this._translateParams(params) || {};\n\n    Object.assign(params, {\n      v: config.protocolVersion,\n      tid: this.tid,\n      cid: this.cid,\n      t: type\n    });\n    if(this.uid) {\n      params.uid = this.uid;\n    }\n\n    this._queue.push(params);\n\n    if (debug.enabled) {\n      this._checkParameters(params);\n    }\n\n    debug(\"Enqueued %s (%o)\", type, params);\n\n    if (fn) {\n      this.send(fn);\n    }\n\n    return this;\n  },\n\n\n  _handleError: function (message, fn) {\n      debug(\"Error: %s\", message)\n      fn && fn.call(this, new Error(message))\n      return this;\n  },\n\n\n\n  _determineCid: function () {\n    var args = Array.prototype.splice.call(arguments, 0);\n    var id;\n    var lastItem = args.length-1;\n    var strict = args[lastItem];\n    if (strict) {\n      for (var i = 0; i < lastItem; i++) {\n        id = utils.ensureValidCid(args[i]);\n        if (id !== false) return id;\n        if (id != null) debug(\"Warning! Invalid UUID format '%s'\", args[i]);\n      }\n    } else {\n      for (var i = 0; i < lastItem; i++) {\n        if (args[i]) return args[i];\n      }\n    }\n    return uuid.v4();\n  },\n\n\n  _checkParameters: function (params) {\n    for (var param in params) {\n      if (config.acceptedParameters.indexOf(param) !== -1 || config.acceptedParametersRegex.filter(function (r) {\n          return r.test(param);\n        }).length) {\n        continue;\n      }\n      debug(\"Warning! Unsupported tracking parameter %s (%s)\", param, params[param]);\n    }\n  },\n\n  _translateParams: function (params) {\n        var translated = {};\n        for (var key in params) {\n            if (config.parametersMap.hasOwnProperty(key)) {\n                translated[config.parametersMap[key]] = params[key];\n            } else {\n                translated[key] = params[key];\n            }\n        }\n        return translated;\n    },\n\n  _tidyParameters: function (params) {\n    for (var param in params) {\n      if (params[param] === null || params[param] === undefined) {\n        delete params[param];\n      }\n    }\n    return params;\n  },\n\n  _withContext: function (context) {\n    var visitor = new Visitor(this.tid, this.cid, this.options, context, this._persistentParams);\n    visitor._queue = this._queue;\n    return visitor;\n  }\n\n\n}\n\nVisitor.prototype.pv = Visitor.prototype.pageview\nVisitor.prototype.e = Visitor.prototype.event\nVisitor.prototype.t = Visitor.prototype.transaction\nVisitor.prototype.i = Visitor.prototype.item\n"]},"metadata":{},"sourceType":"script"}