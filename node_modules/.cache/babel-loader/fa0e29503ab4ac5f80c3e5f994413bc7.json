{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getUsedProducts = exports.checkProductsProvisioned = exports.DeferredProduct = void 0;\n\nconst marked = require(\"marked\");\n\nconst api = require(\"../api\");\n\nconst error_1 = require(\"../error\");\n\nvar DeferredProduct;\n\n(function (DeferredProduct) {\n  DeferredProduct[DeferredProduct[\"STORAGE\"] = 0] = \"STORAGE\";\n  DeferredProduct[DeferredProduct[\"AUTH\"] = 1] = \"AUTH\";\n})(DeferredProduct = exports.DeferredProduct || (exports.DeferredProduct = {}));\n\nasync function checkProductsProvisioned(projectId, spec) {\n  const usedProducts = getUsedProducts(spec);\n  const needProvisioning = [];\n  let isStorageProvisionedPromise;\n  let isAuthProvisionedPromise;\n\n  if (usedProducts.includes(DeferredProduct.STORAGE)) {\n    isStorageProvisionedPromise = isStorageProvisioned(projectId);\n  }\n\n  if (usedProducts.includes(DeferredProduct.AUTH)) {\n    isAuthProvisionedPromise = isAuthProvisioned(projectId);\n  }\n\n  if (isStorageProvisionedPromise && !(await isStorageProvisionedPromise)) {\n    needProvisioning.push(DeferredProduct.STORAGE);\n  }\n\n  if (isAuthProvisionedPromise && !(await isAuthProvisionedPromise)) {\n    needProvisioning.push(DeferredProduct.AUTH);\n  }\n\n  if (needProvisioning.length > 0) {\n    let errorMessage = \"Some services used by this extension have not been set up on your \" + \"Firebase project. To ensure this extension works as intended, you must enable these \" + \"services by following the provided links, then retry installing the extension\\n\\n\";\n\n    if (needProvisioning.includes(DeferredProduct.STORAGE)) {\n      errorMessage += \" - Firebase Storage: store and retrieve user-generated files like images, audio, and \" + \"video without server-side code.\\n\";\n      errorMessage += `   https://console.firebase.google.com/project/${projectId}/storage`;\n      errorMessage += \"\\n\";\n    }\n\n    if (needProvisioning.includes(DeferredProduct.AUTH)) {\n      errorMessage += \" - Firebase Authentication: authenticate and manage users from a variety of providers \" + \"without server-side code.\\n\";\n      errorMessage += `   https://console.firebase.google.com/project/${projectId}/authentication/users`;\n    }\n\n    throw new error_1.FirebaseError(marked(errorMessage), {\n      exit: 2\n    });\n  }\n}\n\nexports.checkProductsProvisioned = checkProductsProvisioned;\n\nfunction getUsedProducts(spec) {\n  var _a, _b;\n\n  const usedProducts = [];\n  const usedApis = (_a = spec.apis) === null || _a === void 0 ? void 0 : _a.map(api => api.apiName);\n  const usedRoles = (_b = spec.roles) === null || _b === void 0 ? void 0 : _b.map(r => r.role.split(\".\")[0]);\n  const usedTriggers = spec.resources.map(r => getTriggerType(r.propertiesYaml));\n\n  if ((usedApis === null || usedApis === void 0 ? void 0 : usedApis.includes(\"storage-component.googleapis.com\")) || (usedRoles === null || usedRoles === void 0 ? void 0 : usedRoles.includes(\"storage\")) || usedTriggers.find(t => t === null || t === void 0 ? void 0 : t.startsWith(\"google.storage.\"))) {\n    usedProducts.push(DeferredProduct.STORAGE);\n  }\n\n  if ((usedApis === null || usedApis === void 0 ? void 0 : usedApis.includes(\"identitytoolkit.googleapis.com\")) || (usedRoles === null || usedRoles === void 0 ? void 0 : usedRoles.includes(\"firebaseauth\")) || usedTriggers.find(t => t === null || t === void 0 ? void 0 : t.startsWith(\"providers/firebase.auth/\"))) {\n    usedProducts.push(DeferredProduct.AUTH);\n  }\n\n  return usedProducts;\n}\n\nexports.getUsedProducts = getUsedProducts;\n\nfunction getTriggerType(propertiesYaml) {\n  var _a;\n\n  return (_a = propertiesYaml === null || propertiesYaml === void 0 ? void 0 : propertiesYaml.match(/eventType:\\ ([\\S]+)/)) === null || _a === void 0 ? void 0 : _a[1];\n}\n\nasync function isStorageProvisioned(projectId) {\n  var _a, _b;\n\n  const resp = await api.request(\"GET\", `/v1beta/projects/${projectId}/buckets`, {\n    auth: true,\n    origin: api.firebaseStorageOrigin\n  });\n  return !!((_b = (_a = resp.body) === null || _a === void 0 ? void 0 : _a.buckets) === null || _b === void 0 ? void 0 : _b.find(bucket => {\n    const bucketResourceName = bucket.name;\n    const bucketResourceNameTokens = bucketResourceName.split(\"/\");\n    const pattern = \"^\" + projectId + \"(.[[a-z0-9]+)*.appspot.com$\";\n    return new RegExp(pattern).test(bucketResourceNameTokens[bucketResourceNameTokens.length - 1]);\n  }));\n}\n\nasync function isAuthProvisioned(projectId) {\n  var _a, _b;\n\n  const resp = await api.request(\"GET\", `/v1/projects/${projectId}/products`, {\n    auth: true,\n    origin: api.firedataOrigin\n  });\n  return !!((_b = (_a = resp.body) === null || _a === void 0 ? void 0 : _a.activation) === null || _b === void 0 ? void 0 : _b.map(a => a.service).includes(\"FIREBASE_AUTH\"));\n}","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/firebase-tools/lib/extensions/provisioningHelper.js"],"names":["Object","defineProperty","exports","value","getUsedProducts","checkProductsProvisioned","DeferredProduct","marked","require","api","error_1","projectId","spec","usedProducts","needProvisioning","isStorageProvisionedPromise","isAuthProvisionedPromise","includes","STORAGE","isStorageProvisioned","AUTH","isAuthProvisioned","push","length","errorMessage","FirebaseError","exit","_a","_b","usedApis","apis","map","apiName","usedRoles","roles","r","role","split","usedTriggers","resources","getTriggerType","propertiesYaml","find","t","startsWith","match","resp","request","auth","origin","firebaseStorageOrigin","body","buckets","bucket","bucketResourceName","name","bucketResourceNameTokens","pattern","RegExp","test","firedataOrigin","activation","a","service"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getUsedProducts = exports.checkProductsProvisioned = exports.DeferredProduct = void 0;\nconst marked = require(\"marked\");\nconst api = require(\"../api\");\nconst error_1 = require(\"../error\");\nvar DeferredProduct;\n(function (DeferredProduct) {\n    DeferredProduct[DeferredProduct[\"STORAGE\"] = 0] = \"STORAGE\";\n    DeferredProduct[DeferredProduct[\"AUTH\"] = 1] = \"AUTH\";\n})(DeferredProduct = exports.DeferredProduct || (exports.DeferredProduct = {}));\nasync function checkProductsProvisioned(projectId, spec) {\n    const usedProducts = getUsedProducts(spec);\n    const needProvisioning = [];\n    let isStorageProvisionedPromise;\n    let isAuthProvisionedPromise;\n    if (usedProducts.includes(DeferredProduct.STORAGE)) {\n        isStorageProvisionedPromise = isStorageProvisioned(projectId);\n    }\n    if (usedProducts.includes(DeferredProduct.AUTH)) {\n        isAuthProvisionedPromise = isAuthProvisioned(projectId);\n    }\n    if (isStorageProvisionedPromise && !(await isStorageProvisionedPromise)) {\n        needProvisioning.push(DeferredProduct.STORAGE);\n    }\n    if (isAuthProvisionedPromise && !(await isAuthProvisionedPromise)) {\n        needProvisioning.push(DeferredProduct.AUTH);\n    }\n    if (needProvisioning.length > 0) {\n        let errorMessage = \"Some services used by this extension have not been set up on your \" +\n            \"Firebase project. To ensure this extension works as intended, you must enable these \" +\n            \"services by following the provided links, then retry installing the extension\\n\\n\";\n        if (needProvisioning.includes(DeferredProduct.STORAGE)) {\n            errorMessage +=\n                \" - Firebase Storage: store and retrieve user-generated files like images, audio, and \" +\n                    \"video without server-side code.\\n\";\n            errorMessage += `   https://console.firebase.google.com/project/${projectId}/storage`;\n            errorMessage += \"\\n\";\n        }\n        if (needProvisioning.includes(DeferredProduct.AUTH)) {\n            errorMessage +=\n                \" - Firebase Authentication: authenticate and manage users from a variety of providers \" +\n                    \"without server-side code.\\n\";\n            errorMessage += `   https://console.firebase.google.com/project/${projectId}/authentication/users`;\n        }\n        throw new error_1.FirebaseError(marked(errorMessage), { exit: 2 });\n    }\n}\nexports.checkProductsProvisioned = checkProductsProvisioned;\nfunction getUsedProducts(spec) {\n    var _a, _b;\n    const usedProducts = [];\n    const usedApis = (_a = spec.apis) === null || _a === void 0 ? void 0 : _a.map((api) => api.apiName);\n    const usedRoles = (_b = spec.roles) === null || _b === void 0 ? void 0 : _b.map((r) => r.role.split(\".\")[0]);\n    const usedTriggers = spec.resources.map((r) => getTriggerType(r.propertiesYaml));\n    if ((usedApis === null || usedApis === void 0 ? void 0 : usedApis.includes(\"storage-component.googleapis.com\")) || (usedRoles === null || usedRoles === void 0 ? void 0 : usedRoles.includes(\"storage\")) ||\n        usedTriggers.find((t) => t === null || t === void 0 ? void 0 : t.startsWith(\"google.storage.\"))) {\n        usedProducts.push(DeferredProduct.STORAGE);\n    }\n    if ((usedApis === null || usedApis === void 0 ? void 0 : usedApis.includes(\"identitytoolkit.googleapis.com\")) || (usedRoles === null || usedRoles === void 0 ? void 0 : usedRoles.includes(\"firebaseauth\")) ||\n        usedTriggers.find((t) => t === null || t === void 0 ? void 0 : t.startsWith(\"providers/firebase.auth/\"))) {\n        usedProducts.push(DeferredProduct.AUTH);\n    }\n    return usedProducts;\n}\nexports.getUsedProducts = getUsedProducts;\nfunction getTriggerType(propertiesYaml) {\n    var _a;\n    return (_a = propertiesYaml === null || propertiesYaml === void 0 ? void 0 : propertiesYaml.match(/eventType:\\ ([\\S]+)/)) === null || _a === void 0 ? void 0 : _a[1];\n}\nasync function isStorageProvisioned(projectId) {\n    var _a, _b;\n    const resp = await api.request(\"GET\", `/v1beta/projects/${projectId}/buckets`, {\n        auth: true,\n        origin: api.firebaseStorageOrigin,\n    });\n    return !!((_b = (_a = resp.body) === null || _a === void 0 ? void 0 : _a.buckets) === null || _b === void 0 ? void 0 : _b.find((bucket) => {\n        const bucketResourceName = bucket.name;\n        const bucketResourceNameTokens = bucketResourceName.split(\"/\");\n        const pattern = \"^\" + projectId + \"(.[[a-z0-9]+)*.appspot.com$\";\n        return new RegExp(pattern).test(bucketResourceNameTokens[bucketResourceNameTokens.length - 1]);\n    }));\n}\nasync function isAuthProvisioned(projectId) {\n    var _a, _b;\n    const resp = await api.request(\"GET\", `/v1/projects/${projectId}/products`, {\n        auth: true,\n        origin: api.firedataOrigin,\n    });\n    return !!((_b = (_a = resp.body) === null || _a === void 0 ? void 0 : _a.activation) === null || _b === void 0 ? void 0 : _b.map((a) => a.service).includes(\"FIREBASE_AUTH\"));\n}\n"]},"metadata":{},"sourceType":"script"}