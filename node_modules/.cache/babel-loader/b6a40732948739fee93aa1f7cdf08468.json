{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.deleteFunctions = void 0;\n\nconst helper = require(\"./deploy/functions/functionsDeployHelper\");\n\nconst queue_1 = require(\"./throttler/queue\");\n\nconst tasks = require(\"./deploy/functions/tasks\");\n\nconst deploymentTimer_1 = require(\"./deploy/functions/deploymentTimer\");\n\nconst errorHandler_1 = require(\"./deploy/functions/errorHandler\");\n\nasync function deleteFunctions(functionsToDelete, schedulesToDelete, topicsToDelete, appEngineLocation) {\n  const timer = new deploymentTimer_1.DeploymentTimer();\n  const errorHandler = new errorHandler_1.ErrorHandler();\n  const cloudFunctionsQueue = new queue_1.Queue({\n    handler: tasks.functionsDeploymentHandler(timer, errorHandler),\n    retries: 30,\n    backoff: 10000,\n    concurrency: 40,\n    maxBackoff: 40000\n  });\n  const schedulerQueue = new queue_1.Queue({\n    handler: tasks.schedulerDeploymentHandler(errorHandler)\n  });\n  const topicQueue = new queue_1.Queue({\n    handler: tasks.schedulerDeploymentHandler(errorHandler)\n  });\n  functionsToDelete.forEach(fn => {\n    const taskParams = {\n      projectId: fn.project,\n      errorHandler\n    };\n    const deleteFunctionTask = tasks.deleteFunctionTask(taskParams, fn);\n    void cloudFunctionsQueue.run(deleteFunctionTask);\n  });\n  schedulesToDelete.forEach(schedule => {\n    const taskParams = {\n      projectId: schedule.project,\n      errorHandler\n    };\n    const deleteSchedulerTask = tasks.deleteScheduleTask(taskParams, schedule, appEngineLocation);\n    void schedulerQueue.run(deleteSchedulerTask);\n  });\n  topicsToDelete.forEach(topic => {\n    const taskParams = {\n      projectId: topic.project,\n      errorHandler\n    };\n    const deleteTopicTask = tasks.deleteTopicTask(taskParams, topic);\n    void topicQueue.run(deleteTopicTask);\n  });\n  const queuePromises = [cloudFunctionsQueue.wait(), schedulerQueue.wait(), topicQueue.wait()];\n  cloudFunctionsQueue.close();\n  schedulerQueue.close();\n  topicQueue.close();\n  cloudFunctionsQueue.process();\n  schedulerQueue.process();\n  topicQueue.process();\n  await Promise.all(queuePromises);\n  helper.logAndTrackDeployStats(cloudFunctionsQueue, errorHandler);\n  errorHandler.printErrors();\n}\n\nexports.deleteFunctions = deleteFunctions;","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/firebase-tools/lib/functionsDelete.js"],"names":["Object","defineProperty","exports","value","deleteFunctions","helper","require","queue_1","tasks","deploymentTimer_1","errorHandler_1","functionsToDelete","schedulesToDelete","topicsToDelete","appEngineLocation","timer","DeploymentTimer","errorHandler","ErrorHandler","cloudFunctionsQueue","Queue","handler","functionsDeploymentHandler","retries","backoff","concurrency","maxBackoff","schedulerQueue","schedulerDeploymentHandler","topicQueue","forEach","fn","taskParams","projectId","project","deleteFunctionTask","run","schedule","deleteSchedulerTask","deleteScheduleTask","topic","deleteTopicTask","queuePromises","wait","close","process","Promise","all","logAndTrackDeployStats","printErrors"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.deleteFunctions = void 0;\nconst helper = require(\"./deploy/functions/functionsDeployHelper\");\nconst queue_1 = require(\"./throttler/queue\");\nconst tasks = require(\"./deploy/functions/tasks\");\nconst deploymentTimer_1 = require(\"./deploy/functions/deploymentTimer\");\nconst errorHandler_1 = require(\"./deploy/functions/errorHandler\");\nasync function deleteFunctions(functionsToDelete, schedulesToDelete, topicsToDelete, appEngineLocation) {\n    const timer = new deploymentTimer_1.DeploymentTimer();\n    const errorHandler = new errorHandler_1.ErrorHandler();\n    const cloudFunctionsQueue = new queue_1.Queue({\n        handler: tasks.functionsDeploymentHandler(timer, errorHandler),\n        retries: 30,\n        backoff: 10000,\n        concurrency: 40,\n        maxBackoff: 40000,\n    });\n    const schedulerQueue = new queue_1.Queue({\n        handler: tasks.schedulerDeploymentHandler(errorHandler),\n    });\n    const topicQueue = new queue_1.Queue({\n        handler: tasks.schedulerDeploymentHandler(errorHandler),\n    });\n    functionsToDelete.forEach((fn) => {\n        const taskParams = {\n            projectId: fn.project,\n            errorHandler,\n        };\n        const deleteFunctionTask = tasks.deleteFunctionTask(taskParams, fn);\n        void cloudFunctionsQueue.run(deleteFunctionTask);\n    });\n    schedulesToDelete.forEach((schedule) => {\n        const taskParams = {\n            projectId: schedule.project,\n            errorHandler,\n        };\n        const deleteSchedulerTask = tasks.deleteScheduleTask(taskParams, schedule, appEngineLocation);\n        void schedulerQueue.run(deleteSchedulerTask);\n    });\n    topicsToDelete.forEach((topic) => {\n        const taskParams = {\n            projectId: topic.project,\n            errorHandler,\n        };\n        const deleteTopicTask = tasks.deleteTopicTask(taskParams, topic);\n        void topicQueue.run(deleteTopicTask);\n    });\n    const queuePromises = [cloudFunctionsQueue.wait(), schedulerQueue.wait(), topicQueue.wait()];\n    cloudFunctionsQueue.close();\n    schedulerQueue.close();\n    topicQueue.close();\n    cloudFunctionsQueue.process();\n    schedulerQueue.process();\n    topicQueue.process();\n    await Promise.all(queuePromises);\n    helper.logAndTrackDeployStats(cloudFunctionsQueue, errorHandler);\n    errorHandler.printErrors();\n}\nexports.deleteFunctions = deleteFunctions;\n"]},"metadata":{},"sourceType":"script"}