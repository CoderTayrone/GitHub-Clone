{"ast":null,"code":"\"use strict\";\n/***\n * Node External Editor\n *\n * Kevin Gravier <kevin@mrkmg.com>\n * MIT 2019\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar chardet_1 = require(\"chardet\");\n\nvar child_process_1 = require(\"child_process\");\n\nvar fs_1 = require(\"fs\");\n\nvar iconv_lite_1 = require(\"iconv-lite\");\n\nvar tmp_1 = require(\"tmp\");\n\nvar CreateFileError_1 = require(\"./errors/CreateFileError\");\n\nexports.CreateFileError = CreateFileError_1.CreateFileError;\n\nvar LaunchEditorError_1 = require(\"./errors/LaunchEditorError\");\n\nexports.LaunchEditorError = LaunchEditorError_1.LaunchEditorError;\n\nvar ReadFileError_1 = require(\"./errors/ReadFileError\");\n\nexports.ReadFileError = ReadFileError_1.ReadFileError;\n\nvar RemoveFileError_1 = require(\"./errors/RemoveFileError\");\n\nexports.RemoveFileError = RemoveFileError_1.RemoveFileError;\n\nfunction edit(text, fileOptions) {\n  if (text === void 0) {\n    text = \"\";\n  }\n\n  var editor = new ExternalEditor(text, fileOptions);\n  editor.run();\n  editor.cleanup();\n  return editor.text;\n}\n\nexports.edit = edit;\n\nfunction editAsync(text, callback, fileOptions) {\n  if (text === void 0) {\n    text = \"\";\n  }\n\n  var editor = new ExternalEditor(text, fileOptions);\n  editor.runAsync(function (err, result) {\n    if (err) {\n      setImmediate(callback, err, null);\n    } else {\n      try {\n        editor.cleanup();\n        setImmediate(callback, null, result);\n      } catch (cleanupError) {\n        setImmediate(callback, cleanupError, null);\n      }\n    }\n  });\n}\n\nexports.editAsync = editAsync;\n\nvar ExternalEditor = function () {\n  function ExternalEditor(text, fileOptions) {\n    if (text === void 0) {\n      text = \"\";\n    }\n\n    this.text = \"\";\n    this.fileOptions = {};\n    this.text = text;\n\n    if (fileOptions) {\n      this.fileOptions = fileOptions;\n    }\n\n    this.determineEditor();\n    this.createTemporaryFile();\n  }\n\n  ExternalEditor.splitStringBySpace = function (str) {\n    var pieces = [];\n    var currentString = \"\";\n\n    for (var strIndex = 0; strIndex < str.length; strIndex++) {\n      var currentLetter = str[strIndex];\n\n      if (strIndex > 0 && currentLetter === \" \" && str[strIndex - 1] !== \"\\\\\" && currentString.length > 0) {\n        pieces.push(currentString);\n        currentString = \"\";\n      } else {\n        currentString += currentLetter;\n      }\n    }\n\n    if (currentString.length > 0) {\n      pieces.push(currentString);\n    }\n\n    return pieces;\n  };\n\n  Object.defineProperty(ExternalEditor.prototype, \"temp_file\", {\n    get: function () {\n      console.log(\"DEPRECATED: temp_file. Use tempFile moving forward.\");\n      return this.tempFile;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ExternalEditor.prototype, \"last_exit_status\", {\n    get: function () {\n      console.log(\"DEPRECATED: last_exit_status. Use lastExitStatus moving forward.\");\n      return this.lastExitStatus;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ExternalEditor.prototype.run = function () {\n    this.launchEditor();\n    this.readTemporaryFile();\n    return this.text;\n  };\n\n  ExternalEditor.prototype.runAsync = function (callback) {\n    var _this = this;\n\n    try {\n      this.launchEditorAsync(function () {\n        try {\n          _this.readTemporaryFile();\n\n          setImmediate(callback, null, _this.text);\n        } catch (readError) {\n          setImmediate(callback, readError, null);\n        }\n      });\n    } catch (launchError) {\n      setImmediate(callback, launchError, null);\n    }\n  };\n\n  ExternalEditor.prototype.cleanup = function () {\n    this.removeTemporaryFile();\n  };\n\n  ExternalEditor.prototype.determineEditor = function () {\n    var editor = process.env.VISUAL ? process.env.VISUAL : process.env.EDITOR ? process.env.EDITOR : /^win/.test(process.platform) ? \"notepad\" : \"vim\";\n    var editorOpts = ExternalEditor.splitStringBySpace(editor).map(function (piece) {\n      return piece.replace(\"\\\\ \", \" \");\n    });\n    var bin = editorOpts.shift();\n    this.editor = {\n      args: editorOpts,\n      bin: bin\n    };\n  };\n\n  ExternalEditor.prototype.createTemporaryFile = function () {\n    try {\n      this.tempFile = tmp_1.tmpNameSync(this.fileOptions);\n      var opt = {\n        encoding: \"utf8\"\n      };\n\n      if (this.fileOptions.hasOwnProperty(\"mode\")) {\n        opt.mode = this.fileOptions.mode;\n      }\n\n      fs_1.writeFileSync(this.tempFile, this.text, opt);\n    } catch (createFileError) {\n      throw new CreateFileError_1.CreateFileError(createFileError);\n    }\n  };\n\n  ExternalEditor.prototype.readTemporaryFile = function () {\n    try {\n      var tempFileBuffer = fs_1.readFileSync(this.tempFile);\n\n      if (tempFileBuffer.length === 0) {\n        this.text = \"\";\n      } else {\n        var encoding = chardet_1.detect(tempFileBuffer).toString();\n\n        if (!iconv_lite_1.encodingExists(encoding)) {\n          // Probably a bad idea, but will at least prevent crashing\n          encoding = \"utf8\";\n        }\n\n        this.text = iconv_lite_1.decode(tempFileBuffer, encoding);\n      }\n    } catch (readFileError) {\n      throw new ReadFileError_1.ReadFileError(readFileError);\n    }\n  };\n\n  ExternalEditor.prototype.removeTemporaryFile = function () {\n    try {\n      fs_1.unlinkSync(this.tempFile);\n    } catch (removeFileError) {\n      throw new RemoveFileError_1.RemoveFileError(removeFileError);\n    }\n  };\n\n  ExternalEditor.prototype.launchEditor = function () {\n    try {\n      var editorProcess = child_process_1.spawnSync(this.editor.bin, this.editor.args.concat([this.tempFile]), {\n        stdio: \"inherit\"\n      });\n      this.lastExitStatus = editorProcess.status;\n    } catch (launchError) {\n      throw new LaunchEditorError_1.LaunchEditorError(launchError);\n    }\n  };\n\n  ExternalEditor.prototype.launchEditorAsync = function (callback) {\n    var _this = this;\n\n    try {\n      var editorProcess = child_process_1.spawn(this.editor.bin, this.editor.args.concat([this.tempFile]), {\n        stdio: \"inherit\"\n      });\n      editorProcess.on(\"exit\", function (code) {\n        _this.lastExitStatus = code;\n        setImmediate(callback);\n      });\n    } catch (launchError) {\n      throw new LaunchEditorError_1.LaunchEditorError(launchError);\n    }\n  };\n\n  return ExternalEditor;\n}();\n\nexports.ExternalEditor = ExternalEditor;","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/external-editor/main/index.js"],"names":["Object","defineProperty","exports","value","chardet_1","require","child_process_1","fs_1","iconv_lite_1","tmp_1","CreateFileError_1","CreateFileError","LaunchEditorError_1","LaunchEditorError","ReadFileError_1","ReadFileError","RemoveFileError_1","RemoveFileError","edit","text","fileOptions","editor","ExternalEditor","run","cleanup","editAsync","callback","runAsync","err","result","setImmediate","cleanupError","determineEditor","createTemporaryFile","splitStringBySpace","str","pieces","currentString","strIndex","length","currentLetter","push","prototype","get","console","log","tempFile","enumerable","configurable","lastExitStatus","launchEditor","readTemporaryFile","_this","launchEditorAsync","readError","launchError","removeTemporaryFile","process","env","VISUAL","EDITOR","test","platform","editorOpts","map","piece","replace","bin","shift","args","tmpNameSync","opt","encoding","hasOwnProperty","mode","writeFileSync","createFileError","tempFileBuffer","readFileSync","detect","toString","encodingExists","decode","readFileError","unlinkSync","removeFileError","editorProcess","spawnSync","concat","stdio","status","spawn","on","code"],"mappings":"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","sourcesContent":["\"use strict\";\n/***\n * Node External Editor\n *\n * Kevin Gravier <kevin@mrkmg.com>\n * MIT 2019\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar chardet_1 = require(\"chardet\");\nvar child_process_1 = require(\"child_process\");\nvar fs_1 = require(\"fs\");\nvar iconv_lite_1 = require(\"iconv-lite\");\nvar tmp_1 = require(\"tmp\");\nvar CreateFileError_1 = require(\"./errors/CreateFileError\");\nexports.CreateFileError = CreateFileError_1.CreateFileError;\nvar LaunchEditorError_1 = require(\"./errors/LaunchEditorError\");\nexports.LaunchEditorError = LaunchEditorError_1.LaunchEditorError;\nvar ReadFileError_1 = require(\"./errors/ReadFileError\");\nexports.ReadFileError = ReadFileError_1.ReadFileError;\nvar RemoveFileError_1 = require(\"./errors/RemoveFileError\");\nexports.RemoveFileError = RemoveFileError_1.RemoveFileError;\nfunction edit(text, fileOptions) {\n    if (text === void 0) { text = \"\"; }\n    var editor = new ExternalEditor(text, fileOptions);\n    editor.run();\n    editor.cleanup();\n    return editor.text;\n}\nexports.edit = edit;\nfunction editAsync(text, callback, fileOptions) {\n    if (text === void 0) { text = \"\"; }\n    var editor = new ExternalEditor(text, fileOptions);\n    editor.runAsync(function (err, result) {\n        if (err) {\n            setImmediate(callback, err, null);\n        }\n        else {\n            try {\n                editor.cleanup();\n                setImmediate(callback, null, result);\n            }\n            catch (cleanupError) {\n                setImmediate(callback, cleanupError, null);\n            }\n        }\n    });\n}\nexports.editAsync = editAsync;\nvar ExternalEditor = /** @class */ (function () {\n    function ExternalEditor(text, fileOptions) {\n        if (text === void 0) { text = \"\"; }\n        this.text = \"\";\n        this.fileOptions = {};\n        this.text = text;\n        if (fileOptions) {\n            this.fileOptions = fileOptions;\n        }\n        this.determineEditor();\n        this.createTemporaryFile();\n    }\n    ExternalEditor.splitStringBySpace = function (str) {\n        var pieces = [];\n        var currentString = \"\";\n        for (var strIndex = 0; strIndex < str.length; strIndex++) {\n            var currentLetter = str[strIndex];\n            if (strIndex > 0 && currentLetter === \" \" && str[strIndex - 1] !== \"\\\\\" && currentString.length > 0) {\n                pieces.push(currentString);\n                currentString = \"\";\n            }\n            else {\n                currentString += currentLetter;\n            }\n        }\n        if (currentString.length > 0) {\n            pieces.push(currentString);\n        }\n        return pieces;\n    };\n    Object.defineProperty(ExternalEditor.prototype, \"temp_file\", {\n        get: function () {\n            console.log(\"DEPRECATED: temp_file. Use tempFile moving forward.\");\n            return this.tempFile;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExternalEditor.prototype, \"last_exit_status\", {\n        get: function () {\n            console.log(\"DEPRECATED: last_exit_status. Use lastExitStatus moving forward.\");\n            return this.lastExitStatus;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ExternalEditor.prototype.run = function () {\n        this.launchEditor();\n        this.readTemporaryFile();\n        return this.text;\n    };\n    ExternalEditor.prototype.runAsync = function (callback) {\n        var _this = this;\n        try {\n            this.launchEditorAsync(function () {\n                try {\n                    _this.readTemporaryFile();\n                    setImmediate(callback, null, _this.text);\n                }\n                catch (readError) {\n                    setImmediate(callback, readError, null);\n                }\n            });\n        }\n        catch (launchError) {\n            setImmediate(callback, launchError, null);\n        }\n    };\n    ExternalEditor.prototype.cleanup = function () {\n        this.removeTemporaryFile();\n    };\n    ExternalEditor.prototype.determineEditor = function () {\n        var editor = process.env.VISUAL ? process.env.VISUAL :\n            process.env.EDITOR ? process.env.EDITOR :\n                /^win/.test(process.platform) ? \"notepad\" :\n                    \"vim\";\n        var editorOpts = ExternalEditor.splitStringBySpace(editor).map(function (piece) { return piece.replace(\"\\\\ \", \" \"); });\n        var bin = editorOpts.shift();\n        this.editor = { args: editorOpts, bin: bin };\n    };\n    ExternalEditor.prototype.createTemporaryFile = function () {\n        try {\n            this.tempFile = tmp_1.tmpNameSync(this.fileOptions);\n            var opt = { encoding: \"utf8\" };\n            if (this.fileOptions.hasOwnProperty(\"mode\")) {\n                opt.mode = this.fileOptions.mode;\n            }\n            fs_1.writeFileSync(this.tempFile, this.text, opt);\n        }\n        catch (createFileError) {\n            throw new CreateFileError_1.CreateFileError(createFileError);\n        }\n    };\n    ExternalEditor.prototype.readTemporaryFile = function () {\n        try {\n            var tempFileBuffer = fs_1.readFileSync(this.tempFile);\n            if (tempFileBuffer.length === 0) {\n                this.text = \"\";\n            }\n            else {\n                var encoding = chardet_1.detect(tempFileBuffer).toString();\n                if (!iconv_lite_1.encodingExists(encoding)) {\n                    // Probably a bad idea, but will at least prevent crashing\n                    encoding = \"utf8\";\n                }\n                this.text = iconv_lite_1.decode(tempFileBuffer, encoding);\n            }\n        }\n        catch (readFileError) {\n            throw new ReadFileError_1.ReadFileError(readFileError);\n        }\n    };\n    ExternalEditor.prototype.removeTemporaryFile = function () {\n        try {\n            fs_1.unlinkSync(this.tempFile);\n        }\n        catch (removeFileError) {\n            throw new RemoveFileError_1.RemoveFileError(removeFileError);\n        }\n    };\n    ExternalEditor.prototype.launchEditor = function () {\n        try {\n            var editorProcess = child_process_1.spawnSync(this.editor.bin, this.editor.args.concat([this.tempFile]), { stdio: \"inherit\" });\n            this.lastExitStatus = editorProcess.status;\n        }\n        catch (launchError) {\n            throw new LaunchEditorError_1.LaunchEditorError(launchError);\n        }\n    };\n    ExternalEditor.prototype.launchEditorAsync = function (callback) {\n        var _this = this;\n        try {\n            var editorProcess = child_process_1.spawn(this.editor.bin, this.editor.args.concat([this.tempFile]), { stdio: \"inherit\" });\n            editorProcess.on(\"exit\", function (code) {\n                _this.lastExitStatus = code;\n                setImmediate(callback);\n            });\n        }\n        catch (launchError) {\n            throw new LaunchEditorError_1.LaunchEditorError(launchError);\n        }\n    };\n    return ExternalEditor;\n}());\nexports.ExternalEditor = ExternalEditor;\n"]},"metadata":{},"sourceType":"script"}