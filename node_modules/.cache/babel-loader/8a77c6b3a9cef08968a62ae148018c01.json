{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.promptForMinInstances = exports.promptForFunctionDeletion = exports.promptForFailurePolicies = void 0;\n\nconst clc = require(\"cli-color\");\n\nconst functionsDeployHelper_1 = require(\"./functionsDeployHelper\");\n\nconst error_1 = require(\"../../error\");\n\nconst prompt_1 = require(\"../../prompt\");\n\nconst logger_1 = require(\"../../logger\");\n\nconst backend = require(\"./backend\");\n\nconst pricing = require(\"./pricing\");\n\nconst utils = require(\"../../utils\");\n\nfunction compareFunctions(left, right) {\n  if (left.platform != right.platform) {\n    return right.platform < left.platform ? -1 : 1;\n  }\n\n  if (left.region < right.region) {\n    return -1;\n  }\n\n  if (left.region > right.region) {\n    return 1;\n  }\n\n  if (left.id < right.id) {\n    return -1;\n  }\n\n  if (left.id > right.id) {\n    return 1;\n  }\n\n  return 0;\n}\n\nasync function promptForFailurePolicies(options, want, have) {\n  const retryFunctions = want.filter(fn => {\n    return backend.isEventTrigger(fn.trigger) && fn.trigger.retry;\n  });\n\n  if (retryFunctions.length === 0) {\n    return;\n  }\n\n  const existingRetryFunctions = have.filter(fn => {\n    return backend.isEventTrigger(fn.trigger) && fn.trigger.retry;\n  });\n  const newRetryFunctions = retryFunctions.filter(fn => {\n    return !existingRetryFunctions.some(backend.sameFunctionName(fn));\n  });\n\n  if (newRetryFunctions.length == 0) {\n    return;\n  }\n\n  const warnMessage = \"The following functions will newly be retried in case of failure: \" + clc.bold(newRetryFunctions.sort(compareFunctions).map(functionsDeployHelper_1.getFunctionLabel).join(\", \")) + \". \" + \"Retried executions are billed as any other execution, and functions are retried repeatedly until they either successfully execute or the maximum retry period has elapsed, which can be up to 7 days. \" + \"For safety, you might want to ensure that your functions are idempotent; see https://firebase.google.com/docs/functions/retries to learn more.\";\n  utils.logLabeledWarning(\"functions\", warnMessage);\n\n  if (options.force) {\n    return;\n  }\n\n  if (options.nonInteractive) {\n    throw new error_1.FirebaseError(\"Pass the --force option to deploy functions with a failure policy\", {\n      exit: 1\n    });\n  }\n\n  const proceed = await prompt_1.promptOnce({\n    type: \"confirm\",\n    name: \"confirm\",\n    default: false,\n    message: \"Would you like to proceed with deployment?\"\n  });\n\n  if (!proceed) {\n    throw new error_1.FirebaseError(\"Deployment canceled.\", {\n      exit: 1\n    });\n  }\n}\n\nexports.promptForFailurePolicies = promptForFailurePolicies;\n\nasync function promptForFunctionDeletion(functionsToDelete, force, nonInteractive) {\n  let shouldDeleteFns = true;\n\n  if (functionsToDelete.length === 0 || force) {\n    return true;\n  }\n\n  const deleteList = functionsToDelete.sort(compareFunctions).map(fn => \"\\t\" + functionsDeployHelper_1.getFunctionLabel(fn)).join(\"\\n\");\n\n  if (nonInteractive) {\n    const deleteCommands = functionsToDelete.map(func => {\n      return \"\\tfirebase functions:delete \" + func.id + \" --region \" + func.region;\n    }).join(\"\\n\");\n    throw new error_1.FirebaseError(\"The following functions are found in your project but do not exist in your local source code:\\n\" + deleteList + \"\\n\\nAborting because deletion cannot proceed in non-interactive mode. To fix, manually delete the functions by running:\\n\" + clc.bold(deleteCommands));\n  } else {\n    logger_1.logger.info(\"\\nThe following functions are found in your project but do not exist in your local source code:\\n\" + deleteList + \"\\n\\nIf you are renaming a function or changing its region, it is recommended that you create the new \" + \"function first before deleting the old one to prevent event loss. For more info, visit \" + clc.underline(\"https://firebase.google.com/docs/functions/manage-functions#modify\" + \"\\n\"));\n    shouldDeleteFns = await prompt_1.promptOnce({\n      type: \"confirm\",\n      name: \"confirm\",\n      default: false,\n      message: \"Would you like to proceed with deletion? Selecting no will continue the rest of the deployments.\"\n    });\n  }\n\n  return shouldDeleteFns;\n}\n\nexports.promptForFunctionDeletion = promptForFunctionDeletion;\n\nasync function promptForMinInstances(options, want, have) {\n  if (options.force) {\n    return;\n  }\n\n  const increasesCost = want.some(wantFn => {\n    if (!pricing.canCalculateMinInstanceCost(wantFn)) {\n      return true;\n    }\n\n    const wantCost = pricing.monthlyMinInstanceCost([wantFn]);\n    const haveFn = have.find(backend.sameFunctionName(wantFn));\n    let haveCost;\n\n    if (!haveFn) {\n      haveCost = 0;\n    } else if (!pricing.canCalculateMinInstanceCost(wantFn)) {\n      return true;\n    } else {\n      haveCost = pricing.monthlyMinInstanceCost([haveFn]);\n    }\n\n    return wantCost > haveCost;\n  });\n\n  if (!increasesCost) {\n    return;\n  }\n\n  if (options.nonInteractive) {\n    throw new error_1.FirebaseError(\"Pass the --force option to deploy functions that increase the minimum bill\", {\n      exit: 1\n    });\n  }\n\n  const functionLines = want.filter(fn => fn.minInstances).sort(compareFunctions).map(fn => {\n    return `\\t${functionsDeployHelper_1.getFunctionLabel(fn)}: ${fn.minInstances} instances, ` + backend.memoryOptionDisplayName(fn.availableMemoryMb || 256) + \" of memory each\";\n  }).join(\"\\n\");\n  let costLine;\n\n  if (want.some(fn => !pricing.canCalculateMinInstanceCost(fn))) {\n    costLine = \"Cannot calculate the minimum monthly bill for this configuration. Consider running \" + clc.bold(\"npm install -g firebase-tools\");\n  } else {\n    const cost = pricing.monthlyMinInstanceCost(want).toFixed(2);\n    costLine = `With these options, your minimum bill will be $${cost} in a 30-day month`;\n  }\n\n  let cudAnnotation = \"\";\n\n  if (want.some(fn => fn.platform == \"gcfv2\" && fn.minInstances)) {\n    cudAnnotation = \"\\nThis bill can be lowered with a one year commitment. See https://cloud.google.com/run/cud for more\";\n  }\n\n  const warnMessage = \"The following functions have reserved minimum instances. This will \" + \"reduce the frequency of cold starts but increases the minimum cost. \" + \"You will be charged for the memory allocation and a fraction of the \" + \"CPU allocation of instances while they are idle.\\n\\n\" + functionLines + \"\\n\\n\" + costLine + cudAnnotation;\n  utils.logLabeledWarning(\"functions\", warnMessage);\n  const proceed = await prompt_1.promptOnce({\n    type: \"confirm\",\n    name: \"confirm\",\n    default: false,\n    message: \"Would you like to proceed with deployment?\"\n  });\n\n  if (!proceed) {\n    throw new error_1.FirebaseError(\"Deployment canceled.\", {\n      exit: 1\n    });\n  }\n}\n\nexports.promptForMinInstances = promptForMinInstances;","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/firebase-tools/lib/deploy/functions/prompts.js"],"names":["Object","defineProperty","exports","value","promptForMinInstances","promptForFunctionDeletion","promptForFailurePolicies","clc","require","functionsDeployHelper_1","error_1","prompt_1","logger_1","backend","pricing","utils","compareFunctions","left","right","platform","region","id","options","want","have","retryFunctions","filter","fn","isEventTrigger","trigger","retry","length","existingRetryFunctions","newRetryFunctions","some","sameFunctionName","warnMessage","bold","sort","map","getFunctionLabel","join","logLabeledWarning","force","nonInteractive","FirebaseError","exit","proceed","promptOnce","type","name","default","message","functionsToDelete","shouldDeleteFns","deleteList","deleteCommands","func","logger","info","underline","increasesCost","wantFn","canCalculateMinInstanceCost","wantCost","monthlyMinInstanceCost","haveFn","find","haveCost","functionLines","minInstances","memoryOptionDisplayName","availableMemoryMb","costLine","cost","toFixed","cudAnnotation"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.promptForMinInstances = exports.promptForFunctionDeletion = exports.promptForFailurePolicies = void 0;\nconst clc = require(\"cli-color\");\nconst functionsDeployHelper_1 = require(\"./functionsDeployHelper\");\nconst error_1 = require(\"../../error\");\nconst prompt_1 = require(\"../../prompt\");\nconst logger_1 = require(\"../../logger\");\nconst backend = require(\"./backend\");\nconst pricing = require(\"./pricing\");\nconst utils = require(\"../../utils\");\nfunction compareFunctions(left, right) {\n    if (left.platform != right.platform) {\n        return right.platform < left.platform ? -1 : 1;\n    }\n    if (left.region < right.region) {\n        return -1;\n    }\n    if (left.region > right.region) {\n        return 1;\n    }\n    if (left.id < right.id) {\n        return -1;\n    }\n    if (left.id > right.id) {\n        return 1;\n    }\n    return 0;\n}\nasync function promptForFailurePolicies(options, want, have) {\n    const retryFunctions = want.filter((fn) => {\n        return backend.isEventTrigger(fn.trigger) && fn.trigger.retry;\n    });\n    if (retryFunctions.length === 0) {\n        return;\n    }\n    const existingRetryFunctions = have.filter((fn) => {\n        return backend.isEventTrigger(fn.trigger) && fn.trigger.retry;\n    });\n    const newRetryFunctions = retryFunctions.filter((fn) => {\n        return !existingRetryFunctions.some(backend.sameFunctionName(fn));\n    });\n    if (newRetryFunctions.length == 0) {\n        return;\n    }\n    const warnMessage = \"The following functions will newly be retried in case of failure: \" +\n        clc.bold(newRetryFunctions.sort(compareFunctions).map(functionsDeployHelper_1.getFunctionLabel).join(\", \")) +\n        \". \" +\n        \"Retried executions are billed as any other execution, and functions are retried repeatedly until they either successfully execute or the maximum retry period has elapsed, which can be up to 7 days. \" +\n        \"For safety, you might want to ensure that your functions are idempotent; see https://firebase.google.com/docs/functions/retries to learn more.\";\n    utils.logLabeledWarning(\"functions\", warnMessage);\n    if (options.force) {\n        return;\n    }\n    if (options.nonInteractive) {\n        throw new error_1.FirebaseError(\"Pass the --force option to deploy functions with a failure policy\", {\n            exit: 1,\n        });\n    }\n    const proceed = await prompt_1.promptOnce({\n        type: \"confirm\",\n        name: \"confirm\",\n        default: false,\n        message: \"Would you like to proceed with deployment?\",\n    });\n    if (!proceed) {\n        throw new error_1.FirebaseError(\"Deployment canceled.\", { exit: 1 });\n    }\n}\nexports.promptForFailurePolicies = promptForFailurePolicies;\nasync function promptForFunctionDeletion(functionsToDelete, force, nonInteractive) {\n    let shouldDeleteFns = true;\n    if (functionsToDelete.length === 0 || force) {\n        return true;\n    }\n    const deleteList = functionsToDelete\n        .sort(compareFunctions)\n        .map((fn) => \"\\t\" + functionsDeployHelper_1.getFunctionLabel(fn))\n        .join(\"\\n\");\n    if (nonInteractive) {\n        const deleteCommands = functionsToDelete\n            .map((func) => {\n            return \"\\tfirebase functions:delete \" + func.id + \" --region \" + func.region;\n        })\n            .join(\"\\n\");\n        throw new error_1.FirebaseError(\"The following functions are found in your project but do not exist in your local source code:\\n\" +\n            deleteList +\n            \"\\n\\nAborting because deletion cannot proceed in non-interactive mode. To fix, manually delete the functions by running:\\n\" +\n            clc.bold(deleteCommands));\n    }\n    else {\n        logger_1.logger.info(\"\\nThe following functions are found in your project but do not exist in your local source code:\\n\" +\n            deleteList +\n            \"\\n\\nIf you are renaming a function or changing its region, it is recommended that you create the new \" +\n            \"function first before deleting the old one to prevent event loss. For more info, visit \" +\n            clc.underline(\"https://firebase.google.com/docs/functions/manage-functions#modify\" + \"\\n\"));\n        shouldDeleteFns = await prompt_1.promptOnce({\n            type: \"confirm\",\n            name: \"confirm\",\n            default: false,\n            message: \"Would you like to proceed with deletion? Selecting no will continue the rest of the deployments.\",\n        });\n    }\n    return shouldDeleteFns;\n}\nexports.promptForFunctionDeletion = promptForFunctionDeletion;\nasync function promptForMinInstances(options, want, have) {\n    if (options.force) {\n        return;\n    }\n    const increasesCost = want.some((wantFn) => {\n        if (!pricing.canCalculateMinInstanceCost(wantFn)) {\n            return true;\n        }\n        const wantCost = pricing.monthlyMinInstanceCost([wantFn]);\n        const haveFn = have.find(backend.sameFunctionName(wantFn));\n        let haveCost;\n        if (!haveFn) {\n            haveCost = 0;\n        }\n        else if (!pricing.canCalculateMinInstanceCost(wantFn)) {\n            return true;\n        }\n        else {\n            haveCost = pricing.monthlyMinInstanceCost([haveFn]);\n        }\n        return wantCost > haveCost;\n    });\n    if (!increasesCost) {\n        return;\n    }\n    if (options.nonInteractive) {\n        throw new error_1.FirebaseError(\"Pass the --force option to deploy functions that increase the minimum bill\", {\n            exit: 1,\n        });\n    }\n    const functionLines = want\n        .filter((fn) => fn.minInstances)\n        .sort(compareFunctions)\n        .map((fn) => {\n        return (`\\t${functionsDeployHelper_1.getFunctionLabel(fn)}: ${fn.minInstances} instances, ` +\n            backend.memoryOptionDisplayName(fn.availableMemoryMb || 256) +\n            \" of memory each\");\n    })\n        .join(\"\\n\");\n    let costLine;\n    if (want.some((fn) => !pricing.canCalculateMinInstanceCost(fn))) {\n        costLine =\n            \"Cannot calculate the minimum monthly bill for this configuration. Consider running \" +\n                clc.bold(\"npm install -g firebase-tools\");\n    }\n    else {\n        const cost = pricing.monthlyMinInstanceCost(want).toFixed(2);\n        costLine = `With these options, your minimum bill will be $${cost} in a 30-day month`;\n    }\n    let cudAnnotation = \"\";\n    if (want.some((fn) => fn.platform == \"gcfv2\" && fn.minInstances)) {\n        cudAnnotation =\n            \"\\nThis bill can be lowered with a one year commitment. See https://cloud.google.com/run/cud for more\";\n    }\n    const warnMessage = \"The following functions have reserved minimum instances. This will \" +\n        \"reduce the frequency of cold starts but increases the minimum cost. \" +\n        \"You will be charged for the memory allocation and a fraction of the \" +\n        \"CPU allocation of instances while they are idle.\\n\\n\" +\n        functionLines +\n        \"\\n\\n\" +\n        costLine +\n        cudAnnotation;\n    utils.logLabeledWarning(\"functions\", warnMessage);\n    const proceed = await prompt_1.promptOnce({\n        type: \"confirm\",\n        name: \"confirm\",\n        default: false,\n        message: \"Would you like to proceed with deployment?\",\n    });\n    if (!proceed) {\n        throw new error_1.FirebaseError(\"Deployment canceled.\", { exit: 1 });\n    }\n}\nexports.promptForMinInstances = promptForMinInstances;\n"]},"metadata":{},"sourceType":"script"}