{"ast":null,"code":"\"use strict\";\n\nconst {\n  logger\n} = require(\"../logger\");\n\nvar api = require(\"../api\");\n\nvar clc = require(\"cli-color\");\n\nvar _ = require(\"lodash\");\n\nvar needProjectId = require(\"../projectUtils\").needProjectId;\n\nvar utils = require(\"../utils\");\n\nvar {\n  FirebaseError\n} = require(\"../error\");\n\nvar track = require(\"../track\");\n\nvar lifecycleHooks = require(\"./lifecycleHooks\");\n\nvar TARGETS = {\n  hosting: require(\"./hosting\"),\n  database: require(\"./database\"),\n  firestore: require(\"./firestore\"),\n  functions: require(\"./functions\"),\n  storage: require(\"./storage\"),\n  remoteconfig: require(\"./remoteconfig\")\n};\n\nvar _noop = function () {\n  return Promise.resolve();\n};\n\nvar _chain = function (fns, context, options, payload) {\n  var latest = (fns.shift() || _noop)(context, options, payload);\n\n  if (fns.length) {\n    return latest.then(function () {\n      return _chain(fns, context, options, payload);\n    });\n  }\n\n  return latest;\n};\n\nvar deploy = function (targetNames, options, customContext = {}) {\n  var projectId = needProjectId(options);\n  var payload = {};\n  var context = Object.assign({\n    projectId\n  }, customContext);\n  var predeploys = [];\n  var prepares = [];\n  var deploys = [];\n  var releases = [];\n  var postdeploys = [];\n\n  for (var i = 0; i < targetNames.length; i++) {\n    var targetName = targetNames[i];\n    var target = TARGETS[targetName];\n\n    if (!target) {\n      return Promise.reject(new FirebaseError(clc.bold(targetName) + \" is not a valid deploy target\", {\n        exit: 1\n      }));\n    }\n\n    predeploys.push(lifecycleHooks(targetName, \"predeploy\"));\n\n    if (target.prepare) {\n      prepares.push(target.prepare);\n    }\n\n    if (target.deploy) {\n      deploys.push(target.deploy);\n    }\n\n    if (target.release) {\n      releases.push(target.release);\n    }\n\n    postdeploys.push(lifecycleHooks(targetName, \"postdeploy\"));\n  }\n\n  logger.info();\n  logger.info(clc.bold(clc.white(\"===\") + \" Deploying to '\" + projectId + \"'...\"));\n  logger.info();\n  utils.logBullet(\"deploying \" + clc.bold(targetNames.join(\", \")));\n  return _chain(predeploys, context, options, payload).then(function () {\n    return _chain(prepares, context, options, payload);\n  }).then(function () {\n    return _chain(deploys, context, options, payload);\n  }).then(function () {\n    return _chain(releases, context, options, payload);\n  }).then(function () {\n    return _chain(postdeploys, context, options, payload);\n  }).then(function () {\n    if (_.has(options, \"config.notes.databaseRules\")) {\n      track(\"Rules Deploy\", options.config.notes.databaseRules);\n    }\n\n    logger.info();\n    utils.logSuccess(clc.underline.bold(\"Deploy complete!\"));\n    logger.info();\n\n    var deployedHosting = _.includes(targetNames, \"hosting\");\n\n    logger.info(clc.bold(\"Project Console:\"), utils.consoleUrl(options.project, \"/overview\"));\n\n    if (deployedHosting) {\n      _.each(context.hosting.deploys, function (deploy) {\n        logger.info(clc.bold(\"Hosting URL:\"), utils.addSubdomain(api.hostingOrigin, deploy.site));\n      });\n\n      const versionNames = context.hosting.deploys.map(deploy => deploy.version);\n      return {\n        hosting: versionNames.length === 1 ? versionNames[0] : versionNames\n      };\n    }\n  });\n};\n\ndeploy.TARGETS = TARGETS;\nmodule.exports = deploy;","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/firebase-tools/lib/deploy/index.js"],"names":["logger","require","api","clc","_","needProjectId","utils","FirebaseError","track","lifecycleHooks","TARGETS","hosting","database","firestore","functions","storage","remoteconfig","_noop","Promise","resolve","_chain","fns","context","options","payload","latest","shift","length","then","deploy","targetNames","customContext","projectId","Object","assign","predeploys","prepares","deploys","releases","postdeploys","i","targetName","target","reject","bold","exit","push","prepare","release","info","white","logBullet","join","has","config","notes","databaseRules","logSuccess","underline","deployedHosting","includes","consoleUrl","project","each","addSubdomain","hostingOrigin","site","versionNames","map","version","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\nconst { logger } = require(\"../logger\");\nvar api = require(\"../api\");\nvar clc = require(\"cli-color\");\nvar _ = require(\"lodash\");\nvar needProjectId = require(\"../projectUtils\").needProjectId;\nvar utils = require(\"../utils\");\nvar { FirebaseError } = require(\"../error\");\nvar track = require(\"../track\");\nvar lifecycleHooks = require(\"./lifecycleHooks\");\nvar TARGETS = {\n    hosting: require(\"./hosting\"),\n    database: require(\"./database\"),\n    firestore: require(\"./firestore\"),\n    functions: require(\"./functions\"),\n    storage: require(\"./storage\"),\n    remoteconfig: require(\"./remoteconfig\"),\n};\nvar _noop = function () {\n    return Promise.resolve();\n};\nvar _chain = function (fns, context, options, payload) {\n    var latest = (fns.shift() || _noop)(context, options, payload);\n    if (fns.length) {\n        return latest.then(function () {\n            return _chain(fns, context, options, payload);\n        });\n    }\n    return latest;\n};\nvar deploy = function (targetNames, options, customContext = {}) {\n    var projectId = needProjectId(options);\n    var payload = {};\n    var context = Object.assign({ projectId }, customContext);\n    var predeploys = [];\n    var prepares = [];\n    var deploys = [];\n    var releases = [];\n    var postdeploys = [];\n    for (var i = 0; i < targetNames.length; i++) {\n        var targetName = targetNames[i];\n        var target = TARGETS[targetName];\n        if (!target) {\n            return Promise.reject(new FirebaseError(clc.bold(targetName) + \" is not a valid deploy target\", { exit: 1 }));\n        }\n        predeploys.push(lifecycleHooks(targetName, \"predeploy\"));\n        if (target.prepare) {\n            prepares.push(target.prepare);\n        }\n        if (target.deploy) {\n            deploys.push(target.deploy);\n        }\n        if (target.release) {\n            releases.push(target.release);\n        }\n        postdeploys.push(lifecycleHooks(targetName, \"postdeploy\"));\n    }\n    logger.info();\n    logger.info(clc.bold(clc.white(\"===\") + \" Deploying to '\" + projectId + \"'...\"));\n    logger.info();\n    utils.logBullet(\"deploying \" + clc.bold(targetNames.join(\", \")));\n    return _chain(predeploys, context, options, payload)\n        .then(function () {\n        return _chain(prepares, context, options, payload);\n    })\n        .then(function () {\n        return _chain(deploys, context, options, payload);\n    })\n        .then(function () {\n        return _chain(releases, context, options, payload);\n    })\n        .then(function () {\n        return _chain(postdeploys, context, options, payload);\n    })\n        .then(function () {\n        if (_.has(options, \"config.notes.databaseRules\")) {\n            track(\"Rules Deploy\", options.config.notes.databaseRules);\n        }\n        logger.info();\n        utils.logSuccess(clc.underline.bold(\"Deploy complete!\"));\n        logger.info();\n        var deployedHosting = _.includes(targetNames, \"hosting\");\n        logger.info(clc.bold(\"Project Console:\"), utils.consoleUrl(options.project, \"/overview\"));\n        if (deployedHosting) {\n            _.each(context.hosting.deploys, function (deploy) {\n                logger.info(clc.bold(\"Hosting URL:\"), utils.addSubdomain(api.hostingOrigin, deploy.site));\n            });\n            const versionNames = context.hosting.deploys.map((deploy) => deploy.version);\n            return { hosting: versionNames.length === 1 ? versionNames[0] : versionNames };\n        }\n    });\n};\ndeploy.TARGETS = TARGETS;\nmodule.exports = deploy;\n"]},"metadata":{},"sourceType":"script"}