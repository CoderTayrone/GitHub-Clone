{"ast":null,"code":"\"use strict\";\n\nvar _ = require(\"lodash\");\n\nvar clc = require(\"cli-color\");\n\nvar {\n  FirebaseError\n} = require(\"./error\");\n\nvar functionsConfig = require(\"./functionsConfig\");\n\nvar runtimeconfig = require(\"./gcp/runtimeconfig\");\n\nvar _matchPrefix = function (short, long) {\n  if (short.length > long.length) {\n    return false;\n  }\n\n  return _.reduce(short, function (accum, x, i) {\n    return accum && x === long[i];\n  }, true);\n};\n\nvar _applyExcept = function (json, except) {\n  _.forEach(except, function (key) {\n    _.unset(json, key);\n  });\n};\n\nvar _cloneVariable = function (varName, toProject) {\n  return runtimeconfig.variables.get(varName).then(function (variable) {\n    var id = functionsConfig.varNameToIds(variable.name);\n    return runtimeconfig.variables.set(toProject, id.config, id.variable, variable.text);\n  });\n};\n\nvar _cloneConfig = function (configName, toProject) {\n  return runtimeconfig.variables.list(configName).then(function (variables) {\n    return Promise.all(_.map(variables, function (variable) {\n      return _cloneVariable(variable.name, toProject);\n    }));\n  });\n};\n\nvar _cloneConfigOrVariable = function (key, fromProject, toProject) {\n  var parts = key.split(\".\");\n\n  if (_.includes(functionsConfig.RESERVED_NAMESPACES, parts[0])) {\n    throw new FirebaseError(\"Cannot clone reserved namespace \" + clc.bold(parts[0]));\n  }\n\n  var configName = _.join([\"projects\", fromProject, \"configs\", parts[0]], \"/\");\n\n  if (parts.length === 1) {\n    return _cloneConfig(configName, toProject);\n  }\n\n  return runtimeconfig.variables.list(configName).then(function (variables) {\n    var promises = [];\n\n    _.forEach(variables, function (variable) {\n      var varId = functionsConfig.varNameToIds(variable.name).variable;\n      var variablePrefixFilter = parts.slice(1);\n\n      if (_matchPrefix(variablePrefixFilter, varId.split(\"/\"))) {\n        promises.push(_cloneVariable(variable.name, toProject));\n      }\n    });\n\n    return Promise.all(promises);\n  });\n};\n\nmodule.exports = function (fromProject, toProject, only, except) {\n  except = except || [];\n\n  if (only) {\n    return Promise.all(_.map(only, function (key) {\n      return _cloneConfigOrVariable(key, fromProject, toProject);\n    }));\n  }\n\n  return functionsConfig.materializeAll(fromProject).then(function (toClone) {\n    _.unset(toClone, \"firebase\");\n\n    _applyExcept(toClone, except);\n\n    return Promise.all(_.map(toClone, function (val, configId) {\n      return functionsConfig.setVariablesRecursive(toProject, configId, \"\", val);\n    }));\n  });\n};","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/firebase-tools/lib/functionsConfigClone.js"],"names":["_","require","clc","FirebaseError","functionsConfig","runtimeconfig","_matchPrefix","short","long","length","reduce","accum","x","i","_applyExcept","json","except","forEach","key","unset","_cloneVariable","varName","toProject","variables","get","then","variable","id","varNameToIds","name","set","config","text","_cloneConfig","configName","list","Promise","all","map","_cloneConfigOrVariable","fromProject","parts","split","includes","RESERVED_NAMESPACES","bold","join","promises","varId","variablePrefixFilter","slice","push","module","exports","only","materializeAll","toClone","val","configId","setVariablesRecursive"],"mappings":"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","sourcesContent":["\"use strict\";\nvar _ = require(\"lodash\");\nvar clc = require(\"cli-color\");\nvar { FirebaseError } = require(\"./error\");\nvar functionsConfig = require(\"./functionsConfig\");\nvar runtimeconfig = require(\"./gcp/runtimeconfig\");\nvar _matchPrefix = function (short, long) {\n    if (short.length > long.length) {\n        return false;\n    }\n    return _.reduce(short, function (accum, x, i) {\n        return accum && x === long[i];\n    }, true);\n};\nvar _applyExcept = function (json, except) {\n    _.forEach(except, function (key) {\n        _.unset(json, key);\n    });\n};\nvar _cloneVariable = function (varName, toProject) {\n    return runtimeconfig.variables.get(varName).then(function (variable) {\n        var id = functionsConfig.varNameToIds(variable.name);\n        return runtimeconfig.variables.set(toProject, id.config, id.variable, variable.text);\n    });\n};\nvar _cloneConfig = function (configName, toProject) {\n    return runtimeconfig.variables.list(configName).then(function (variables) {\n        return Promise.all(_.map(variables, function (variable) {\n            return _cloneVariable(variable.name, toProject);\n        }));\n    });\n};\nvar _cloneConfigOrVariable = function (key, fromProject, toProject) {\n    var parts = key.split(\".\");\n    if (_.includes(functionsConfig.RESERVED_NAMESPACES, parts[0])) {\n        throw new FirebaseError(\"Cannot clone reserved namespace \" + clc.bold(parts[0]));\n    }\n    var configName = _.join([\"projects\", fromProject, \"configs\", parts[0]], \"/\");\n    if (parts.length === 1) {\n        return _cloneConfig(configName, toProject);\n    }\n    return runtimeconfig.variables.list(configName).then(function (variables) {\n        var promises = [];\n        _.forEach(variables, function (variable) {\n            var varId = functionsConfig.varNameToIds(variable.name).variable;\n            var variablePrefixFilter = parts.slice(1);\n            if (_matchPrefix(variablePrefixFilter, varId.split(\"/\"))) {\n                promises.push(_cloneVariable(variable.name, toProject));\n            }\n        });\n        return Promise.all(promises);\n    });\n};\nmodule.exports = function (fromProject, toProject, only, except) {\n    except = except || [];\n    if (only) {\n        return Promise.all(_.map(only, function (key) {\n            return _cloneConfigOrVariable(key, fromProject, toProject);\n        }));\n    }\n    return functionsConfig.materializeAll(fromProject).then(function (toClone) {\n        _.unset(toClone, \"firebase\");\n        _applyExcept(toClone, except);\n        return Promise.all(_.map(toClone, function (val, configId) {\n            return functionsConfig.setVariablesRecursive(toProject, configId, \"\", val);\n        }));\n    });\n};\n"]},"metadata":{},"sourceType":"script"}