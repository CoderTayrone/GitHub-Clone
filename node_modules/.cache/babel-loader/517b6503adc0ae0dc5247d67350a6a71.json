{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst command_1 = require(\"../command\");\n\nconst error_1 = require(\"../error\");\n\nconst prompt_1 = require(\"../prompt\");\n\nconst requireAuth_1 = require(\"../requireAuth\");\n\nconst rollback_1 = require(\"../remoteconfig/rollback\");\n\nconst requirePermissions_1 = require(\"../requirePermissions\");\n\nconst versionslist_1 = require(\"../remoteconfig/versionslist\");\n\nconst projectUtils_1 = require(\"../projectUtils\");\n\nmodule.exports = new command_1.Command(\"remoteconfig:rollback\").description(\"roll back a project's published Remote Config template to the one specified by the provided version number\").before(requireAuth_1.requireAuth).before(requirePermissions_1.requirePermissions, [\"cloudconfig.configs.get\", \"cloudconfig.configs.update\"]).option(\"-v, --version-number <versionNumber>\", \"rollback to the specified version of the template\").withForce().action(async options => {\n  var _a;\n\n  const templateVersion = await versionslist_1.getVersions(projectUtils_1.needProjectId(options), 1);\n  let targetVersion = 0;\n\n  if (options.versionNumber) {\n    targetVersion = options.versionNumber;\n  } else {\n    if ((_a = templateVersion === null || templateVersion === void 0 ? void 0 : templateVersion.versions[0]) === null || _a === void 0 ? void 0 : _a.versionNumber) {\n      const latestVersion = templateVersion.versions[0].versionNumber.toString();\n      const previousVersion = parseInt(latestVersion) - 1;\n      targetVersion = previousVersion;\n    }\n  }\n\n  if (targetVersion <= 0) {\n    throw new error_1.FirebaseError(`Failed to rollback Firebase Remote Config template for project to version` + targetVersion + `. ` + `Invalid Version Number`);\n  }\n\n  const confirm = await prompt_1.promptOnce({\n    type: \"confirm\",\n    name: \"force\",\n    message: \"Proceed to rollback template to version \" + targetVersion + \"?\",\n    default: false\n  }, options);\n\n  if (!confirm) {\n    return;\n  }\n\n  return rollback_1.rollbackTemplate(projectUtils_1.needProjectId(options), targetVersion);\n});","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/firebase-tools/lib/commands/remoteconfig-rollback.js"],"names":["Object","defineProperty","exports","value","command_1","require","error_1","prompt_1","requireAuth_1","rollback_1","requirePermissions_1","versionslist_1","projectUtils_1","module","Command","description","before","requireAuth","requirePermissions","option","withForce","action","options","_a","templateVersion","getVersions","needProjectId","targetVersion","versionNumber","versions","latestVersion","toString","previousVersion","parseInt","FirebaseError","confirm","promptOnce","type","name","message","default","rollbackTemplate"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,MAAMC,SAAS,GAAGC,OAAO,CAAC,YAAD,CAAzB;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAC,UAAD,CAAvB;;AACA,MAAME,QAAQ,GAAGF,OAAO,CAAC,WAAD,CAAxB;;AACA,MAAMG,aAAa,GAAGH,OAAO,CAAC,gBAAD,CAA7B;;AACA,MAAMI,UAAU,GAAGJ,OAAO,CAAC,0BAAD,CAA1B;;AACA,MAAMK,oBAAoB,GAAGL,OAAO,CAAC,uBAAD,CAApC;;AACA,MAAMM,cAAc,GAAGN,OAAO,CAAC,8BAAD,CAA9B;;AACA,MAAMO,cAAc,GAAGP,OAAO,CAAC,iBAAD,CAA9B;;AACAQ,MAAM,CAACX,OAAP,GAAiB,IAAIE,SAAS,CAACU,OAAd,CAAsB,uBAAtB,EACZC,WADY,CACA,4GADA,EAEZC,MAFY,CAELR,aAAa,CAACS,WAFT,EAGZD,MAHY,CAGLN,oBAAoB,CAACQ,kBAHhB,EAGoC,CAAC,yBAAD,EAA4B,4BAA5B,CAHpC,EAIZC,MAJY,CAIL,sCAJK,EAImC,mDAJnC,EAKZC,SALY,GAMZC,MANY,CAML,MAAOC,OAAP,IAAmB;AAC3B,MAAIC,EAAJ;;AACA,QAAMC,eAAe,GAAG,MAAMb,cAAc,CAACc,WAAf,CAA2Bb,cAAc,CAACc,aAAf,CAA6BJ,OAA7B,CAA3B,EAAkE,CAAlE,CAA9B;AACA,MAAIK,aAAa,GAAG,CAApB;;AACA,MAAIL,OAAO,CAACM,aAAZ,EAA2B;AACvBD,IAAAA,aAAa,GAAGL,OAAO,CAACM,aAAxB;AACH,GAFD,MAGK;AACD,QAAI,CAACL,EAAE,GAAGC,eAAe,KAAK,IAApB,IAA4BA,eAAe,KAAK,KAAK,CAArD,GAAyD,KAAK,CAA9D,GAAkEA,eAAe,CAACK,QAAhB,CAAyB,CAAzB,CAAxE,MAAyG,IAAzG,IAAiHN,EAAE,KAAK,KAAK,CAA7H,GAAiI,KAAK,CAAtI,GAA0IA,EAAE,CAACK,aAAjJ,EAAgK;AAC5J,YAAME,aAAa,GAAGN,eAAe,CAACK,QAAhB,CAAyB,CAAzB,EAA4BD,aAA5B,CAA0CG,QAA1C,EAAtB;AACA,YAAMC,eAAe,GAAGC,QAAQ,CAACH,aAAD,CAAR,GAA0B,CAAlD;AACAH,MAAAA,aAAa,GAAGK,eAAhB;AACH;AACJ;;AACD,MAAIL,aAAa,IAAI,CAArB,EAAwB;AACpB,UAAM,IAAIrB,OAAO,CAAC4B,aAAZ,CAA2B,2EAAD,GAC5BP,aAD4B,GAE3B,IAF2B,GAG3B,wBAHC,CAAN;AAIH;;AACD,QAAMQ,OAAO,GAAG,MAAM5B,QAAQ,CAAC6B,UAAT,CAAoB;AACtCC,IAAAA,IAAI,EAAE,SADgC;AAEtCC,IAAAA,IAAI,EAAE,OAFgC;AAGtCC,IAAAA,OAAO,EAAE,6CAA6CZ,aAA7C,GAA6D,GAHhC;AAItCa,IAAAA,OAAO,EAAE;AAJ6B,GAApB,EAKnBlB,OALmB,CAAtB;;AAMA,MAAI,CAACa,OAAL,EAAc;AACV;AACH;;AACD,SAAO1B,UAAU,CAACgC,gBAAX,CAA4B7B,cAAc,CAACc,aAAf,CAA6BJ,OAA7B,CAA5B,EAAmEK,aAAnE,CAAP;AACH,CApCgB,CAAjB","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst command_1 = require(\"../command\");\nconst error_1 = require(\"../error\");\nconst prompt_1 = require(\"../prompt\");\nconst requireAuth_1 = require(\"../requireAuth\");\nconst rollback_1 = require(\"../remoteconfig/rollback\");\nconst requirePermissions_1 = require(\"../requirePermissions\");\nconst versionslist_1 = require(\"../remoteconfig/versionslist\");\nconst projectUtils_1 = require(\"../projectUtils\");\nmodule.exports = new command_1.Command(\"remoteconfig:rollback\")\n    .description(\"roll back a project's published Remote Config template to the one specified by the provided version number\")\n    .before(requireAuth_1.requireAuth)\n    .before(requirePermissions_1.requirePermissions, [\"cloudconfig.configs.get\", \"cloudconfig.configs.update\"])\n    .option(\"-v, --version-number <versionNumber>\", \"rollback to the specified version of the template\")\n    .withForce()\n    .action(async (options) => {\n    var _a;\n    const templateVersion = await versionslist_1.getVersions(projectUtils_1.needProjectId(options), 1);\n    let targetVersion = 0;\n    if (options.versionNumber) {\n        targetVersion = options.versionNumber;\n    }\n    else {\n        if ((_a = templateVersion === null || templateVersion === void 0 ? void 0 : templateVersion.versions[0]) === null || _a === void 0 ? void 0 : _a.versionNumber) {\n            const latestVersion = templateVersion.versions[0].versionNumber.toString();\n            const previousVersion = parseInt(latestVersion) - 1;\n            targetVersion = previousVersion;\n        }\n    }\n    if (targetVersion <= 0) {\n        throw new error_1.FirebaseError(`Failed to rollback Firebase Remote Config template for project to version` +\n            targetVersion +\n            `. ` +\n            `Invalid Version Number`);\n    }\n    const confirm = await prompt_1.promptOnce({\n        type: \"confirm\",\n        name: \"force\",\n        message: \"Proceed to rollback template to version \" + targetVersion + \"?\",\n        default: false,\n    }, options);\n    if (!confirm) {\n        return;\n    }\n    return rollback_1.rollbackTemplate(projectUtils_1.needProjectId(options), targetVersion);\n});\n"]},"metadata":{},"sourceType":"script"}