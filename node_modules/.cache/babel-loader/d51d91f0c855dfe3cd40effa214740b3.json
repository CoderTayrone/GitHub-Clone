{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.assertIsStringOrUndefined = exports.assertIsNumber = exports.assertIsString = exports.assertDefined = exports.thirtyDaysFromNow = exports.isRunningInWSL = exports.isCloudEnvironment = exports.datetimeString = exports.createDestroyer = exports.promiseWithSpinner = exports.setupLoggers = exports.tryParse = exports.tryStringify = exports.promiseProps = exports.promiseWhile = exports.promiseAllSettled = exports.getFunctionsEventProvider = exports.endpoint = exports.makeActiveProject = exports.streamToString = exports.stringToStream = exports.explainStdin = exports.reject = exports.logLabeledWarning = exports.logWarning = exports.logLabeledBullet = exports.logBullet = exports.logLabeledSuccess = exports.logSuccess = exports.addSubdomain = exports.addDatabaseNamespace = exports.getDatabaseViewDataUrl = exports.getDatabaseUrl = exports.envOverride = exports.getInheritedOption = exports.consoleUrl = exports.envOverrides = void 0;\n\nconst _ = require(\"lodash\");\n\nconst url = require(\"url\");\n\nconst clc = require(\"cli-color\");\n\nconst ora = require(\"ora\");\n\nconst process = require(\"process\");\n\nconst stream_1 = require(\"stream\");\n\nconst winston = require(\"winston\");\n\nconst triple_beam_1 = require(\"triple-beam\");\n\nconst assert_1 = require(\"assert\");\n\nconst ansiStrip = require(\"cli-color/strip\");\n\nconst configstore_1 = require(\"./configstore\");\n\nconst error_1 = require(\"./error\");\n\nconst logger_1 = require(\"./logger\");\n\nconst IS_WINDOWS = process.platform === \"win32\";\nconst SUCCESS_CHAR = IS_WINDOWS ? \"+\" : \"✔\";\nconst WARNING_CHAR = IS_WINDOWS ? \"!\" : \"⚠\";\nconst THIRTY_DAYS_IN_MILLISECONDS = 30 * 24 * 60 * 60 * 1000;\nexports.envOverrides = [];\n\nfunction consoleUrl(project, path) {\n  const api = require(\"./api\");\n\n  return `${api.consoleOrigin}/project/${project}${path}`;\n}\n\nexports.consoleUrl = consoleUrl;\n\nfunction getInheritedOption(options, key) {\n  let target = options;\n\n  while (target) {\n    if (_.has(target, key)) {\n      return target[key];\n    }\n\n    target = target.parent;\n  }\n}\n\nexports.getInheritedOption = getInheritedOption;\n\nfunction envOverride(envname, value, coerce) {\n  const currentEnvValue = process.env[envname];\n\n  if (currentEnvValue && currentEnvValue.length) {\n    exports.envOverrides.push(envname);\n\n    if (coerce) {\n      try {\n        return coerce(currentEnvValue, value);\n      } catch (e) {\n        return value;\n      }\n    }\n\n    return currentEnvValue;\n  }\n\n  return value;\n}\n\nexports.envOverride = envOverride;\n\nfunction getDatabaseUrl(origin, namespace, pathname) {\n  const withPath = url.resolve(origin, pathname);\n  return addDatabaseNamespace(withPath, namespace);\n}\n\nexports.getDatabaseUrl = getDatabaseUrl;\n\nfunction getDatabaseViewDataUrl(origin, project, namespace, pathname) {\n  const urlObj = new url.URL(origin);\n\n  if (urlObj.hostname.includes(\"firebaseio\") || urlObj.hostname.includes(\"firebasedatabase\")) {\n    return consoleUrl(project, `/database/${namespace}/data${pathname}`);\n  }\n\n  return getDatabaseUrl(origin, namespace, pathname + \".json\");\n}\n\nexports.getDatabaseViewDataUrl = getDatabaseViewDataUrl;\n\nfunction addDatabaseNamespace(origin, namespace) {\n  const urlObj = new url.URL(origin);\n\n  if (urlObj.hostname.includes(namespace)) {\n    return urlObj.href;\n  }\n\n  if (urlObj.hostname.includes(\"firebaseio\") || urlObj.hostname.includes(\"firebasedatabase\")) {\n    return addSubdomain(origin, namespace);\n  }\n\n  urlObj.searchParams.set(\"ns\", namespace);\n  return urlObj.href;\n}\n\nexports.addDatabaseNamespace = addDatabaseNamespace;\n\nfunction addSubdomain(origin, subdomain) {\n  return origin.replace(\"//\", `//${subdomain}.`);\n}\n\nexports.addSubdomain = addSubdomain;\n\nfunction logSuccess(message, type = \"info\", data = undefined) {\n  logger_1.logger[type](clc.green.bold(`${SUCCESS_CHAR} `), message, data);\n}\n\nexports.logSuccess = logSuccess;\n\nfunction logLabeledSuccess(label, message, type = \"info\", data = undefined) {\n  logger_1.logger[type](clc.green.bold(`${SUCCESS_CHAR}  ${label}:`), message, data);\n}\n\nexports.logLabeledSuccess = logLabeledSuccess;\n\nfunction logBullet(message, type = \"info\", data = undefined) {\n  logger_1.logger[type](clc.cyan.bold(\"i \"), message, data);\n}\n\nexports.logBullet = logBullet;\n\nfunction logLabeledBullet(label, message, type = \"info\", data = undefined) {\n  logger_1.logger[type](clc.cyan.bold(`i  ${label}:`), message, data);\n}\n\nexports.logLabeledBullet = logLabeledBullet;\n\nfunction logWarning(message, type = \"warn\", data = undefined) {\n  logger_1.logger[type](clc.yellow.bold(`${WARNING_CHAR} `), message, data);\n}\n\nexports.logWarning = logWarning;\n\nfunction logLabeledWarning(label, message, type = \"warn\", data = undefined) {\n  logger_1.logger[type](clc.yellow.bold(`${WARNING_CHAR}  ${label}:`), message, data);\n}\n\nexports.logLabeledWarning = logLabeledWarning;\n\nfunction reject(message, options) {\n  return Promise.reject(new error_1.FirebaseError(message, options));\n}\n\nexports.reject = reject;\n\nfunction explainStdin() {\n  if (IS_WINDOWS) {\n    throw new error_1.FirebaseError(\"STDIN input is not available on Windows.\", {\n      exit: 1\n    });\n  }\n\n  if (process.stdin.isTTY) {\n    logger_1.logger.info(clc.bold(\"Note:\"), \"Reading STDIN. Type JSON data and then press Ctrl-D\");\n  }\n}\n\nexports.explainStdin = explainStdin;\n\nfunction stringToStream(text) {\n  if (!text) {\n    return undefined;\n  }\n\n  const s = new stream_1.Readable();\n  s.push(text);\n  s.push(null);\n  return s;\n}\n\nexports.stringToStream = stringToStream;\n\nfunction streamToString(s) {\n  return new Promise((resolve, reject) => {\n    let b = \"\";\n    s.on(\"error\", reject);\n    s.on(\"data\", d => b += `${d}`);\n    s.once(\"end\", () => resolve(b));\n  });\n}\n\nexports.streamToString = streamToString;\n\nfunction makeActiveProject(projectDir, newActive) {\n  const activeProjects = configstore_1.configstore.get(\"activeProjects\") || {};\n\n  if (newActive) {\n    activeProjects[projectDir] = newActive;\n  } else {\n    _.unset(activeProjects, projectDir);\n  }\n\n  configstore_1.configstore.set(\"activeProjects\", activeProjects);\n}\n\nexports.makeActiveProject = makeActiveProject;\n\nfunction endpoint(parts) {\n  return `/${_.join(parts, \"/\")}`;\n}\n\nexports.endpoint = endpoint;\n\nfunction getFunctionsEventProvider(eventType) {\n  const parts = eventType.split(\"/\");\n\n  if (parts.length > 1) {\n    const provider = _.last(parts[1].split(\".\"));\n\n    return _.capitalize(provider);\n  }\n\n  if (eventType.match(/google.pubsub/)) {\n    return \"PubSub\";\n  } else if (eventType.match(/google.storage/)) {\n    return \"Storage\";\n  } else if (eventType.match(/google.analytics/)) {\n    return \"Analytics\";\n  } else if (eventType.match(/google.firebase.database/)) {\n    return \"Database\";\n  } else if (eventType.match(/google.firebase.auth/)) {\n    return \"Auth\";\n  } else if (eventType.match(/google.firebase.crashlytics/)) {\n    return \"Crashlytics\";\n  } else if (eventType.match(/google.firestore/)) {\n    return \"Firestore\";\n  }\n\n  return _.capitalize(eventType.split(\".\")[1]);\n}\n\nexports.getFunctionsEventProvider = getFunctionsEventProvider;\n\nfunction promiseAllSettled(promises) {\n  const wrappedPromises = _.map(promises, async p => {\n    try {\n      const val = await Promise.resolve(p);\n      return {\n        state: \"fulfilled\",\n        value: val\n      };\n    } catch (err) {\n      return {\n        state: \"rejected\",\n        reason: err\n      };\n    }\n  });\n\n  return Promise.all(wrappedPromises);\n}\n\nexports.promiseAllSettled = promiseAllSettled;\n\nasync function promiseWhile(action, check, interval = 2500) {\n  return new Promise((resolve, promiseReject) => {\n    const run = async () => {\n      try {\n        const res = await action();\n\n        if (check(res)) {\n          return resolve(res);\n        }\n\n        setTimeout(run, interval);\n      } catch (err) {\n        return promiseReject(err);\n      }\n    };\n\n    run();\n  });\n}\n\nexports.promiseWhile = promiseWhile;\n\nasync function promiseProps(obj) {\n  const resultObj = {};\n\n  const promises = _.keys(obj).map(async key => {\n    const r = await Promise.resolve(obj[key]);\n    resultObj[key] = r;\n  });\n\n  return Promise.all(promises).then(() => resultObj);\n}\n\nexports.promiseProps = promiseProps;\n\nfunction tryStringify(value) {\n  if (typeof value === \"string\") {\n    return value;\n  }\n\n  try {\n    return JSON.stringify(value);\n  } catch (_a) {\n    return value;\n  }\n}\n\nexports.tryStringify = tryStringify;\n\nfunction tryParse(value) {\n  if (typeof value !== \"string\") {\n    return value;\n  }\n\n  try {\n    return JSON.parse(value);\n  } catch (_a) {\n    return value;\n  }\n}\n\nexports.tryParse = tryParse;\n\nfunction setupLoggers() {\n  if (process.env.DEBUG) {\n    logger_1.logger.add(new winston.transports.Console({\n      level: \"debug\",\n      format: winston.format.printf(info => {\n        const segments = [info.message, ...(info[triple_beam_1.SPLAT] || [])].map(tryStringify);\n        return `${ansiStrip(segments.join(\" \"))}`;\n      })\n    }));\n  } else if (process.env.IS_FIREBASE_CLI) {\n    logger_1.logger.add(new winston.transports.Console({\n      level: \"info\",\n      format: winston.format.printf(info => [info.message, ...(info[triple_beam_1.SPLAT] || [])].filter(chunk => typeof chunk == \"string\").join(\" \"))\n    }));\n  }\n}\n\nexports.setupLoggers = setupLoggers;\n\nasync function promiseWithSpinner(action, message) {\n  const spinner = ora(message).start();\n  let data;\n\n  try {\n    data = await action();\n    spinner.succeed();\n  } catch (err) {\n    spinner.fail();\n    throw err;\n  }\n\n  return data;\n}\n\nexports.promiseWithSpinner = promiseWithSpinner;\n\nfunction createDestroyer(server) {\n  const connections = new Set();\n  server.on(\"connection\", conn => {\n    connections.add(conn);\n    conn.once(\"close\", () => connections.delete(conn));\n  });\n  let destroyPromise = undefined;\n  return function destroyer() {\n    if (!destroyPromise) {\n      destroyPromise = new Promise((resolve, reject) => {\n        server.close(err => {\n          if (err) return reject(err);\n          resolve();\n        });\n        connections.forEach(socket => socket.destroy());\n      });\n    }\n\n    return destroyPromise;\n  };\n}\n\nexports.createDestroyer = createDestroyer;\n\nfunction datetimeString(d) {\n  const day = `${d.getFullYear()}-${(d.getMonth() + 1).toString().padStart(2, \"0\")}-${d.getDate().toString().padStart(2, \"0\")}`;\n  const time = `${d.getHours().toString().padStart(2, \"0\")}:${d.getMinutes().toString().padStart(2, \"0\")}:${d.getSeconds().toString().padStart(2, \"0\")}`;\n  return `${day} ${time}`;\n}\n\nexports.datetimeString = datetimeString;\n\nfunction isCloudEnvironment() {\n  return !!process.env.CODESPACES;\n}\n\nexports.isCloudEnvironment = isCloudEnvironment;\n\nfunction isRunningInWSL() {\n  return !!process.env.WSL_DISTRO_NAME;\n}\n\nexports.isRunningInWSL = isRunningInWSL;\n\nfunction thirtyDaysFromNow() {\n  return new Date(Date.now() + THIRTY_DAYS_IN_MILLISECONDS);\n}\n\nexports.thirtyDaysFromNow = thirtyDaysFromNow;\n\nfunction assertDefined(val, message) {\n  if (val === undefined || val === null) {\n    throw new assert_1.AssertionError({\n      message: message || `expected value to be defined but got \"${val}\"`\n    });\n  }\n}\n\nexports.assertDefined = assertDefined;\n\nfunction assertIsString(val, message) {\n  if (typeof val !== \"string\") {\n    throw new assert_1.AssertionError({\n      message: message || `expected \"string\" but got \"${typeof val}\"`\n    });\n  }\n}\n\nexports.assertIsString = assertIsString;\n\nfunction assertIsNumber(val, message) {\n  if (typeof val !== \"number\") {\n    throw new assert_1.AssertionError({\n      message: message || `expected \"number\" but got \"${typeof val}\"`\n    });\n  }\n}\n\nexports.assertIsNumber = assertIsNumber;\n\nfunction assertIsStringOrUndefined(val, message) {\n  if (!(val === undefined || typeof val === \"string\")) {\n    throw new assert_1.AssertionError({\n      message: message || `expected \"string\" or \"undefined\" but got \"${typeof val}\"`\n    });\n  }\n}\n\nexports.assertIsStringOrUndefined = assertIsStringOrUndefined;","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/firebase-tools/lib/utils.js"],"names":["Object","defineProperty","exports","value","assertIsStringOrUndefined","assertIsNumber","assertIsString","assertDefined","thirtyDaysFromNow","isRunningInWSL","isCloudEnvironment","datetimeString","createDestroyer","promiseWithSpinner","setupLoggers","tryParse","tryStringify","promiseProps","promiseWhile","promiseAllSettled","getFunctionsEventProvider","endpoint","makeActiveProject","streamToString","stringToStream","explainStdin","reject","logLabeledWarning","logWarning","logLabeledBullet","logBullet","logLabeledSuccess","logSuccess","addSubdomain","addDatabaseNamespace","getDatabaseViewDataUrl","getDatabaseUrl","envOverride","getInheritedOption","consoleUrl","envOverrides","_","require","url","clc","ora","process","stream_1","winston","triple_beam_1","assert_1","ansiStrip","configstore_1","error_1","logger_1","IS_WINDOWS","platform","SUCCESS_CHAR","WARNING_CHAR","THIRTY_DAYS_IN_MILLISECONDS","project","path","api","consoleOrigin","options","key","target","has","parent","envname","coerce","currentEnvValue","env","length","push","e","origin","namespace","pathname","withPath","resolve","urlObj","URL","hostname","includes","href","searchParams","set","subdomain","replace","message","type","data","undefined","logger","green","bold","label","cyan","yellow","Promise","FirebaseError","exit","stdin","isTTY","info","text","s","Readable","b","on","d","once","projectDir","newActive","activeProjects","configstore","get","unset","parts","join","eventType","split","provider","last","capitalize","match","promises","wrappedPromises","map","p","val","state","err","reason","all","action","check","interval","promiseReject","run","res","setTimeout","obj","resultObj","keys","r","then","JSON","stringify","_a","parse","DEBUG","add","transports","Console","level","format","printf","segments","SPLAT","IS_FIREBASE_CLI","filter","chunk","spinner","start","succeed","fail","server","connections","Set","conn","delete","destroyPromise","destroyer","close","forEach","socket","destroy","day","getFullYear","getMonth","toString","padStart","getDate","time","getHours","getMinutes","getSeconds","CODESPACES","WSL_DISTRO_NAME","Date","now","AssertionError"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,yBAAR,GAAoCF,OAAO,CAACG,cAAR,GAAyBH,OAAO,CAACI,cAAR,GAAyBJ,OAAO,CAACK,aAAR,GAAwBL,OAAO,CAACM,iBAAR,GAA4BN,OAAO,CAACO,cAAR,GAAyBP,OAAO,CAACQ,kBAAR,GAA6BR,OAAO,CAACS,cAAR,GAAyBT,OAAO,CAACU,eAAR,GAA0BV,OAAO,CAACW,kBAAR,GAA6BX,OAAO,CAACY,YAAR,GAAuBZ,OAAO,CAACa,QAAR,GAAmBb,OAAO,CAACc,YAAR,GAAuBd,OAAO,CAACe,YAAR,GAAuBf,OAAO,CAACgB,YAAR,GAAuBhB,OAAO,CAACiB,iBAAR,GAA4BjB,OAAO,CAACkB,yBAAR,GAAoClB,OAAO,CAACmB,QAAR,GAAmBnB,OAAO,CAACoB,iBAAR,GAA4BpB,OAAO,CAACqB,cAAR,GAAyBrB,OAAO,CAACsB,cAAR,GAAyBtB,OAAO,CAACuB,YAAR,GAAuBvB,OAAO,CAACwB,MAAR,GAAiBxB,OAAO,CAACyB,iBAAR,GAA4BzB,OAAO,CAAC0B,UAAR,GAAqB1B,OAAO,CAAC2B,gBAAR,GAA2B3B,OAAO,CAAC4B,SAAR,GAAoB5B,OAAO,CAAC6B,iBAAR,GAA4B7B,OAAO,CAAC8B,UAAR,GAAqB9B,OAAO,CAAC+B,YAAR,GAAuB/B,OAAO,CAACgC,oBAAR,GAA+BhC,OAAO,CAACiC,sBAAR,GAAiCjC,OAAO,CAACkC,cAAR,GAAyBlC,OAAO,CAACmC,WAAR,GAAsBnC,OAAO,CAACoC,kBAAR,GAA6BpC,OAAO,CAACqC,UAAR,GAAqBrC,OAAO,CAACsC,YAAR,GAAuB,KAAK,CAA76B;;AACA,MAAMC,CAAC,GAAGC,OAAO,CAAC,QAAD,CAAjB;;AACA,MAAMC,GAAG,GAAGD,OAAO,CAAC,KAAD,CAAnB;;AACA,MAAME,GAAG,GAAGF,OAAO,CAAC,WAAD,CAAnB;;AACA,MAAMG,GAAG,GAAGH,OAAO,CAAC,KAAD,CAAnB;;AACA,MAAMI,OAAO,GAAGJ,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAMK,QAAQ,GAAGL,OAAO,CAAC,QAAD,CAAxB;;AACA,MAAMM,OAAO,GAAGN,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAMO,aAAa,GAAGP,OAAO,CAAC,aAAD,CAA7B;;AACA,MAAMQ,QAAQ,GAAGR,OAAO,CAAC,QAAD,CAAxB;;AACA,MAAMS,SAAS,GAAGT,OAAO,CAAC,iBAAD,CAAzB;;AACA,MAAMU,aAAa,GAAGV,OAAO,CAAC,eAAD,CAA7B;;AACA,MAAMW,OAAO,GAAGX,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAMY,QAAQ,GAAGZ,OAAO,CAAC,UAAD,CAAxB;;AACA,MAAMa,UAAU,GAAGT,OAAO,CAACU,QAAR,KAAqB,OAAxC;AACA,MAAMC,YAAY,GAAGF,UAAU,GAAG,GAAH,GAAS,GAAxC;AACA,MAAMG,YAAY,GAAGH,UAAU,GAAG,GAAH,GAAS,GAAxC;AACA,MAAMI,2BAA2B,GAAG,KAAK,EAAL,GAAU,EAAV,GAAe,EAAf,GAAoB,IAAxD;AACAzD,OAAO,CAACsC,YAAR,GAAuB,EAAvB;;AACA,SAASD,UAAT,CAAoBqB,OAApB,EAA6BC,IAA7B,EAAmC;AAC/B,QAAMC,GAAG,GAAGpB,OAAO,CAAC,OAAD,CAAnB;;AACA,SAAQ,GAAEoB,GAAG,CAACC,aAAc,YAAWH,OAAQ,GAAEC,IAAK,EAAtD;AACH;;AACD3D,OAAO,CAACqC,UAAR,GAAqBA,UAArB;;AACA,SAASD,kBAAT,CAA4B0B,OAA5B,EAAqCC,GAArC,EAA0C;AACtC,MAAIC,MAAM,GAAGF,OAAb;;AACA,SAAOE,MAAP,EAAe;AACX,QAAIzB,CAAC,CAAC0B,GAAF,CAAMD,MAAN,EAAcD,GAAd,CAAJ,EAAwB;AACpB,aAAOC,MAAM,CAACD,GAAD,CAAb;AACH;;AACDC,IAAAA,MAAM,GAAGA,MAAM,CAACE,MAAhB;AACH;AACJ;;AACDlE,OAAO,CAACoC,kBAAR,GAA6BA,kBAA7B;;AACA,SAASD,WAAT,CAAqBgC,OAArB,EAA8BlE,KAA9B,EAAqCmE,MAArC,EAA6C;AACzC,QAAMC,eAAe,GAAGzB,OAAO,CAAC0B,GAAR,CAAYH,OAAZ,CAAxB;;AACA,MAAIE,eAAe,IAAIA,eAAe,CAACE,MAAvC,EAA+C;AAC3CvE,IAAAA,OAAO,CAACsC,YAAR,CAAqBkC,IAArB,CAA0BL,OAA1B;;AACA,QAAIC,MAAJ,EAAY;AACR,UAAI;AACA,eAAOA,MAAM,CAACC,eAAD,EAAkBpE,KAAlB,CAAb;AACH,OAFD,CAGA,OAAOwE,CAAP,EAAU;AACN,eAAOxE,KAAP;AACH;AACJ;;AACD,WAAOoE,eAAP;AACH;;AACD,SAAOpE,KAAP;AACH;;AACDD,OAAO,CAACmC,WAAR,GAAsBA,WAAtB;;AACA,SAASD,cAAT,CAAwBwC,MAAxB,EAAgCC,SAAhC,EAA2CC,QAA3C,EAAqD;AACjD,QAAMC,QAAQ,GAAGpC,GAAG,CAACqC,OAAJ,CAAYJ,MAAZ,EAAoBE,QAApB,CAAjB;AACA,SAAO5C,oBAAoB,CAAC6C,QAAD,EAAWF,SAAX,CAA3B;AACH;;AACD3E,OAAO,CAACkC,cAAR,GAAyBA,cAAzB;;AACA,SAASD,sBAAT,CAAgCyC,MAAhC,EAAwChB,OAAxC,EAAiDiB,SAAjD,EAA4DC,QAA5D,EAAsE;AAClE,QAAMG,MAAM,GAAG,IAAItC,GAAG,CAACuC,GAAR,CAAYN,MAAZ,CAAf;;AACA,MAAIK,MAAM,CAACE,QAAP,CAAgBC,QAAhB,CAAyB,YAAzB,KAA0CH,MAAM,CAACE,QAAP,CAAgBC,QAAhB,CAAyB,kBAAzB,CAA9C,EAA4F;AACxF,WAAO7C,UAAU,CAACqB,OAAD,EAAW,aAAYiB,SAAU,QAAOC,QAAS,EAAjD,CAAjB;AACH;;AACD,SAAO1C,cAAc,CAACwC,MAAD,EAASC,SAAT,EAAoBC,QAAQ,GAAG,OAA/B,CAArB;AACH;;AACD5E,OAAO,CAACiC,sBAAR,GAAiCA,sBAAjC;;AACA,SAASD,oBAAT,CAA8B0C,MAA9B,EAAsCC,SAAtC,EAAiD;AAC7C,QAAMI,MAAM,GAAG,IAAItC,GAAG,CAACuC,GAAR,CAAYN,MAAZ,CAAf;;AACA,MAAIK,MAAM,CAACE,QAAP,CAAgBC,QAAhB,CAAyBP,SAAzB,CAAJ,EAAyC;AACrC,WAAOI,MAAM,CAACI,IAAd;AACH;;AACD,MAAIJ,MAAM,CAACE,QAAP,CAAgBC,QAAhB,CAAyB,YAAzB,KAA0CH,MAAM,CAACE,QAAP,CAAgBC,QAAhB,CAAyB,kBAAzB,CAA9C,EAA4F;AACxF,WAAOnD,YAAY,CAAC2C,MAAD,EAASC,SAAT,CAAnB;AACH;;AACDI,EAAAA,MAAM,CAACK,YAAP,CAAoBC,GAApB,CAAwB,IAAxB,EAA8BV,SAA9B;AACA,SAAOI,MAAM,CAACI,IAAd;AACH;;AACDnF,OAAO,CAACgC,oBAAR,GAA+BA,oBAA/B;;AACA,SAASD,YAAT,CAAsB2C,MAAtB,EAA8BY,SAA9B,EAAyC;AACrC,SAAOZ,MAAM,CAACa,OAAP,CAAe,IAAf,EAAsB,KAAID,SAAU,GAApC,CAAP;AACH;;AACDtF,OAAO,CAAC+B,YAAR,GAAuBA,YAAvB;;AACA,SAASD,UAAT,CAAoB0D,OAApB,EAA6BC,IAAI,GAAG,MAApC,EAA4CC,IAAI,GAAGC,SAAnD,EAA8D;AAC1DvC,EAAAA,QAAQ,CAACwC,MAAT,CAAgBH,IAAhB,EAAsB/C,GAAG,CAACmD,KAAJ,CAAUC,IAAV,CAAgB,GAAEvC,YAAa,GAA/B,CAAtB,EAA0DiC,OAA1D,EAAmEE,IAAnE;AACH;;AACD1F,OAAO,CAAC8B,UAAR,GAAqBA,UAArB;;AACA,SAASD,iBAAT,CAA2BkE,KAA3B,EAAkCP,OAAlC,EAA2CC,IAAI,GAAG,MAAlD,EAA0DC,IAAI,GAAGC,SAAjE,EAA4E;AACxEvC,EAAAA,QAAQ,CAACwC,MAAT,CAAgBH,IAAhB,EAAsB/C,GAAG,CAACmD,KAAJ,CAAUC,IAAV,CAAgB,GAAEvC,YAAa,KAAIwC,KAAM,GAAzC,CAAtB,EAAoEP,OAApE,EAA6EE,IAA7E;AACH;;AACD1F,OAAO,CAAC6B,iBAAR,GAA4BA,iBAA5B;;AACA,SAASD,SAAT,CAAmB4D,OAAnB,EAA4BC,IAAI,GAAG,MAAnC,EAA2CC,IAAI,GAAGC,SAAlD,EAA6D;AACzDvC,EAAAA,QAAQ,CAACwC,MAAT,CAAgBH,IAAhB,EAAsB/C,GAAG,CAACsD,IAAJ,CAASF,IAAT,CAAc,IAAd,CAAtB,EAA2CN,OAA3C,EAAoDE,IAApD;AACH;;AACD1F,OAAO,CAAC4B,SAAR,GAAoBA,SAApB;;AACA,SAASD,gBAAT,CAA0BoE,KAA1B,EAAiCP,OAAjC,EAA0CC,IAAI,GAAG,MAAjD,EAAyDC,IAAI,GAAGC,SAAhE,EAA2E;AACvEvC,EAAAA,QAAQ,CAACwC,MAAT,CAAgBH,IAAhB,EAAsB/C,GAAG,CAACsD,IAAJ,CAASF,IAAT,CAAe,MAAKC,KAAM,GAA1B,CAAtB,EAAqDP,OAArD,EAA8DE,IAA9D;AACH;;AACD1F,OAAO,CAAC2B,gBAAR,GAA2BA,gBAA3B;;AACA,SAASD,UAAT,CAAoB8D,OAApB,EAA6BC,IAAI,GAAG,MAApC,EAA4CC,IAAI,GAAGC,SAAnD,EAA8D;AAC1DvC,EAAAA,QAAQ,CAACwC,MAAT,CAAgBH,IAAhB,EAAsB/C,GAAG,CAACuD,MAAJ,CAAWH,IAAX,CAAiB,GAAEtC,YAAa,GAAhC,CAAtB,EAA2DgC,OAA3D,EAAoEE,IAApE;AACH;;AACD1F,OAAO,CAAC0B,UAAR,GAAqBA,UAArB;;AACA,SAASD,iBAAT,CAA2BsE,KAA3B,EAAkCP,OAAlC,EAA2CC,IAAI,GAAG,MAAlD,EAA0DC,IAAI,GAAGC,SAAjE,EAA4E;AACxEvC,EAAAA,QAAQ,CAACwC,MAAT,CAAgBH,IAAhB,EAAsB/C,GAAG,CAACuD,MAAJ,CAAWH,IAAX,CAAiB,GAAEtC,YAAa,KAAIuC,KAAM,GAA1C,CAAtB,EAAqEP,OAArE,EAA8EE,IAA9E;AACH;;AACD1F,OAAO,CAACyB,iBAAR,GAA4BA,iBAA5B;;AACA,SAASD,MAAT,CAAgBgE,OAAhB,EAAyB1B,OAAzB,EAAkC;AAC9B,SAAOoC,OAAO,CAAC1E,MAAR,CAAe,IAAI2B,OAAO,CAACgD,aAAZ,CAA0BX,OAA1B,EAAmC1B,OAAnC,CAAf,CAAP;AACH;;AACD9D,OAAO,CAACwB,MAAR,GAAiBA,MAAjB;;AACA,SAASD,YAAT,GAAwB;AACpB,MAAI8B,UAAJ,EAAgB;AACZ,UAAM,IAAIF,OAAO,CAACgD,aAAZ,CAA0B,0CAA1B,EAAsE;AACxEC,MAAAA,IAAI,EAAE;AADkE,KAAtE,CAAN;AAGH;;AACD,MAAIxD,OAAO,CAACyD,KAAR,CAAcC,KAAlB,EAAyB;AACrBlD,IAAAA,QAAQ,CAACwC,MAAT,CAAgBW,IAAhB,CAAqB7D,GAAG,CAACoD,IAAJ,CAAS,OAAT,CAArB,EAAwC,qDAAxC;AACH;AACJ;;AACD9F,OAAO,CAACuB,YAAR,GAAuBA,YAAvB;;AACA,SAASD,cAAT,CAAwBkF,IAAxB,EAA8B;AAC1B,MAAI,CAACA,IAAL,EAAW;AACP,WAAOb,SAAP;AACH;;AACD,QAAMc,CAAC,GAAG,IAAI5D,QAAQ,CAAC6D,QAAb,EAAV;AACAD,EAAAA,CAAC,CAACjC,IAAF,CAAOgC,IAAP;AACAC,EAAAA,CAAC,CAACjC,IAAF,CAAO,IAAP;AACA,SAAOiC,CAAP;AACH;;AACDzG,OAAO,CAACsB,cAAR,GAAyBA,cAAzB;;AACA,SAASD,cAAT,CAAwBoF,CAAxB,EAA2B;AACvB,SAAO,IAAIP,OAAJ,CAAY,CAACpB,OAAD,EAAUtD,MAAV,KAAqB;AACpC,QAAImF,CAAC,GAAG,EAAR;AACAF,IAAAA,CAAC,CAACG,EAAF,CAAK,OAAL,EAAcpF,MAAd;AACAiF,IAAAA,CAAC,CAACG,EAAF,CAAK,MAAL,EAAcC,CAAD,IAAQF,CAAC,IAAK,GAAEE,CAAE,EAA/B;AACAJ,IAAAA,CAAC,CAACK,IAAF,CAAO,KAAP,EAAc,MAAMhC,OAAO,CAAC6B,CAAD,CAA3B;AACH,GALM,CAAP;AAMH;;AACD3G,OAAO,CAACqB,cAAR,GAAyBA,cAAzB;;AACA,SAASD,iBAAT,CAA2B2F,UAA3B,EAAuCC,SAAvC,EAAkD;AAC9C,QAAMC,cAAc,GAAG/D,aAAa,CAACgE,WAAd,CAA0BC,GAA1B,CAA8B,gBAA9B,KAAmD,EAA1E;;AACA,MAAIH,SAAJ,EAAe;AACXC,IAAAA,cAAc,CAACF,UAAD,CAAd,GAA6BC,SAA7B;AACH,GAFD,MAGK;AACDzE,IAAAA,CAAC,CAAC6E,KAAF,CAAQH,cAAR,EAAwBF,UAAxB;AACH;;AACD7D,EAAAA,aAAa,CAACgE,WAAd,CAA0B7B,GAA1B,CAA8B,gBAA9B,EAAgD4B,cAAhD;AACH;;AACDjH,OAAO,CAACoB,iBAAR,GAA4BA,iBAA5B;;AACA,SAASD,QAAT,CAAkBkG,KAAlB,EAAyB;AACrB,SAAQ,IAAG9E,CAAC,CAAC+E,IAAF,CAAOD,KAAP,EAAc,GAAd,CAAmB,EAA9B;AACH;;AACDrH,OAAO,CAACmB,QAAR,GAAmBA,QAAnB;;AACA,SAASD,yBAAT,CAAmCqG,SAAnC,EAA8C;AAC1C,QAAMF,KAAK,GAAGE,SAAS,CAACC,KAAV,CAAgB,GAAhB,CAAd;;AACA,MAAIH,KAAK,CAAC9C,MAAN,GAAe,CAAnB,EAAsB;AAClB,UAAMkD,QAAQ,GAAGlF,CAAC,CAACmF,IAAF,CAAOL,KAAK,CAAC,CAAD,CAAL,CAASG,KAAT,CAAe,GAAf,CAAP,CAAjB;;AACA,WAAOjF,CAAC,CAACoF,UAAF,CAAaF,QAAb,CAAP;AACH;;AACD,MAAIF,SAAS,CAACK,KAAV,CAAgB,eAAhB,CAAJ,EAAsC;AAClC,WAAO,QAAP;AACH,GAFD,MAGK,IAAIL,SAAS,CAACK,KAAV,CAAgB,gBAAhB,CAAJ,EAAuC;AACxC,WAAO,SAAP;AACH,GAFI,MAGA,IAAIL,SAAS,CAACK,KAAV,CAAgB,kBAAhB,CAAJ,EAAyC;AAC1C,WAAO,WAAP;AACH,GAFI,MAGA,IAAIL,SAAS,CAACK,KAAV,CAAgB,0BAAhB,CAAJ,EAAiD;AAClD,WAAO,UAAP;AACH,GAFI,MAGA,IAAIL,SAAS,CAACK,KAAV,CAAgB,sBAAhB,CAAJ,EAA6C;AAC9C,WAAO,MAAP;AACH,GAFI,MAGA,IAAIL,SAAS,CAACK,KAAV,CAAgB,6BAAhB,CAAJ,EAAoD;AACrD,WAAO,aAAP;AACH,GAFI,MAGA,IAAIL,SAAS,CAACK,KAAV,CAAgB,kBAAhB,CAAJ,EAAyC;AAC1C,WAAO,WAAP;AACH;;AACD,SAAOrF,CAAC,CAACoF,UAAF,CAAaJ,SAAS,CAACC,KAAV,CAAgB,GAAhB,EAAqB,CAArB,CAAb,CAAP;AACH;;AACDxH,OAAO,CAACkB,yBAAR,GAAoCA,yBAApC;;AACA,SAASD,iBAAT,CAA2B4G,QAA3B,EAAqC;AACjC,QAAMC,eAAe,GAAGvF,CAAC,CAACwF,GAAF,CAAMF,QAAN,EAAgB,MAAOG,CAAP,IAAa;AACjD,QAAI;AACA,YAAMC,GAAG,GAAG,MAAM/B,OAAO,CAACpB,OAAR,CAAgBkD,CAAhB,CAAlB;AACA,aAAO;AAAEE,QAAAA,KAAK,EAAE,WAAT;AAAsBjI,QAAAA,KAAK,EAAEgI;AAA7B,OAAP;AACH,KAHD,CAIA,OAAOE,GAAP,EAAY;AACR,aAAO;AAAED,QAAAA,KAAK,EAAE,UAAT;AAAqBE,QAAAA,MAAM,EAAED;AAA7B,OAAP;AACH;AACJ,GARuB,CAAxB;;AASA,SAAOjC,OAAO,CAACmC,GAAR,CAAYP,eAAZ,CAAP;AACH;;AACD9H,OAAO,CAACiB,iBAAR,GAA4BA,iBAA5B;;AACA,eAAeD,YAAf,CAA4BsH,MAA5B,EAAoCC,KAApC,EAA2CC,QAAQ,GAAG,IAAtD,EAA4D;AACxD,SAAO,IAAItC,OAAJ,CAAY,CAACpB,OAAD,EAAU2D,aAAV,KAA4B;AAC3C,UAAMC,GAAG,GAAG,YAAY;AACpB,UAAI;AACA,cAAMC,GAAG,GAAG,MAAML,MAAM,EAAxB;;AACA,YAAIC,KAAK,CAACI,GAAD,CAAT,EAAgB;AACZ,iBAAO7D,OAAO,CAAC6D,GAAD,CAAd;AACH;;AACDC,QAAAA,UAAU,CAACF,GAAD,EAAMF,QAAN,CAAV;AACH,OAND,CAOA,OAAOL,GAAP,EAAY;AACR,eAAOM,aAAa,CAACN,GAAD,CAApB;AACH;AACJ,KAXD;;AAYAO,IAAAA,GAAG;AACN,GAdM,CAAP;AAeH;;AACD1I,OAAO,CAACgB,YAAR,GAAuBA,YAAvB;;AACA,eAAeD,YAAf,CAA4B8H,GAA5B,EAAiC;AAC7B,QAAMC,SAAS,GAAG,EAAlB;;AACA,QAAMjB,QAAQ,GAAGtF,CAAC,CAACwG,IAAF,CAAOF,GAAP,EAAYd,GAAZ,CAAgB,MAAOhE,GAAP,IAAe;AAC5C,UAAMiF,CAAC,GAAG,MAAM9C,OAAO,CAACpB,OAAR,CAAgB+D,GAAG,CAAC9E,GAAD,CAAnB,CAAhB;AACA+E,IAAAA,SAAS,CAAC/E,GAAD,CAAT,GAAiBiF,CAAjB;AACH,GAHgB,CAAjB;;AAIA,SAAO9C,OAAO,CAACmC,GAAR,CAAYR,QAAZ,EAAsBoB,IAAtB,CAA2B,MAAMH,SAAjC,CAAP;AACH;;AACD9I,OAAO,CAACe,YAAR,GAAuBA,YAAvB;;AACA,SAASD,YAAT,CAAsBb,KAAtB,EAA6B;AACzB,MAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC3B,WAAOA,KAAP;AACH;;AACD,MAAI;AACA,WAAOiJ,IAAI,CAACC,SAAL,CAAelJ,KAAf,CAAP;AACH,GAFD,CAGA,OAAOmJ,EAAP,EAAW;AACP,WAAOnJ,KAAP;AACH;AACJ;;AACDD,OAAO,CAACc,YAAR,GAAuBA,YAAvB;;AACA,SAASD,QAAT,CAAkBZ,KAAlB,EAAyB;AACrB,MAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC3B,WAAOA,KAAP;AACH;;AACD,MAAI;AACA,WAAOiJ,IAAI,CAACG,KAAL,CAAWpJ,KAAX,CAAP;AACH,GAFD,CAGA,OAAOmJ,EAAP,EAAW;AACP,WAAOnJ,KAAP;AACH;AACJ;;AACDD,OAAO,CAACa,QAAR,GAAmBA,QAAnB;;AACA,SAASD,YAAT,GAAwB;AACpB,MAAIgC,OAAO,CAAC0B,GAAR,CAAYgF,KAAhB,EAAuB;AACnBlG,IAAAA,QAAQ,CAACwC,MAAT,CAAgB2D,GAAhB,CAAoB,IAAIzG,OAAO,CAAC0G,UAAR,CAAmBC,OAAvB,CAA+B;AAC/CC,MAAAA,KAAK,EAAE,OADwC;AAE/CC,MAAAA,MAAM,EAAE7G,OAAO,CAAC6G,MAAR,CAAeC,MAAf,CAAuBrD,IAAD,IAAU;AACpC,cAAMsD,QAAQ,GAAG,CAACtD,IAAI,CAACf,OAAN,EAAe,IAAIe,IAAI,CAACxD,aAAa,CAAC+G,KAAf,CAAJ,IAA6B,EAAjC,CAAf,EAAqD/B,GAArD,CAAyDjH,YAAzD,CAAjB;AACA,eAAQ,GAAEmC,SAAS,CAAC4G,QAAQ,CAACvC,IAAT,CAAc,GAAd,CAAD,CAAqB,EAAxC;AACH,OAHO;AAFuC,KAA/B,CAApB;AAOH,GARD,MASK,IAAI1E,OAAO,CAAC0B,GAAR,CAAYyF,eAAhB,EAAiC;AAClC3G,IAAAA,QAAQ,CAACwC,MAAT,CAAgB2D,GAAhB,CAAoB,IAAIzG,OAAO,CAAC0G,UAAR,CAAmBC,OAAvB,CAA+B;AAC/CC,MAAAA,KAAK,EAAE,MADwC;AAE/CC,MAAAA,MAAM,EAAE7G,OAAO,CAAC6G,MAAR,CAAeC,MAAf,CAAuBrD,IAAD,IAAU,CAACA,IAAI,CAACf,OAAN,EAAe,IAAIe,IAAI,CAACxD,aAAa,CAAC+G,KAAf,CAAJ,IAA6B,EAAjC,CAAf,EACnCE,MADmC,CAC3BC,KAAD,IAAW,OAAOA,KAAP,IAAgB,QADC,EAEnC3C,IAFmC,CAE9B,GAF8B,CAAhC;AAFuC,KAA/B,CAApB;AAMH;AACJ;;AACDtH,OAAO,CAACY,YAAR,GAAuBA,YAAvB;;AACA,eAAeD,kBAAf,CAAkC2H,MAAlC,EAA0C9C,OAA1C,EAAmD;AAC/C,QAAM0E,OAAO,GAAGvH,GAAG,CAAC6C,OAAD,CAAH,CAAa2E,KAAb,EAAhB;AACA,MAAIzE,IAAJ;;AACA,MAAI;AACAA,IAAAA,IAAI,GAAG,MAAM4C,MAAM,EAAnB;AACA4B,IAAAA,OAAO,CAACE,OAAR;AACH,GAHD,CAIA,OAAOjC,GAAP,EAAY;AACR+B,IAAAA,OAAO,CAACG,IAAR;AACA,UAAMlC,GAAN;AACH;;AACD,SAAOzC,IAAP;AACH;;AACD1F,OAAO,CAACW,kBAAR,GAA6BA,kBAA7B;;AACA,SAASD,eAAT,CAAyB4J,MAAzB,EAAiC;AAC7B,QAAMC,WAAW,GAAG,IAAIC,GAAJ,EAApB;AACAF,EAAAA,MAAM,CAAC1D,EAAP,CAAU,YAAV,EAAyB6D,IAAD,IAAU;AAC9BF,IAAAA,WAAW,CAAChB,GAAZ,CAAgBkB,IAAhB;AACAA,IAAAA,IAAI,CAAC3D,IAAL,CAAU,OAAV,EAAmB,MAAMyD,WAAW,CAACG,MAAZ,CAAmBD,IAAnB,CAAzB;AACH,GAHD;AAIA,MAAIE,cAAc,GAAGhF,SAArB;AACA,SAAO,SAASiF,SAAT,GAAqB;AACxB,QAAI,CAACD,cAAL,EAAqB;AACjBA,MAAAA,cAAc,GAAG,IAAIzE,OAAJ,CAAY,CAACpB,OAAD,EAAUtD,MAAV,KAAqB;AAC9C8I,QAAAA,MAAM,CAACO,KAAP,CAAc1C,GAAD,IAAS;AAClB,cAAIA,GAAJ,EACI,OAAO3G,MAAM,CAAC2G,GAAD,CAAb;AACJrD,UAAAA,OAAO;AACV,SAJD;AAKAyF,QAAAA,WAAW,CAACO,OAAZ,CAAqBC,MAAD,IAAYA,MAAM,CAACC,OAAP,EAAhC;AACH,OAPgB,CAAjB;AAQH;;AACD,WAAOL,cAAP;AACH,GAZD;AAaH;;AACD3K,OAAO,CAACU,eAAR,GAA0BA,eAA1B;;AACA,SAASD,cAAT,CAAwBoG,CAAxB,EAA2B;AACvB,QAAMoE,GAAG,GAAI,GAAEpE,CAAC,CAACqE,WAAF,EAAgB,IAAG,CAACrE,CAAC,CAACsE,QAAF,KAAe,CAAhB,EAC7BC,QAD6B,GAE7BC,QAF6B,CAEpB,CAFoB,EAEjB,GAFiB,CAEZ,IAAGxE,CAAC,CAACyE,OAAF,GAAYF,QAAZ,GAAuBC,QAAvB,CAAgC,CAAhC,EAAmC,GAAnC,CAAwC,EAFjE;AAGA,QAAME,IAAI,GAAI,GAAE1E,CAAC,CAAC2E,QAAF,GAAaJ,QAAb,GAAwBC,QAAxB,CAAiC,CAAjC,EAAoC,GAApC,CAAyC,IAAGxE,CAAC,CACxD4E,UADuD,GAEvDL,QAFuD,GAGvDC,QAHuD,CAG9C,CAH8C,EAG3C,GAH2C,CAGtC,IAAGxE,CAAC,CAAC6E,UAAF,GAAeN,QAAf,GAA0BC,QAA1B,CAAmC,CAAnC,EAAsC,GAAtC,CAA2C,EAHpE;AAIA,SAAQ,GAAEJ,GAAI,IAAGM,IAAK,EAAtB;AACH;;AACDvL,OAAO,CAACS,cAAR,GAAyBA,cAAzB;;AACA,SAASD,kBAAT,GAA8B;AAC1B,SAAO,CAAC,CAACoC,OAAO,CAAC0B,GAAR,CAAYqH,UAArB;AACH;;AACD3L,OAAO,CAACQ,kBAAR,GAA6BA,kBAA7B;;AACA,SAASD,cAAT,GAA0B;AACtB,SAAO,CAAC,CAACqC,OAAO,CAAC0B,GAAR,CAAYsH,eAArB;AACH;;AACD5L,OAAO,CAACO,cAAR,GAAyBA,cAAzB;;AACA,SAASD,iBAAT,GAA6B;AACzB,SAAO,IAAIuL,IAAJ,CAASA,IAAI,CAACC,GAAL,KAAarI,2BAAtB,CAAP;AACH;;AACDzD,OAAO,CAACM,iBAAR,GAA4BA,iBAA5B;;AACA,SAASD,aAAT,CAAuB4H,GAAvB,EAA4BzC,OAA5B,EAAqC;AACjC,MAAIyC,GAAG,KAAKtC,SAAR,IAAqBsC,GAAG,KAAK,IAAjC,EAAuC;AACnC,UAAM,IAAIjF,QAAQ,CAAC+I,cAAb,CAA4B;AAC9BvG,MAAAA,OAAO,EAAEA,OAAO,IAAK,yCAAwCyC,GAAI;AADnC,KAA5B,CAAN;AAGH;AACJ;;AACDjI,OAAO,CAACK,aAAR,GAAwBA,aAAxB;;AACA,SAASD,cAAT,CAAwB6H,GAAxB,EAA6BzC,OAA7B,EAAsC;AAClC,MAAI,OAAOyC,GAAP,KAAe,QAAnB,EAA6B;AACzB,UAAM,IAAIjF,QAAQ,CAAC+I,cAAb,CAA4B;AAC9BvG,MAAAA,OAAO,EAAEA,OAAO,IAAK,8BAA6B,OAAOyC,GAAI;AAD/B,KAA5B,CAAN;AAGH;AACJ;;AACDjI,OAAO,CAACI,cAAR,GAAyBA,cAAzB;;AACA,SAASD,cAAT,CAAwB8H,GAAxB,EAA6BzC,OAA7B,EAAsC;AAClC,MAAI,OAAOyC,GAAP,KAAe,QAAnB,EAA6B;AACzB,UAAM,IAAIjF,QAAQ,CAAC+I,cAAb,CAA4B;AAC9BvG,MAAAA,OAAO,EAAEA,OAAO,IAAK,8BAA6B,OAAOyC,GAAI;AAD/B,KAA5B,CAAN;AAGH;AACJ;;AACDjI,OAAO,CAACG,cAAR,GAAyBA,cAAzB;;AACA,SAASD,yBAAT,CAAmC+H,GAAnC,EAAwCzC,OAAxC,EAAiD;AAC7C,MAAI,EAAEyC,GAAG,KAAKtC,SAAR,IAAqB,OAAOsC,GAAP,KAAe,QAAtC,CAAJ,EAAqD;AACjD,UAAM,IAAIjF,QAAQ,CAAC+I,cAAb,CAA4B;AAC9BvG,MAAAA,OAAO,EAAEA,OAAO,IAAK,6CAA4C,OAAOyC,GAAI;AAD9C,KAA5B,CAAN;AAGH;AACJ;;AACDjI,OAAO,CAACE,yBAAR,GAAoCA,yBAApC","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.assertIsStringOrUndefined = exports.assertIsNumber = exports.assertIsString = exports.assertDefined = exports.thirtyDaysFromNow = exports.isRunningInWSL = exports.isCloudEnvironment = exports.datetimeString = exports.createDestroyer = exports.promiseWithSpinner = exports.setupLoggers = exports.tryParse = exports.tryStringify = exports.promiseProps = exports.promiseWhile = exports.promiseAllSettled = exports.getFunctionsEventProvider = exports.endpoint = exports.makeActiveProject = exports.streamToString = exports.stringToStream = exports.explainStdin = exports.reject = exports.logLabeledWarning = exports.logWarning = exports.logLabeledBullet = exports.logBullet = exports.logLabeledSuccess = exports.logSuccess = exports.addSubdomain = exports.addDatabaseNamespace = exports.getDatabaseViewDataUrl = exports.getDatabaseUrl = exports.envOverride = exports.getInheritedOption = exports.consoleUrl = exports.envOverrides = void 0;\nconst _ = require(\"lodash\");\nconst url = require(\"url\");\nconst clc = require(\"cli-color\");\nconst ora = require(\"ora\");\nconst process = require(\"process\");\nconst stream_1 = require(\"stream\");\nconst winston = require(\"winston\");\nconst triple_beam_1 = require(\"triple-beam\");\nconst assert_1 = require(\"assert\");\nconst ansiStrip = require(\"cli-color/strip\");\nconst configstore_1 = require(\"./configstore\");\nconst error_1 = require(\"./error\");\nconst logger_1 = require(\"./logger\");\nconst IS_WINDOWS = process.platform === \"win32\";\nconst SUCCESS_CHAR = IS_WINDOWS ? \"+\" : \"✔\";\nconst WARNING_CHAR = IS_WINDOWS ? \"!\" : \"⚠\";\nconst THIRTY_DAYS_IN_MILLISECONDS = 30 * 24 * 60 * 60 * 1000;\nexports.envOverrides = [];\nfunction consoleUrl(project, path) {\n    const api = require(\"./api\");\n    return `${api.consoleOrigin}/project/${project}${path}`;\n}\nexports.consoleUrl = consoleUrl;\nfunction getInheritedOption(options, key) {\n    let target = options;\n    while (target) {\n        if (_.has(target, key)) {\n            return target[key];\n        }\n        target = target.parent;\n    }\n}\nexports.getInheritedOption = getInheritedOption;\nfunction envOverride(envname, value, coerce) {\n    const currentEnvValue = process.env[envname];\n    if (currentEnvValue && currentEnvValue.length) {\n        exports.envOverrides.push(envname);\n        if (coerce) {\n            try {\n                return coerce(currentEnvValue, value);\n            }\n            catch (e) {\n                return value;\n            }\n        }\n        return currentEnvValue;\n    }\n    return value;\n}\nexports.envOverride = envOverride;\nfunction getDatabaseUrl(origin, namespace, pathname) {\n    const withPath = url.resolve(origin, pathname);\n    return addDatabaseNamespace(withPath, namespace);\n}\nexports.getDatabaseUrl = getDatabaseUrl;\nfunction getDatabaseViewDataUrl(origin, project, namespace, pathname) {\n    const urlObj = new url.URL(origin);\n    if (urlObj.hostname.includes(\"firebaseio\") || urlObj.hostname.includes(\"firebasedatabase\")) {\n        return consoleUrl(project, `/database/${namespace}/data${pathname}`);\n    }\n    return getDatabaseUrl(origin, namespace, pathname + \".json\");\n}\nexports.getDatabaseViewDataUrl = getDatabaseViewDataUrl;\nfunction addDatabaseNamespace(origin, namespace) {\n    const urlObj = new url.URL(origin);\n    if (urlObj.hostname.includes(namespace)) {\n        return urlObj.href;\n    }\n    if (urlObj.hostname.includes(\"firebaseio\") || urlObj.hostname.includes(\"firebasedatabase\")) {\n        return addSubdomain(origin, namespace);\n    }\n    urlObj.searchParams.set(\"ns\", namespace);\n    return urlObj.href;\n}\nexports.addDatabaseNamespace = addDatabaseNamespace;\nfunction addSubdomain(origin, subdomain) {\n    return origin.replace(\"//\", `//${subdomain}.`);\n}\nexports.addSubdomain = addSubdomain;\nfunction logSuccess(message, type = \"info\", data = undefined) {\n    logger_1.logger[type](clc.green.bold(`${SUCCESS_CHAR} `), message, data);\n}\nexports.logSuccess = logSuccess;\nfunction logLabeledSuccess(label, message, type = \"info\", data = undefined) {\n    logger_1.logger[type](clc.green.bold(`${SUCCESS_CHAR}  ${label}:`), message, data);\n}\nexports.logLabeledSuccess = logLabeledSuccess;\nfunction logBullet(message, type = \"info\", data = undefined) {\n    logger_1.logger[type](clc.cyan.bold(\"i \"), message, data);\n}\nexports.logBullet = logBullet;\nfunction logLabeledBullet(label, message, type = \"info\", data = undefined) {\n    logger_1.logger[type](clc.cyan.bold(`i  ${label}:`), message, data);\n}\nexports.logLabeledBullet = logLabeledBullet;\nfunction logWarning(message, type = \"warn\", data = undefined) {\n    logger_1.logger[type](clc.yellow.bold(`${WARNING_CHAR} `), message, data);\n}\nexports.logWarning = logWarning;\nfunction logLabeledWarning(label, message, type = \"warn\", data = undefined) {\n    logger_1.logger[type](clc.yellow.bold(`${WARNING_CHAR}  ${label}:`), message, data);\n}\nexports.logLabeledWarning = logLabeledWarning;\nfunction reject(message, options) {\n    return Promise.reject(new error_1.FirebaseError(message, options));\n}\nexports.reject = reject;\nfunction explainStdin() {\n    if (IS_WINDOWS) {\n        throw new error_1.FirebaseError(\"STDIN input is not available on Windows.\", {\n            exit: 1,\n        });\n    }\n    if (process.stdin.isTTY) {\n        logger_1.logger.info(clc.bold(\"Note:\"), \"Reading STDIN. Type JSON data and then press Ctrl-D\");\n    }\n}\nexports.explainStdin = explainStdin;\nfunction stringToStream(text) {\n    if (!text) {\n        return undefined;\n    }\n    const s = new stream_1.Readable();\n    s.push(text);\n    s.push(null);\n    return s;\n}\nexports.stringToStream = stringToStream;\nfunction streamToString(s) {\n    return new Promise((resolve, reject) => {\n        let b = \"\";\n        s.on(\"error\", reject);\n        s.on(\"data\", (d) => (b += `${d}`));\n        s.once(\"end\", () => resolve(b));\n    });\n}\nexports.streamToString = streamToString;\nfunction makeActiveProject(projectDir, newActive) {\n    const activeProjects = configstore_1.configstore.get(\"activeProjects\") || {};\n    if (newActive) {\n        activeProjects[projectDir] = newActive;\n    }\n    else {\n        _.unset(activeProjects, projectDir);\n    }\n    configstore_1.configstore.set(\"activeProjects\", activeProjects);\n}\nexports.makeActiveProject = makeActiveProject;\nfunction endpoint(parts) {\n    return `/${_.join(parts, \"/\")}`;\n}\nexports.endpoint = endpoint;\nfunction getFunctionsEventProvider(eventType) {\n    const parts = eventType.split(\"/\");\n    if (parts.length > 1) {\n        const provider = _.last(parts[1].split(\".\"));\n        return _.capitalize(provider);\n    }\n    if (eventType.match(/google.pubsub/)) {\n        return \"PubSub\";\n    }\n    else if (eventType.match(/google.storage/)) {\n        return \"Storage\";\n    }\n    else if (eventType.match(/google.analytics/)) {\n        return \"Analytics\";\n    }\n    else if (eventType.match(/google.firebase.database/)) {\n        return \"Database\";\n    }\n    else if (eventType.match(/google.firebase.auth/)) {\n        return \"Auth\";\n    }\n    else if (eventType.match(/google.firebase.crashlytics/)) {\n        return \"Crashlytics\";\n    }\n    else if (eventType.match(/google.firestore/)) {\n        return \"Firestore\";\n    }\n    return _.capitalize(eventType.split(\".\")[1]);\n}\nexports.getFunctionsEventProvider = getFunctionsEventProvider;\nfunction promiseAllSettled(promises) {\n    const wrappedPromises = _.map(promises, async (p) => {\n        try {\n            const val = await Promise.resolve(p);\n            return { state: \"fulfilled\", value: val };\n        }\n        catch (err) {\n            return { state: \"rejected\", reason: err };\n        }\n    });\n    return Promise.all(wrappedPromises);\n}\nexports.promiseAllSettled = promiseAllSettled;\nasync function promiseWhile(action, check, interval = 2500) {\n    return new Promise((resolve, promiseReject) => {\n        const run = async () => {\n            try {\n                const res = await action();\n                if (check(res)) {\n                    return resolve(res);\n                }\n                setTimeout(run, interval);\n            }\n            catch (err) {\n                return promiseReject(err);\n            }\n        };\n        run();\n    });\n}\nexports.promiseWhile = promiseWhile;\nasync function promiseProps(obj) {\n    const resultObj = {};\n    const promises = _.keys(obj).map(async (key) => {\n        const r = await Promise.resolve(obj[key]);\n        resultObj[key] = r;\n    });\n    return Promise.all(promises).then(() => resultObj);\n}\nexports.promiseProps = promiseProps;\nfunction tryStringify(value) {\n    if (typeof value === \"string\") {\n        return value;\n    }\n    try {\n        return JSON.stringify(value);\n    }\n    catch (_a) {\n        return value;\n    }\n}\nexports.tryStringify = tryStringify;\nfunction tryParse(value) {\n    if (typeof value !== \"string\") {\n        return value;\n    }\n    try {\n        return JSON.parse(value);\n    }\n    catch (_a) {\n        return value;\n    }\n}\nexports.tryParse = tryParse;\nfunction setupLoggers() {\n    if (process.env.DEBUG) {\n        logger_1.logger.add(new winston.transports.Console({\n            level: \"debug\",\n            format: winston.format.printf((info) => {\n                const segments = [info.message, ...(info[triple_beam_1.SPLAT] || [])].map(tryStringify);\n                return `${ansiStrip(segments.join(\" \"))}`;\n            }),\n        }));\n    }\n    else if (process.env.IS_FIREBASE_CLI) {\n        logger_1.logger.add(new winston.transports.Console({\n            level: \"info\",\n            format: winston.format.printf((info) => [info.message, ...(info[triple_beam_1.SPLAT] || [])]\n                .filter((chunk) => typeof chunk == \"string\")\n                .join(\" \")),\n        }));\n    }\n}\nexports.setupLoggers = setupLoggers;\nasync function promiseWithSpinner(action, message) {\n    const spinner = ora(message).start();\n    let data;\n    try {\n        data = await action();\n        spinner.succeed();\n    }\n    catch (err) {\n        spinner.fail();\n        throw err;\n    }\n    return data;\n}\nexports.promiseWithSpinner = promiseWithSpinner;\nfunction createDestroyer(server) {\n    const connections = new Set();\n    server.on(\"connection\", (conn) => {\n        connections.add(conn);\n        conn.once(\"close\", () => connections.delete(conn));\n    });\n    let destroyPromise = undefined;\n    return function destroyer() {\n        if (!destroyPromise) {\n            destroyPromise = new Promise((resolve, reject) => {\n                server.close((err) => {\n                    if (err)\n                        return reject(err);\n                    resolve();\n                });\n                connections.forEach((socket) => socket.destroy());\n            });\n        }\n        return destroyPromise;\n    };\n}\nexports.createDestroyer = createDestroyer;\nfunction datetimeString(d) {\n    const day = `${d.getFullYear()}-${(d.getMonth() + 1)\n        .toString()\n        .padStart(2, \"0\")}-${d.getDate().toString().padStart(2, \"0\")}`;\n    const time = `${d.getHours().toString().padStart(2, \"0\")}:${d\n        .getMinutes()\n        .toString()\n        .padStart(2, \"0\")}:${d.getSeconds().toString().padStart(2, \"0\")}`;\n    return `${day} ${time}`;\n}\nexports.datetimeString = datetimeString;\nfunction isCloudEnvironment() {\n    return !!process.env.CODESPACES;\n}\nexports.isCloudEnvironment = isCloudEnvironment;\nfunction isRunningInWSL() {\n    return !!process.env.WSL_DISTRO_NAME;\n}\nexports.isRunningInWSL = isRunningInWSL;\nfunction thirtyDaysFromNow() {\n    return new Date(Date.now() + THIRTY_DAYS_IN_MILLISECONDS);\n}\nexports.thirtyDaysFromNow = thirtyDaysFromNow;\nfunction assertDefined(val, message) {\n    if (val === undefined || val === null) {\n        throw new assert_1.AssertionError({\n            message: message || `expected value to be defined but got \"${val}\"`,\n        });\n    }\n}\nexports.assertDefined = assertDefined;\nfunction assertIsString(val, message) {\n    if (typeof val !== \"string\") {\n        throw new assert_1.AssertionError({\n            message: message || `expected \"string\" but got \"${typeof val}\"`,\n        });\n    }\n}\nexports.assertIsString = assertIsString;\nfunction assertIsNumber(val, message) {\n    if (typeof val !== \"number\") {\n        throw new assert_1.AssertionError({\n            message: message || `expected \"number\" but got \"${typeof val}\"`,\n        });\n    }\n}\nexports.assertIsNumber = assertIsNumber;\nfunction assertIsStringOrUndefined(val, message) {\n    if (!(val === undefined || typeof val === \"string\")) {\n        throw new assert_1.AssertionError({\n            message: message || `expected \"string\" or \"undefined\" but got \"${typeof val}\"`,\n        });\n    }\n}\nexports.assertIsStringOrUndefined = assertIsStringOrUndefined;\n"]},"metadata":{},"sourceType":"script"}