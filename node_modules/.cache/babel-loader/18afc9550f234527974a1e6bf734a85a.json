{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getRuntimeChoice = exports.DEPRECATED_NODE_VERSION_INFO = exports.UNSUPPORTED_NODE_VERSION_PACKAGE_JSON_MSG = exports.UNSUPPORTED_NODE_VERSION_FIREBASE_JSON_MSG = exports.RUNTIME_NOT_SET = void 0;\n\nconst path = require(\"path\");\n\nconst clc = require(\"cli-color\");\n\nconst error_1 = require(\"../../../../error\");\n\nconst track = require(\"../../../../track\");\n\nconst runtimes = require(\"../../runtimes\");\n\nconst cjson = require(\"cjson\");\n\nconst ENGINE_RUNTIMES = {\n  6: \"nodejs6\",\n  8: \"nodejs8\",\n  10: \"nodejs10\",\n  12: \"nodejs12\",\n  14: \"nodejs14\",\n  16: \"nodejs16\"\n};\nconst ENGINE_RUNTIMES_NAMES = Object.values(ENGINE_RUNTIMES);\nexports.RUNTIME_NOT_SET = \"`runtime` field is required but was not found in firebase.json.\\n\" + \"To fix this, add the following lines to the `functions` section of your firebase.json:\\n\" + '\"runtime\": \"nodejs14\"\\n';\nexports.UNSUPPORTED_NODE_VERSION_FIREBASE_JSON_MSG = clc.bold(`functions.runtime value is unsupported. ` + `Valid choices are: ${clc.bold(\"nodejs{10|12|14|16}\")}.`);\nexports.UNSUPPORTED_NODE_VERSION_PACKAGE_JSON_MSG = clc.bold(`package.json in functions directory has an engines field which is unsupported. ` + `Valid choices are: ${clc.bold('{\"node\": 10|12|14|16}')}`);\nexports.DEPRECATED_NODE_VERSION_INFO = `\\n\\nDeploys to runtimes below Node.js 10 are now disabled in the Firebase CLI. ` + `${clc.bold(`Existing Node.js 8 functions ${clc.underline(\"will stop executing at a future date\")}`)}. Update existing functions to Node.js 10 or greater as soon as possible.`;\n\nfunction getRuntimeChoiceFromPackageJson(sourceDir) {\n  const packageJsonPath = path.join(sourceDir, \"package.json\");\n  let loaded;\n\n  try {\n    loaded = cjson.load(packageJsonPath);\n  } catch (err) {\n    throw new error_1.FirebaseError(`Unable to load ${packageJsonPath}: ${err}`);\n  }\n\n  const engines = loaded.engines;\n\n  if (!engines || !engines.node) {\n    throw new error_1.FirebaseError(exports.RUNTIME_NOT_SET);\n  }\n\n  return ENGINE_RUNTIMES[engines.node];\n}\n\nfunction getRuntimeChoice(sourceDir, runtimeFromConfig) {\n  const runtime = runtimeFromConfig || getRuntimeChoiceFromPackageJson(sourceDir);\n  const errorMessage = (runtimeFromConfig ? exports.UNSUPPORTED_NODE_VERSION_FIREBASE_JSON_MSG : exports.UNSUPPORTED_NODE_VERSION_PACKAGE_JSON_MSG) + exports.DEPRECATED_NODE_VERSION_INFO;\n\n  if (!runtime || !ENGINE_RUNTIMES_NAMES.includes(runtime)) {\n    track(\"functions_runtime_notices\", \"package_missing_runtime\");\n    throw new error_1.FirebaseError(errorMessage, {\n      exit: 1\n    });\n  }\n\n  if (runtimes.isDeprecatedRuntime(runtime) || !runtimes.isValidRuntime(runtime)) {\n    track(\"functions_runtime_notices\", `${runtime}_deploy_prohibited`);\n    throw new error_1.FirebaseError(errorMessage, {\n      exit: 1\n    });\n  }\n\n  return runtime;\n}\n\nexports.getRuntimeChoice = getRuntimeChoice;","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/firebase-tools/lib/deploy/functions/runtimes/node/parseRuntimeAndValidateSDK.js"],"names":["Object","defineProperty","exports","value","getRuntimeChoice","DEPRECATED_NODE_VERSION_INFO","UNSUPPORTED_NODE_VERSION_PACKAGE_JSON_MSG","UNSUPPORTED_NODE_VERSION_FIREBASE_JSON_MSG","RUNTIME_NOT_SET","path","require","clc","error_1","track","runtimes","cjson","ENGINE_RUNTIMES","ENGINE_RUNTIMES_NAMES","values","bold","underline","getRuntimeChoiceFromPackageJson","sourceDir","packageJsonPath","join","loaded","load","err","FirebaseError","engines","node","runtimeFromConfig","runtime","errorMessage","includes","exit","isDeprecatedRuntime","isValidRuntime"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getRuntimeChoice = exports.DEPRECATED_NODE_VERSION_INFO = exports.UNSUPPORTED_NODE_VERSION_PACKAGE_JSON_MSG = exports.UNSUPPORTED_NODE_VERSION_FIREBASE_JSON_MSG = exports.RUNTIME_NOT_SET = void 0;\nconst path = require(\"path\");\nconst clc = require(\"cli-color\");\nconst error_1 = require(\"../../../../error\");\nconst track = require(\"../../../../track\");\nconst runtimes = require(\"../../runtimes\");\nconst cjson = require(\"cjson\");\nconst ENGINE_RUNTIMES = {\n    6: \"nodejs6\",\n    8: \"nodejs8\",\n    10: \"nodejs10\",\n    12: \"nodejs12\",\n    14: \"nodejs14\",\n    16: \"nodejs16\",\n};\nconst ENGINE_RUNTIMES_NAMES = Object.values(ENGINE_RUNTIMES);\nexports.RUNTIME_NOT_SET = \"`runtime` field is required but was not found in firebase.json.\\n\" +\n    \"To fix this, add the following lines to the `functions` section of your firebase.json:\\n\" +\n    '\"runtime\": \"nodejs14\"\\n';\nexports.UNSUPPORTED_NODE_VERSION_FIREBASE_JSON_MSG = clc.bold(`functions.runtime value is unsupported. ` +\n    `Valid choices are: ${clc.bold(\"nodejs{10|12|14|16}\")}.`);\nexports.UNSUPPORTED_NODE_VERSION_PACKAGE_JSON_MSG = clc.bold(`package.json in functions directory has an engines field which is unsupported. ` +\n    `Valid choices are: ${clc.bold('{\"node\": 10|12|14|16}')}`);\nexports.DEPRECATED_NODE_VERSION_INFO = `\\n\\nDeploys to runtimes below Node.js 10 are now disabled in the Firebase CLI. ` +\n    `${clc.bold(`Existing Node.js 8 functions ${clc.underline(\"will stop executing at a future date\")}`)}. Update existing functions to Node.js 10 or greater as soon as possible.`;\nfunction getRuntimeChoiceFromPackageJson(sourceDir) {\n    const packageJsonPath = path.join(sourceDir, \"package.json\");\n    let loaded;\n    try {\n        loaded = cjson.load(packageJsonPath);\n    }\n    catch (err) {\n        throw new error_1.FirebaseError(`Unable to load ${packageJsonPath}: ${err}`);\n    }\n    const engines = loaded.engines;\n    if (!engines || !engines.node) {\n        throw new error_1.FirebaseError(exports.RUNTIME_NOT_SET);\n    }\n    return ENGINE_RUNTIMES[engines.node];\n}\nfunction getRuntimeChoice(sourceDir, runtimeFromConfig) {\n    const runtime = runtimeFromConfig || getRuntimeChoiceFromPackageJson(sourceDir);\n    const errorMessage = (runtimeFromConfig\n        ? exports.UNSUPPORTED_NODE_VERSION_FIREBASE_JSON_MSG\n        : exports.UNSUPPORTED_NODE_VERSION_PACKAGE_JSON_MSG) + exports.DEPRECATED_NODE_VERSION_INFO;\n    if (!runtime || !ENGINE_RUNTIMES_NAMES.includes(runtime)) {\n        track(\"functions_runtime_notices\", \"package_missing_runtime\");\n        throw new error_1.FirebaseError(errorMessage, { exit: 1 });\n    }\n    if (runtimes.isDeprecatedRuntime(runtime) || !runtimes.isValidRuntime(runtime)) {\n        track(\"functions_runtime_notices\", `${runtime}_deploy_prohibited`);\n        throw new error_1.FirebaseError(errorMessage, { exit: 1 });\n    }\n    return runtime;\n}\nexports.getRuntimeChoice = getRuntimeChoice;\n"]},"metadata":{},"sourceType":"script"}