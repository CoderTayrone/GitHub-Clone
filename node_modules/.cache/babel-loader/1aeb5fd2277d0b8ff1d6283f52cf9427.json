{"ast":null,"code":"\"use strict\";\n\nvar _ = require(\"lodash\");\n\nvar querystring = require(\"querystring\");\n\nvar request = require(\"request\");\n\nvar url = require(\"url\");\n\nvar {\n  Constants\n} = require(\"./emulator/constants\");\n\nvar {\n  FirebaseError\n} = require(\"./error\");\n\nconst {\n  logger\n} = require(\"./logger\");\n\nvar responseToError = require(\"./responseToError\");\n\nvar scopes = require(\"./scopes\");\n\nvar utils = require(\"./utils\");\n\nvar CLI_VERSION = require(\"../package.json\").version;\n\nvar accessToken;\nvar refreshToken;\nvar commandScopes;\n\nvar _request = function (options, logOptions) {\n  logOptions = logOptions || {};\n  var qsLog = \"\";\n  var bodyLog = \"<request body omitted>\";\n\n  if (options.qs && !logOptions.skipQueryParams) {\n    qsLog = JSON.stringify(options.qs);\n  }\n\n  if (!logOptions.skipRequestBody) {\n    bodyLog = options.body || options.form || \"\";\n  }\n\n  logger.debug(\">>> HTTP REQUEST\", options.method, options.url, qsLog, \"\\n\", bodyLog);\n  options.headers = options.headers || {};\n  options.headers[\"connection\"] = \"keep-alive\";\n  return new Promise(function (resolve, reject) {\n    var req = request(options, function (err, response, body) {\n      if (err) {\n        return reject(new FirebaseError(\"Server Error. \" + err.message, {\n          original: err,\n          exit: 2\n        }));\n      }\n\n      logger.debug(\"<<< HTTP RESPONSE\", response.statusCode, response.headers);\n\n      if (response.statusCode >= 400 && !logOptions.skipResponseBody) {\n        logger.debug(\"<<< HTTP RESPONSE BODY\", response.body);\n\n        if (!options.resolveOnHTTPError) {\n          return reject(responseToError(response, body));\n        }\n      }\n\n      return resolve({\n        status: response.statusCode,\n        response: response,\n        body: body\n      });\n    });\n\n    if (_.size(options.files) > 0) {\n      var form = req.form();\n\n      _.forEach(options.files, function (details, param) {\n        form.append(param, details.stream, {\n          knownLength: details.knownLength,\n          filename: details.filename,\n          contentType: details.contentType\n        });\n      });\n    }\n  });\n};\n\nvar _appendQueryData = function (path, data) {\n  if (data && _.size(data) > 0) {\n    path += _.includes(path, \"?\") ? \"&\" : \"?\";\n    path += querystring.stringify(data);\n  }\n\n  return path;\n};\n\nvar api = {\n  clientId: utils.envOverride(\"FIREBASE_CLIENT_ID\", \"563584335869-fgrhgmd47bqnekij5i8b5pr03ho849e6.apps.googleusercontent.com\"),\n  clientSecret: utils.envOverride(\"FIREBASE_CLIENT_SECRET\", \"j9iVZfS8kkCEFUPaAeJV0sAi\"),\n  cloudbillingOrigin: utils.envOverride(\"FIREBASE_CLOUDBILLING_URL\", \"https://cloudbilling.googleapis.com\"),\n  cloudloggingOrigin: utils.envOverride(\"FIREBASE_CLOUDLOGGING_URL\", \"https://logging.googleapis.com\"),\n  containerRegistryDomain: utils.envOverride(\"CONTAINER_REGISTRY_DOMAIN\", \"gcr.io\"),\n  appDistributionOrigin: utils.envOverride(\"FIREBASE_APP_DISTRIBUTION_URL\", \"https://firebaseappdistribution.googleapis.com\"),\n  appengineOrigin: utils.envOverride(\"FIREBASE_APPENGINE_URL\", \"https://appengine.googleapis.com\"),\n  authOrigin: utils.envOverride(\"FIREBASE_AUTH_URL\", \"https://accounts.google.com\"),\n  consoleOrigin: utils.envOverride(\"FIREBASE_CONSOLE_URL\", \"https://console.firebase.google.com\"),\n  deployOrigin: utils.envOverride(\"FIREBASE_DEPLOY_URL\", utils.envOverride(\"FIREBASE_UPLOAD_URL\", \"https://deploy.firebase.com\")),\n  dynamicLinksOrigin: utils.envOverride(\"FIREBASE_DYNAMIC_LINKS_URL\", \"https://firebasedynamiclinks.googleapis.com\"),\n  dynamicLinksKey: utils.envOverride(\"FIREBASE_DYNAMIC_LINKS_KEY\", \"AIzaSyB6PtY5vuiSB8MNgt20mQffkOlunZnHYiQ\"),\n  firebaseApiOrigin: utils.envOverride(\"FIREBASE_API_URL\", \"https://firebase.googleapis.com\"),\n  firebaseExtensionsRegistryOrigin: utils.envOverride(\"FIREBASE_EXT_REGISTRY_ORIGIN\", \"https://extensions-registry.firebaseapp.com\"),\n  firedataOrigin: utils.envOverride(\"FIREBASE_FIREDATA_URL\", \"https://mobilesdk-pa.googleapis.com\"),\n  firestoreOriginOrEmulator: utils.envOverride(Constants.FIRESTORE_EMULATOR_HOST, utils.envOverride(\"FIRESTORE_URL\", \"https://firestore.googleapis.com\"), val => {\n    if (val.startsWith(\"http\")) {\n      return val;\n    }\n\n    return `http://${val}`;\n  }),\n  firestoreOrigin: utils.envOverride(\"FIRESTORE_URL\", \"https://firestore.googleapis.com\"),\n  functionsOrigin: utils.envOverride(\"FIREBASE_FUNCTIONS_URL\", \"https://cloudfunctions.googleapis.com\"),\n  functionsV2Origin: utils.envOverride(\"FIREBASE_FUNCTIONS_V2_URL\", \"https://cloudfunctions.googleapis.com\"),\n  runOrigin: utils.envOverride(\"CLOUD_RUN_URL\", \"https://run.googleapis.com\"),\n  functionsUploadRegion: utils.envOverride(\"FIREBASE_FUNCTIONS_UPLOAD_REGION\", \"us-central1\"),\n  functionsDefaultRegion: utils.envOverride(\"FIREBASE_FUNCTIONS_DEFAULT_REGION\", \"us-central1\"),\n  cloudschedulerOrigin: utils.envOverride(\"FIREBASE_CLOUDSCHEDULER_URL\", \"https://cloudscheduler.googleapis.com\"),\n  pubsubOrigin: utils.envOverride(\"FIREBASE_PUBSUB_URL\", \"https://pubsub.googleapis.com\"),\n  googleOrigin: utils.envOverride(\"FIREBASE_TOKEN_URL\", utils.envOverride(\"FIREBASE_GOOGLE_URL\", \"https://www.googleapis.com\")),\n  hostingOrigin: utils.envOverride(\"FIREBASE_HOSTING_URL\", \"https://web.app\"),\n  identityOrigin: utils.envOverride(\"FIREBASE_IDENTITY_URL\", \"https://identitytoolkit.googleapis.com\"),\n  iamOrigin: utils.envOverride(\"FIREBASE_IAM_URL\", \"https://iam.googleapis.com\"),\n  extensionsOrigin: utils.envOverride(\"FIREBASE_EXT_URL\", \"https://firebaseextensions.googleapis.com\"),\n  realtimeOrigin: utils.envOverride(\"FIREBASE_REALTIME_URL\", \"https://firebaseio.com\"),\n  rtdbManagementOrigin: utils.envOverride(\"FIREBASE_RTDB_MANAGEMENT_URL\", \"https://firebasedatabase.googleapis.com\"),\n  rtdbMetadataOrigin: utils.envOverride(\"FIREBASE_RTDB_METADATA_URL\", \"https://metadata-dot-firebase-prod.appspot.com\"),\n  remoteConfigApiOrigin: utils.envOverride(\"FIREBASE_REMOTE_CONFIG_URL\", \"https://firebaseremoteconfig.googleapis.com\"),\n  resourceManagerOrigin: utils.envOverride(\"FIREBASE_RESOURCEMANAGER_URL\", \"https://cloudresourcemanager.googleapis.com\"),\n  rulesOrigin: utils.envOverride(\"FIREBASE_RULES_URL\", \"https://firebaserules.googleapis.com\"),\n  runtimeconfigOrigin: utils.envOverride(\"FIREBASE_RUNTIMECONFIG_URL\", \"https://runtimeconfig.googleapis.com\"),\n  storageOrigin: utils.envOverride(\"FIREBASE_STORAGE_URL\", \"https://storage.googleapis.com\"),\n  firebaseStorageOrigin: utils.envOverride(\"FIREBASE_FIREBASESTORAGE_URL\", \"https://firebasestorage.googleapis.com\"),\n  hostingApiOrigin: utils.envOverride(\"FIREBASE_HOSTING_API_URL\", \"https://firebasehosting.googleapis.com\"),\n  cloudRunApiOrigin: utils.envOverride(\"CLOUD_RUN_API_URL\", \"https://run.googleapis.com\"),\n  serviceUsageOrigin: utils.envOverride(\"FIREBASE_SERVICE_USAGE_URL\", \"https://serviceusage.googleapis.com\"),\n  githubOrigin: utils.envOverride(\"GITHUB_URL\", \"https://github.com\"),\n  githubApiOrigin: utils.envOverride(\"GITHUB_API_URL\", \"https://api.github.com\"),\n  githubClientId: utils.envOverride(\"GITHUB_CLIENT_ID\", \"89cf50f02ac6aaed3484\"),\n  githubClientSecret: utils.envOverride(\"GITHUB_CLIENT_SECRET\", \"3330d14abc895d9a74d5f17cd7a00711fa2c5bf0\"),\n  setRefreshToken: function (token) {\n    refreshToken = token;\n  },\n  setAccessToken: function (token) {\n    accessToken = token;\n  },\n  getScopes: function () {\n    return commandScopes;\n  },\n  setScopes: function (s) {\n    commandScopes = _.uniq(_.flatten([scopes.EMAIL, scopes.OPENID, scopes.CLOUD_PROJECTS_READONLY, scopes.FIREBASE_PLATFORM].concat(s || [])));\n    logger.debug(\"> command requires scopes:\", JSON.stringify(commandScopes));\n  },\n  getAccessToken: function () {\n    return accessToken ? Promise.resolve({\n      access_token: accessToken\n    }) : require(\"./auth\").getAccessToken(refreshToken, commandScopes);\n  },\n  addRequestHeaders: function (reqOptions, options) {\n    _.set(reqOptions, [\"headers\", \"User-Agent\"], \"FirebaseCLI/\" + CLI_VERSION);\n\n    _.set(reqOptions, [\"headers\", \"X-Client-Version\"], \"FirebaseCLI/\" + CLI_VERSION);\n\n    var secureRequest = true;\n\n    if (options && options.origin) {\n      const originUrl = url.parse(options.origin);\n      secureRequest = originUrl.protocol === \"https:\";\n    }\n\n    var getTokenPromise = secureRequest ? api.getAccessToken() : Promise.resolve({\n      access_token: \"owner\"\n    });\n    return getTokenPromise.then(function (result) {\n      _.set(reqOptions, \"headers.authorization\", \"Bearer \" + result.access_token);\n\n      return reqOptions;\n    });\n  },\n  request: function (method, resource, options) {\n    options = _.extend({\n      data: {},\n      resolveOnHTTPError: false,\n      json: true\n    }, options);\n\n    if (!options.origin) {\n      throw new FirebaseError(\"Cannot make request without an origin\", {\n        exit: 2\n      });\n    }\n\n    var validMethods = [\"GET\", \"PUT\", \"POST\", \"DELETE\", \"PATCH\"];\n\n    if (validMethods.indexOf(method) < 0) {\n      method = \"GET\";\n    }\n\n    var reqOptions = {\n      method: method\n    };\n\n    if (options.query) {\n      resource = _appendQueryData(resource, options.query);\n    }\n\n    if (method === \"GET\") {\n      resource = _appendQueryData(resource, options.data);\n    } else {\n      if (_.size(options.data) > 0) {\n        reqOptions.body = options.data;\n      } else if (_.size(options.form) > 0) {\n        reqOptions.form = options.form;\n      }\n    }\n\n    reqOptions.url = options.origin + resource;\n    reqOptions.files = options.files;\n    reqOptions.resolveOnHTTPError = options.resolveOnHTTPError;\n    reqOptions.json = options.json;\n    reqOptions.qs = options.qs;\n    reqOptions.headers = options.headers;\n    reqOptions.timeout = options.timeout;\n\n    var requestFunction = function () {\n      return _request(reqOptions, options.logOptions);\n    };\n\n    if (options.auth === true) {\n      requestFunction = function () {\n        return api.addRequestHeaders(reqOptions, options).then(function (reqOptionsWithToken) {\n          return _request(reqOptionsWithToken, options.logOptions);\n        });\n      };\n    }\n\n    return requestFunction().catch(function (err) {\n      if (options.retryCodes && _.includes(options.retryCodes, _.get(err, \"context.response.statusCode\"))) {\n        return new Promise(function (resolve) {\n          setTimeout(resolve, 1000);\n        }).then(requestFunction);\n      }\n\n      return Promise.reject(err);\n    });\n  }\n};\nmodule.exports = api;","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/firebase-tools/lib/api.js"],"names":["_","require","querystring","request","url","Constants","FirebaseError","logger","responseToError","scopes","utils","CLI_VERSION","version","accessToken","refreshToken","commandScopes","_request","options","logOptions","qsLog","bodyLog","qs","skipQueryParams","JSON","stringify","skipRequestBody","body","form","debug","method","headers","Promise","resolve","reject","req","err","response","message","original","exit","statusCode","skipResponseBody","resolveOnHTTPError","status","size","files","forEach","details","param","append","stream","knownLength","filename","contentType","_appendQueryData","path","data","includes","api","clientId","envOverride","clientSecret","cloudbillingOrigin","cloudloggingOrigin","containerRegistryDomain","appDistributionOrigin","appengineOrigin","authOrigin","consoleOrigin","deployOrigin","dynamicLinksOrigin","dynamicLinksKey","firebaseApiOrigin","firebaseExtensionsRegistryOrigin","firedataOrigin","firestoreOriginOrEmulator","FIRESTORE_EMULATOR_HOST","val","startsWith","firestoreOrigin","functionsOrigin","functionsV2Origin","runOrigin","functionsUploadRegion","functionsDefaultRegion","cloudschedulerOrigin","pubsubOrigin","googleOrigin","hostingOrigin","identityOrigin","iamOrigin","extensionsOrigin","realtimeOrigin","rtdbManagementOrigin","rtdbMetadataOrigin","remoteConfigApiOrigin","resourceManagerOrigin","rulesOrigin","runtimeconfigOrigin","storageOrigin","firebaseStorageOrigin","hostingApiOrigin","cloudRunApiOrigin","serviceUsageOrigin","githubOrigin","githubApiOrigin","githubClientId","githubClientSecret","setRefreshToken","token","setAccessToken","getScopes","setScopes","s","uniq","flatten","EMAIL","OPENID","CLOUD_PROJECTS_READONLY","FIREBASE_PLATFORM","concat","getAccessToken","access_token","addRequestHeaders","reqOptions","set","secureRequest","origin","originUrl","parse","protocol","getTokenPromise","then","result","resource","extend","json","validMethods","indexOf","query","timeout","requestFunction","auth","reqOptionsWithToken","catch","retryCodes","get","setTimeout","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\nvar _ = require(\"lodash\");\nvar querystring = require(\"querystring\");\nvar request = require(\"request\");\nvar url = require(\"url\");\nvar { Constants } = require(\"./emulator/constants\");\nvar { FirebaseError } = require(\"./error\");\nconst { logger } = require(\"./logger\");\nvar responseToError = require(\"./responseToError\");\nvar scopes = require(\"./scopes\");\nvar utils = require(\"./utils\");\nvar CLI_VERSION = require(\"../package.json\").version;\nvar accessToken;\nvar refreshToken;\nvar commandScopes;\nvar _request = function (options, logOptions) {\n    logOptions = logOptions || {};\n    var qsLog = \"\";\n    var bodyLog = \"<request body omitted>\";\n    if (options.qs && !logOptions.skipQueryParams) {\n        qsLog = JSON.stringify(options.qs);\n    }\n    if (!logOptions.skipRequestBody) {\n        bodyLog = options.body || options.form || \"\";\n    }\n    logger.debug(\">>> HTTP REQUEST\", options.method, options.url, qsLog, \"\\n\", bodyLog);\n    options.headers = options.headers || {};\n    options.headers[\"connection\"] = \"keep-alive\";\n    return new Promise(function (resolve, reject) {\n        var req = request(options, function (err, response, body) {\n            if (err) {\n                return reject(new FirebaseError(\"Server Error. \" + err.message, {\n                    original: err,\n                    exit: 2,\n                }));\n            }\n            logger.debug(\"<<< HTTP RESPONSE\", response.statusCode, response.headers);\n            if (response.statusCode >= 400 && !logOptions.skipResponseBody) {\n                logger.debug(\"<<< HTTP RESPONSE BODY\", response.body);\n                if (!options.resolveOnHTTPError) {\n                    return reject(responseToError(response, body));\n                }\n            }\n            return resolve({\n                status: response.statusCode,\n                response: response,\n                body: body,\n            });\n        });\n        if (_.size(options.files) > 0) {\n            var form = req.form();\n            _.forEach(options.files, function (details, param) {\n                form.append(param, details.stream, {\n                    knownLength: details.knownLength,\n                    filename: details.filename,\n                    contentType: details.contentType,\n                });\n            });\n        }\n    });\n};\nvar _appendQueryData = function (path, data) {\n    if (data && _.size(data) > 0) {\n        path += _.includes(path, \"?\") ? \"&\" : \"?\";\n        path += querystring.stringify(data);\n    }\n    return path;\n};\nvar api = {\n    clientId: utils.envOverride(\"FIREBASE_CLIENT_ID\", \"563584335869-fgrhgmd47bqnekij5i8b5pr03ho849e6.apps.googleusercontent.com\"),\n    clientSecret: utils.envOverride(\"FIREBASE_CLIENT_SECRET\", \"j9iVZfS8kkCEFUPaAeJV0sAi\"),\n    cloudbillingOrigin: utils.envOverride(\"FIREBASE_CLOUDBILLING_URL\", \"https://cloudbilling.googleapis.com\"),\n    cloudloggingOrigin: utils.envOverride(\"FIREBASE_CLOUDLOGGING_URL\", \"https://logging.googleapis.com\"),\n    containerRegistryDomain: utils.envOverride(\"CONTAINER_REGISTRY_DOMAIN\", \"gcr.io\"),\n    appDistributionOrigin: utils.envOverride(\"FIREBASE_APP_DISTRIBUTION_URL\", \"https://firebaseappdistribution.googleapis.com\"),\n    appengineOrigin: utils.envOverride(\"FIREBASE_APPENGINE_URL\", \"https://appengine.googleapis.com\"),\n    authOrigin: utils.envOverride(\"FIREBASE_AUTH_URL\", \"https://accounts.google.com\"),\n    consoleOrigin: utils.envOverride(\"FIREBASE_CONSOLE_URL\", \"https://console.firebase.google.com\"),\n    deployOrigin: utils.envOverride(\"FIREBASE_DEPLOY_URL\", utils.envOverride(\"FIREBASE_UPLOAD_URL\", \"https://deploy.firebase.com\")),\n    dynamicLinksOrigin: utils.envOverride(\"FIREBASE_DYNAMIC_LINKS_URL\", \"https://firebasedynamiclinks.googleapis.com\"),\n    dynamicLinksKey: utils.envOverride(\"FIREBASE_DYNAMIC_LINKS_KEY\", \"AIzaSyB6PtY5vuiSB8MNgt20mQffkOlunZnHYiQ\"),\n    firebaseApiOrigin: utils.envOverride(\"FIREBASE_API_URL\", \"https://firebase.googleapis.com\"),\n    firebaseExtensionsRegistryOrigin: utils.envOverride(\"FIREBASE_EXT_REGISTRY_ORIGIN\", \"https://extensions-registry.firebaseapp.com\"),\n    firedataOrigin: utils.envOverride(\"FIREBASE_FIREDATA_URL\", \"https://mobilesdk-pa.googleapis.com\"),\n    firestoreOriginOrEmulator: utils.envOverride(Constants.FIRESTORE_EMULATOR_HOST, utils.envOverride(\"FIRESTORE_URL\", \"https://firestore.googleapis.com\"), (val) => {\n        if (val.startsWith(\"http\")) {\n            return val;\n        }\n        return `http://${val}`;\n    }),\n    firestoreOrigin: utils.envOverride(\"FIRESTORE_URL\", \"https://firestore.googleapis.com\"),\n    functionsOrigin: utils.envOverride(\"FIREBASE_FUNCTIONS_URL\", \"https://cloudfunctions.googleapis.com\"),\n    functionsV2Origin: utils.envOverride(\"FIREBASE_FUNCTIONS_V2_URL\", \"https://cloudfunctions.googleapis.com\"),\n    runOrigin: utils.envOverride(\"CLOUD_RUN_URL\", \"https://run.googleapis.com\"),\n    functionsUploadRegion: utils.envOverride(\"FIREBASE_FUNCTIONS_UPLOAD_REGION\", \"us-central1\"),\n    functionsDefaultRegion: utils.envOverride(\"FIREBASE_FUNCTIONS_DEFAULT_REGION\", \"us-central1\"),\n    cloudschedulerOrigin: utils.envOverride(\"FIREBASE_CLOUDSCHEDULER_URL\", \"https://cloudscheduler.googleapis.com\"),\n    pubsubOrigin: utils.envOverride(\"FIREBASE_PUBSUB_URL\", \"https://pubsub.googleapis.com\"),\n    googleOrigin: utils.envOverride(\"FIREBASE_TOKEN_URL\", utils.envOverride(\"FIREBASE_GOOGLE_URL\", \"https://www.googleapis.com\")),\n    hostingOrigin: utils.envOverride(\"FIREBASE_HOSTING_URL\", \"https://web.app\"),\n    identityOrigin: utils.envOverride(\"FIREBASE_IDENTITY_URL\", \"https://identitytoolkit.googleapis.com\"),\n    iamOrigin: utils.envOverride(\"FIREBASE_IAM_URL\", \"https://iam.googleapis.com\"),\n    extensionsOrigin: utils.envOverride(\"FIREBASE_EXT_URL\", \"https://firebaseextensions.googleapis.com\"),\n    realtimeOrigin: utils.envOverride(\"FIREBASE_REALTIME_URL\", \"https://firebaseio.com\"),\n    rtdbManagementOrigin: utils.envOverride(\"FIREBASE_RTDB_MANAGEMENT_URL\", \"https://firebasedatabase.googleapis.com\"),\n    rtdbMetadataOrigin: utils.envOverride(\"FIREBASE_RTDB_METADATA_URL\", \"https://metadata-dot-firebase-prod.appspot.com\"),\n    remoteConfigApiOrigin: utils.envOverride(\"FIREBASE_REMOTE_CONFIG_URL\", \"https://firebaseremoteconfig.googleapis.com\"),\n    resourceManagerOrigin: utils.envOverride(\"FIREBASE_RESOURCEMANAGER_URL\", \"https://cloudresourcemanager.googleapis.com\"),\n    rulesOrigin: utils.envOverride(\"FIREBASE_RULES_URL\", \"https://firebaserules.googleapis.com\"),\n    runtimeconfigOrigin: utils.envOverride(\"FIREBASE_RUNTIMECONFIG_URL\", \"https://runtimeconfig.googleapis.com\"),\n    storageOrigin: utils.envOverride(\"FIREBASE_STORAGE_URL\", \"https://storage.googleapis.com\"),\n    firebaseStorageOrigin: utils.envOverride(\"FIREBASE_FIREBASESTORAGE_URL\", \"https://firebasestorage.googleapis.com\"),\n    hostingApiOrigin: utils.envOverride(\"FIREBASE_HOSTING_API_URL\", \"https://firebasehosting.googleapis.com\"),\n    cloudRunApiOrigin: utils.envOverride(\"CLOUD_RUN_API_URL\", \"https://run.googleapis.com\"),\n    serviceUsageOrigin: utils.envOverride(\"FIREBASE_SERVICE_USAGE_URL\", \"https://serviceusage.googleapis.com\"),\n    githubOrigin: utils.envOverride(\"GITHUB_URL\", \"https://github.com\"),\n    githubApiOrigin: utils.envOverride(\"GITHUB_API_URL\", \"https://api.github.com\"),\n    githubClientId: utils.envOverride(\"GITHUB_CLIENT_ID\", \"89cf50f02ac6aaed3484\"),\n    githubClientSecret: utils.envOverride(\"GITHUB_CLIENT_SECRET\", \"3330d14abc895d9a74d5f17cd7a00711fa2c5bf0\"),\n    setRefreshToken: function (token) {\n        refreshToken = token;\n    },\n    setAccessToken: function (token) {\n        accessToken = token;\n    },\n    getScopes: function () {\n        return commandScopes;\n    },\n    setScopes: function (s) {\n        commandScopes = _.uniq(_.flatten([\n            scopes.EMAIL,\n            scopes.OPENID,\n            scopes.CLOUD_PROJECTS_READONLY,\n            scopes.FIREBASE_PLATFORM,\n        ].concat(s || [])));\n        logger.debug(\"> command requires scopes:\", JSON.stringify(commandScopes));\n    },\n    getAccessToken: function () {\n        return accessToken\n            ? Promise.resolve({ access_token: accessToken })\n            : require(\"./auth\").getAccessToken(refreshToken, commandScopes);\n    },\n    addRequestHeaders: function (reqOptions, options) {\n        _.set(reqOptions, [\"headers\", \"User-Agent\"], \"FirebaseCLI/\" + CLI_VERSION);\n        _.set(reqOptions, [\"headers\", \"X-Client-Version\"], \"FirebaseCLI/\" + CLI_VERSION);\n        var secureRequest = true;\n        if (options && options.origin) {\n            const originUrl = url.parse(options.origin);\n            secureRequest = originUrl.protocol === \"https:\";\n        }\n        var getTokenPromise = secureRequest\n            ? api.getAccessToken()\n            : Promise.resolve({ access_token: \"owner\" });\n        return getTokenPromise.then(function (result) {\n            _.set(reqOptions, \"headers.authorization\", \"Bearer \" + result.access_token);\n            return reqOptions;\n        });\n    },\n    request: function (method, resource, options) {\n        options = _.extend({\n            data: {},\n            resolveOnHTTPError: false,\n            json: true,\n        }, options);\n        if (!options.origin) {\n            throw new FirebaseError(\"Cannot make request without an origin\", { exit: 2 });\n        }\n        var validMethods = [\"GET\", \"PUT\", \"POST\", \"DELETE\", \"PATCH\"];\n        if (validMethods.indexOf(method) < 0) {\n            method = \"GET\";\n        }\n        var reqOptions = {\n            method: method,\n        };\n        if (options.query) {\n            resource = _appendQueryData(resource, options.query);\n        }\n        if (method === \"GET\") {\n            resource = _appendQueryData(resource, options.data);\n        }\n        else {\n            if (_.size(options.data) > 0) {\n                reqOptions.body = options.data;\n            }\n            else if (_.size(options.form) > 0) {\n                reqOptions.form = options.form;\n            }\n        }\n        reqOptions.url = options.origin + resource;\n        reqOptions.files = options.files;\n        reqOptions.resolveOnHTTPError = options.resolveOnHTTPError;\n        reqOptions.json = options.json;\n        reqOptions.qs = options.qs;\n        reqOptions.headers = options.headers;\n        reqOptions.timeout = options.timeout;\n        var requestFunction = function () {\n            return _request(reqOptions, options.logOptions);\n        };\n        if (options.auth === true) {\n            requestFunction = function () {\n                return api.addRequestHeaders(reqOptions, options).then(function (reqOptionsWithToken) {\n                    return _request(reqOptionsWithToken, options.logOptions);\n                });\n            };\n        }\n        return requestFunction().catch(function (err) {\n            if (options.retryCodes &&\n                _.includes(options.retryCodes, _.get(err, \"context.response.statusCode\"))) {\n                return new Promise(function (resolve) {\n                    setTimeout(resolve, 1000);\n                }).then(requestFunction);\n            }\n            return Promise.reject(err);\n        });\n    },\n};\nmodule.exports = api;\n"]},"metadata":{},"sourceType":"script"}