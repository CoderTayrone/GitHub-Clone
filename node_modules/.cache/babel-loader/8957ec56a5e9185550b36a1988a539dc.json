{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.promptForPublisherTOS = exports.prompt = exports.retrieveRoleInfo = exports.formatDescription = void 0;\n\nconst _ = require(\"lodash\");\n\nconst clc = require(\"cli-color\");\n\nconst marked = require(\"marked\");\n\nconst TerminalRenderer = require(\"marked-terminal\");\n\nconst error_1 = require(\"../error\");\n\nconst extensionsHelper_1 = require(\"../extensions/extensionsHelper\");\n\nconst iam = require(\"../gcp/iam\");\n\nconst prompt_1 = require(\"../prompt\");\n\nconst utils = require(\"../utils\");\n\nmarked.setOptions({\n  renderer: new TerminalRenderer()\n});\n\nasync function formatDescription(extensionName, projectId, roles) {\n  const question = `${clc.bold(extensionName)} will be granted the following access to project ${clc.bold(projectId)}`;\n  const results = await Promise.all(roles.map(role => {\n    return retrieveRoleInfo(role);\n  }));\n  results.unshift(question);\n  return _.join(results, \"\\n\");\n}\n\nexports.formatDescription = formatDescription;\n\nasync function retrieveRoleInfo(role) {\n  const res = await iam.getRole(role);\n  return `- ${res.title} (${res.description})`;\n}\n\nexports.retrieveRoleInfo = retrieveRoleInfo;\n\nasync function prompt(extensionName, projectId, roles) {\n  if (!roles || !roles.length) {\n    return;\n  }\n\n  const message = await formatDescription(extensionName, projectId, roles);\n  utils.logLabeledBullet(extensionsHelper_1.logPrefix, message);\n  const question = {\n    name: \"consent\",\n    type: \"confirm\",\n    message: \"Would you like to continue?\",\n    default: true\n  };\n  const consented = await prompt_1.promptOnce(question);\n\n  if (!consented) {\n    throw new error_1.FirebaseError(\"Without explicit consent for the roles listed, we cannot deploy this extension.\");\n  }\n}\n\nexports.prompt = prompt;\n\nasync function promptForPublisherTOS() {\n  const termsOfServiceMsg = \"By registering as a publisher, you confirm that you have read the Firebase Extensions Publisher Terms and Conditions (linked below) and you, on behalf of yourself and the organization you represent, agree to comply with it.  Here is a brief summary of the highlights of our terms and conditions:\\n\" + \"  - You ensure extensions you publish comply with all laws and regulations; do not include any viruses, spyware, Trojan horses, or other malicious code; and do not violate any person’s rights, including intellectual property, privacy, and security rights.\\n\" + \"  - You will not engage in any activity that interferes with or accesses in an unauthorized manner the properties or services of Google, Google’s affiliates, or any third party.\\n\" + \"  - If you become aware or should be aware of a critical security issue in your extension, you will provide either a resolution or a written resolution plan within 48 hours.\\n\" + \"  - If Google requests a critical security matter to be patched for your extension, you will respond to Google within 48 hours with either a resolution or a written resolution plan.\\n\" + \"  - Google may remove your extension or terminate the agreement, if you violate any terms.\";\n  utils.logLabeledBullet(extensionsHelper_1.logPrefix, marked(termsOfServiceMsg));\n  const question = {\n    name: \"consent\",\n    type: \"confirm\",\n    message: marked(\"Do you accept the [Firebase Extensions Publisher Terms and Conditions](https://firebase.google.com/docs/extensions/alpha/terms-of-service) and acknowledge that your information will be used in accordance with [Google's Privacy Policy](https://policies.google.com/privacy?hl=en)?\"),\n    default: false\n  };\n  const consented = await prompt_1.promptOnce(question);\n\n  if (!consented) {\n    throw new error_1.FirebaseError(\"You must agree to the terms of service to register a publisher ID.\", {\n      exit: 1\n    });\n  }\n}\n\nexports.promptForPublisherTOS = promptForPublisherTOS;","map":{"version":3,"sources":["/home/dev/Documentos/Projects/github-clone/node_modules/firebase-tools/lib/extensions/askUserForConsent.js"],"names":["Object","defineProperty","exports","value","promptForPublisherTOS","prompt","retrieveRoleInfo","formatDescription","_","require","clc","marked","TerminalRenderer","error_1","extensionsHelper_1","iam","prompt_1","utils","setOptions","renderer","extensionName","projectId","roles","question","bold","results","Promise","all","map","role","unshift","join","res","getRole","title","description","length","message","logLabeledBullet","logPrefix","name","type","default","consented","promptOnce","FirebaseError","termsOfServiceMsg","exit"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.promptForPublisherTOS = exports.prompt = exports.retrieveRoleInfo = exports.formatDescription = void 0;\nconst _ = require(\"lodash\");\nconst clc = require(\"cli-color\");\nconst marked = require(\"marked\");\nconst TerminalRenderer = require(\"marked-terminal\");\nconst error_1 = require(\"../error\");\nconst extensionsHelper_1 = require(\"../extensions/extensionsHelper\");\nconst iam = require(\"../gcp/iam\");\nconst prompt_1 = require(\"../prompt\");\nconst utils = require(\"../utils\");\nmarked.setOptions({\n    renderer: new TerminalRenderer(),\n});\nasync function formatDescription(extensionName, projectId, roles) {\n    const question = `${clc.bold(extensionName)} will be granted the following access to project ${clc.bold(projectId)}`;\n    const results = await Promise.all(roles.map((role) => {\n        return retrieveRoleInfo(role);\n    }));\n    results.unshift(question);\n    return _.join(results, \"\\n\");\n}\nexports.formatDescription = formatDescription;\nasync function retrieveRoleInfo(role) {\n    const res = await iam.getRole(role);\n    return `- ${res.title} (${res.description})`;\n}\nexports.retrieveRoleInfo = retrieveRoleInfo;\nasync function prompt(extensionName, projectId, roles) {\n    if (!roles || !roles.length) {\n        return;\n    }\n    const message = await formatDescription(extensionName, projectId, roles);\n    utils.logLabeledBullet(extensionsHelper_1.logPrefix, message);\n    const question = {\n        name: \"consent\",\n        type: \"confirm\",\n        message: \"Would you like to continue?\",\n        default: true,\n    };\n    const consented = await prompt_1.promptOnce(question);\n    if (!consented) {\n        throw new error_1.FirebaseError(\"Without explicit consent for the roles listed, we cannot deploy this extension.\");\n    }\n}\nexports.prompt = prompt;\nasync function promptForPublisherTOS() {\n    const termsOfServiceMsg = \"By registering as a publisher, you confirm that you have read the Firebase Extensions Publisher Terms and Conditions (linked below) and you, on behalf of yourself and the organization you represent, agree to comply with it.  Here is a brief summary of the highlights of our terms and conditions:\\n\" +\n        \"  - You ensure extensions you publish comply with all laws and regulations; do not include any viruses, spyware, Trojan horses, or other malicious code; and do not violate any person’s rights, including intellectual property, privacy, and security rights.\\n\" +\n        \"  - You will not engage in any activity that interferes with or accesses in an unauthorized manner the properties or services of Google, Google’s affiliates, or any third party.\\n\" +\n        \"  - If you become aware or should be aware of a critical security issue in your extension, you will provide either a resolution or a written resolution plan within 48 hours.\\n\" +\n        \"  - If Google requests a critical security matter to be patched for your extension, you will respond to Google within 48 hours with either a resolution or a written resolution plan.\\n\" +\n        \"  - Google may remove your extension or terminate the agreement, if you violate any terms.\";\n    utils.logLabeledBullet(extensionsHelper_1.logPrefix, marked(termsOfServiceMsg));\n    const question = {\n        name: \"consent\",\n        type: \"confirm\",\n        message: marked(\"Do you accept the [Firebase Extensions Publisher Terms and Conditions](https://firebase.google.com/docs/extensions/alpha/terms-of-service) and acknowledge that your information will be used in accordance with [Google's Privacy Policy](https://policies.google.com/privacy?hl=en)?\"),\n        default: false,\n    };\n    const consented = await prompt_1.promptOnce(question);\n    if (!consented) {\n        throw new error_1.FirebaseError(\"You must agree to the terms of service to register a publisher ID.\", {\n            exit: 1,\n        });\n    }\n}\nexports.promptForPublisherTOS = promptForPublisherTOS;\n"]},"metadata":{},"sourceType":"script"}